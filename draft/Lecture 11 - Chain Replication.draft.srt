1
00:00:00,000 --> 00:00:01,020
0,180 180,540 540,630 630,750 750,1020
Good evening or good night
傍晚好，晚上好，无论你在哪里，

2
00:00:01,020 --> 00:00:03,150
0,240 240,630 1290,1770 1800,2010 2010,2130
wherever you are,| let's get
|我们开始吧。

3
00:00:03,150 --> 00:00:04,320
0,630
started.|
|

4
00:00:04,440 --> 00:00:05,910
0,180 180,360 360,810 810,1140 1140,1470
{} So today, I wanna
今天，我想谈谈链式复制，

5
00:00:05,940 --> 00:00:07,320
0,210 210,270 270,450 450,840 840,1380
talk a little bit about

6
00:00:07,320 --> 00:00:09,900
0,300 300,990 990,1470 1500,1950 2130,2580
chain replication,| the paper {aside,for,today}
|今天的论文来自 2004 ，

7
00:00:10,260 --> 00:00:13,140
0,330 330,780 780,2190 2190,2490 2490,2880
from {2004 -},| before diving
|在深入研究这篇论文之前，

8
00:00:13,140 --> 00:00:15,120
0,450 450,540 540,1140 1140,1590 1680,1980
into the paper,| a couple
|我想提醒你几件后勤上的事，

9
00:00:15,120 --> 00:00:17,340
0,300 300,960 960,1410 1410,1950 1980,2220
quick logistic things I just

10
00:00:17,340 --> 00:00:18,270
0,150 150,240 240,540 540,690 690,930
want to remind you of,|
|

11
00:00:18,810 --> 00:00:20,670
0,450 450,930 930,1440 1440,1590 1590,1860
{} one is we have
一是我们周四有个测验，

12
00:00:20,670 --> 00:00:23,080
0,150 150,750 750,1260 1260,1860
a quiz on Thursday,|
|

13
00:00:23,830 --> 00:00:25,240
0,540 540,1110 1110,1200 1200,1290 1290,1410
{} and you know the
测验的所有主题说明

14
00:00:25,240 --> 00:00:27,640
0,720 720,720 1530,1950 1950,2070 2070,2400
instructions of topics that actually

15
00:00:27,640 --> 00:00:28,600
0,180 180,450 450,510 510,600 600,960
being covered all the quiz|
|

16
00:00:28,600 --> 00:00:29,770
0,180 180,270 270,330 330,720 720,1170
are on the schedule page,|
都在课程表页面上，|

17
00:00:29,800 --> 00:00:31,150
0,300 300,510 510,720 720,1050 1080,1350
{} we'll try to send
我们会在 Piazza 上发布公告，包含更多细节，

18
00:00:31,150 --> 00:00:33,130
0,390 450,990 990,1590 1590,1710 1710,1980
out an announcement of {Piazza

19
00:00:33,130 --> 00:00:34,480
0,180 180,360 360,480 480,690 690,1350
- -} for more details|
|

20
00:00:34,780 --> 00:00:36,940
0,300 300,840 840,1470 1470,1920 1920,2160
about exactly how we'll do
关于我们怎么做测验，

21
00:00:36,940 --> 00:00:38,620
0,330 330,780 1080,1410 1410,1560 1560,1680
the quiz,| {} it's going
|它将在[年级范围]内，

22
00:00:38,620 --> 00:00:39,700
0,60 60,150 150,240 240,480 480,1080
to be in grade scope,|
|

23
00:00:39,730 --> 00:00:42,730
0,690 1050,1650 1650,1920 1920,2280 2310,3000
{} and {} it's basically
是在上课时间 80 分钟，

24
00:00:42,730 --> 00:00:44,380
0,240 240,570 570,810 810,1140 1140,1650
during class hours 80 minutes,|
|

25
00:00:44,470 --> 00:00:47,020
0,750 1200,1440 1440,2100 2100,2460 2460,2550
{} and more details to
以及后续更多细节。

26
00:00:47,020 --> 00:00:48,560
0,1110
follow.|
|

27
00:00:49,010 --> 00:00:51,410
0,270 270,810 1140,1950 1950,1950 1950,2400
The second {you,know} I want
第二个我想提醒大家的是项目，

28
00:00:51,410 --> 00:00:53,210
0,120 120,390 390,660 660,1050 1080,1800
to remind people of is

29
00:00:53,240 --> 00:00:56,140
0,870 1440,2100
projects, {}|
|

30
00:00:56,790 --> 00:00:57,990
0,150 150,420 420,630 630,690 690,1200
if you'd like to do
如果你想做一个项目而不是实验 4 ，

31
00:00:57,990 --> 00:00:59,220
0,90 90,540 540,870 870,990 990,1230
a project instead of lab

32
00:00:59,220 --> 00:01:03,700
0,510 900,3930
4,| then
|那么你可以这么做，

33
00:01:03,890 --> 00:01:05,090
0,450 450,630 630,720 720,810 810,1200
{} you can do so,|
|

34
00:01:05,090 --> 00:01:06,710
0,480 480,630 630,750 750,1410 1410,1620
{} but {you,should} submit a
但你应该提交一份项目建议书，

35
00:01:06,710 --> 00:01:08,060
0,510 510,630 630,720 720,1170 1170,1350
proposal for a project,| and
|使用几个段落，通过提交网站提交，

36
00:01:08,060 --> 00:01:10,460
0,300 300,450 450,690 690,1500 1860,2400
use a couple paragraphs {}

37
00:01:10,460 --> 00:01:12,920
0,390 390,1050 1440,1500 1500,2010 2010,2460
to {} through {the,submission} website,|
|

38
00:01:12,950 --> 00:01:14,180
0,510 510,660 660,810 810,930 930,1230
{} so that we can
这样我们就可以给你反馈，

39
00:01:14,180 --> 00:01:15,230
0,150 150,240 240,660 660,840 840,1050
give you feedback,| and to
|告诉你这个项目是否适合 6.824 的期末项目，

40
00:01:15,230 --> 00:01:16,340
0,240 240,300 300,540 540,690 690,1110
tell you what this project

41
00:01:16,340 --> 00:01:18,350
0,360 360,900 900,1440 1470,1680 1680,2010
actually appropriate for a final

42
00:01:18,350 --> 00:01:19,790
0,510 510,720 720,810 810,990 990,1440
project in {6.824 - -},|
|

43
00:01:20,300 --> 00:01:21,380
0,360 360,540 540,660 660,810 810,1080
{} if you're just planning
如果你只是计划去做实验 4 ，

44
00:01:21,380 --> 00:01:22,850
0,180 180,450 450,930 960,1110 1110,1470
to lab 4,| there's absolutely
|你不需要做任何事情。

45
00:01:22,850 --> 00:01:23,540
0,240 240,330 330,450 450,540 540,690
nothing you have to do

46
00:01:23,540 --> 00:01:24,400
0,120 120,390
at all.|
|

47
00:01:25,240 --> 00:01:27,190
0,630 900,1140 1140,1470 1470,1650 1650,1950
{} Any questions about these
对这两个[后勤点]，有什么问题吗？

48
00:01:27,190 --> 00:01:28,900
0,210 210,1170
two logistical

49
00:01:29,020 --> 00:01:30,500
0,930
{}

50
00:01:31,170 --> 00:01:32,340
0,660
points?|
|

51
00:01:36,270 --> 00:01:39,090
0,480 810,1620 1680,2370 2400,2730 2730,2820
Okay, then, {} let me
好的，那么，让我转移到另一点，

52
00:01:39,090 --> 00:01:40,320
0,180 180,420 420,630 630,930 930,1230
move on to one other

53
00:01:40,320 --> 00:01:41,700
0,720 720,840 840,1080 1080,1170 1170,1380
point,| I wanted to bring
|我想提出，

54
00:01:41,700 --> 00:01:43,590
0,210 210,420 420,570 570,1080 1530,1890
up,| which is the sort
|就是之前课程的正确性，

55
00:01:43,590 --> 00:01:46,680
0,90 90,810 840,1500 2040,2550 2550,3090
of correction {} from {

56
00:01:46,950 --> 00:01:49,890
0,540 1590,1710 1710,2520 2550,2730 2730,2940
-} a lecture a little

57
00:01:49,890 --> 00:01:51,900
0,210 210,660 870,1290 1290,1740 1740,2010
while ago,| {} we, {}
|我们演练了 Go 代码

58
00:01:51,900 --> 00:01:53,670
0,90 90,330 330,540 540,1200 1230,1770
we walked through the {Go,code}|
|

59
00:01:53,670 --> 00:01:56,250
0,240 240,540 570,1170 1200,2340 2340,2580
for the raft implementation of
关于我的 raft 实现 2a 2b ，

60
00:01:56,250 --> 00:01:57,060
0,210 210,330 330,510 510,660 660,810
{2a -} {2b -} that

61
00:01:57,060 --> 00:01:59,160
0,120 120,510 780,1470 1500,1980 1980,2100
I had,| and {} we
|我们谈了关于 Go defer 语句的事情，

62
00:01:59,160 --> 00:01:59,940
0,180 180,210 210,390 390,510 510,780
talked a little bit about

63
00:01:59,940 --> 00:02:03,210
0,420 510,1140 1140,1530 1530,2070 2460,3270
the go defer statement,| and
|我提到过，

64
00:02:03,210 --> 00:02:04,650
0,450 450,840 840,1050 1050,1350 1350,1440
I mentioned that,| you can
|你可以将 defer 语句放在基本块中，

65
00:02:04,650 --> 00:02:06,180
0,270 270,690 690,840 840,1170 1170,1530
actually have the defer statement

66
00:02:06,180 --> 00:02:07,470
0,360 360,450 450,540 540,780 780,1290
inside of a base block,|
|

67
00:02:07,530 --> 00:02:09,300
0,660 660,930 930,1200 1200,1320 1320,1770
{} and that is correct,|
这是正确的，|

68
00:02:09,750 --> 00:02:10,740
0,300 300,360 360,720 720,930 930,990
and I think maybe it
我认为可能是 Felipe 提出了这个问题，

69
00:02:10,740 --> 00:02:11,670
0,150 150,420 420,630 630,870 870,930
was Felipe who asked the

70
00:02:11,670 --> 00:02:13,680
0,300 300,1020 1020,1140 1140,1770 1770,2010
question,| what is exactly when
|这个到底是什么时候执行的，

71
00:02:13,680 --> 00:02:15,180
0,180 180,390 390,540 540,1200 1200,1500
is that get executed| and
|我对这个问题的回答有误，

72
00:02:15,180 --> 00:02:16,680
0,150 150,390 390,540 540,930 930,1500
I answered that question incorrectly,|
|

73
00:02:17,040 --> 00:02:18,180
0,510 510,660 660,720 720,870 870,1140
{} you know the defer
defer 语句被执行

74
00:02:18,180 --> 00:02:19,380
0,150 150,240 240,420 420,1050 1050,1200
statement that gets executed| at
|在从函数返回时，

75
00:02:19,380 --> 00:02:20,460
0,60 60,360 360,480 480,660 660,1080
the point that gets return

76
00:02:20,460 --> 00:02:21,510
0,150 150,210 210,300 300,690 690,1050
out of the function,| not
|而不是在基础块返回的时候，

77
00:02:21,510 --> 00:02:22,470
0,180 180,420 420,630 630,690 690,960
in return {out,of} the base

78
00:02:22,470 --> 00:02:23,260
0,450
block,|
|

79
00:02:23,350 --> 00:02:25,300
0,300 300,510 510,810 810,900 900,1950
and so that my apologizes
所以，我对任何引起的疑惑表示抱歉。

80
00:02:25,300 --> 00:02:27,440
0,330 360,810 810,990 990,1560
that caused any confusion.|
|

81
00:02:27,720 --> 00:02:28,980
0,750

82
00:02:29,980 --> 00:02:32,800
0,180 180,1050 1080,2010
Any questions about
对于这个澄清，有什么问题吗？

83
00:02:32,800 --> 00:02:34,960
0,510 540,780 780,1590
the that clarification?|
|

84
00:02:37,610 --> 00:02:39,650
0,660 1260,1560 1560,1860 1860,1980 1980,2040
Okay?| Good, there's sort of
好的？|好的，有两个主题，

85
00:02:39,650 --> 00:02:40,970
0,150 150,480 480,630 630,1020 1020,1320
two topics| and really talk
|都是技术讨论，

86
00:02:40,970 --> 00:02:42,110
0,210 210,630 630,930 930,1020 1020,1140
to technical talks,| I want
|今天我想谈的是 zookeeper 的锁，

87
00:02:42,110 --> 00:02:43,130
0,60 60,270 270,540 540,840 840,1020
to talk about today is

88
00:02:43,130 --> 00:02:44,660
0,120 120,300 300,600 600,1200 1320,1530
the {zookeeper -} locks,| which
|上次我没能完成，

89
00:02:44,660 --> 00:02:46,580
0,120 120,390 390,660 780,1260 1320,1920
I didn't get to finish

90
00:02:46,580 --> 00:02:48,160
0,90 90,360 360,870
the last time,|
|

91
00:02:48,250 --> 00:02:49,810
0,240 240,720 720,1200 1200,1350 1350,1560
and then I'll talk about
然后我将讨论链式复制。

92
00:02:49,810 --> 00:02:54,790
0,240 240,960 1980,2580 3090,3690 3750,4980
chain replication.| Okay?| So both
|好的？|对于链式复制和 zookeeper 来说，

93
00:02:54,790 --> 00:02:56,380
0,240 240,540 540,1350 1350,1440 1440,1590
for chain replication and {zookeeper

94
00:02:56,380 --> 00:02:57,520
0,390 390,480 480,630 630,960 960,1140
-},| you know we're sort
|我们仍然处在和以前一样的环境中，

95
00:02:57,520 --> 00:02:59,110
0,60 60,780 780,1050 1050,1230 1230,1590
of still in the same

96
00:02:59,110 --> 00:03:01,580
0,690 690,1260 1290,1950
context as before,|
|

97
00:03:01,610 --> 00:03:04,520
0,1110 1260,2160 2160,2610 2610,2760 2760,2910
namely we're doing you know
也就是，我们在做复制状态机。

98
00:03:04,520 --> 00:03:06,460
0,420 420,630 630,1140
replicated state machine.|
|

99
00:03:07,240 --> 00:03:08,590
0,510 510,600 600,780 780,1050 1050,1350
And you know just a
这是一张常见的图，

100
00:03:08,590 --> 00:03:11,170
0,360 360,1110 1680,2370 2370,2460 2460,2580
usual diagram,| {} you know
|我们有服务器，

101
00:03:11,170 --> 00:03:12,490
0,120 120,240 240,540 540,1200 1200,1320
we have {} servers,| you
|它运行一些复制库，比如 ZAB 或 Raft ，

102
00:03:12,490 --> 00:03:13,720
0,120 120,330 330,600 600,780 780,1230
know that runs on some

103
00:03:13,750 --> 00:03:16,750
0,690 690,1230 1230,1560 1560,2370 2400,3000
replication libraries, like ZAB or

104
00:03:16,900 --> 00:03:19,080
0,1050
Raft,|
|

105
00:03:20,220 --> 00:03:22,140
0,240 240,450 450,960 990,1440 1440,1920
we have clients talking to
我们有客户端与服务器交互，

106
00:03:22,200 --> 00:03:23,730
0,180 180,750 750,990 990,1470 1470,1530
the servers,| for example in
|例如在 zookeeper 的情况中，

107
00:03:23,730 --> 00:03:25,680
0,60 60,360 360,600 720,1350 1350,1950
the case of {zookeeper -},|
|

108
00:03:25,740 --> 00:03:26,940
0,300 300,570 570,780 780,840 840,1200
might actually send to create
可能发送 create 调用，

109
00:03:26,940 --> 00:03:29,400
0,540 1500,1620 1620,1830 1830,1950 1950,2460
call,| {you,know} {zookeeper -} internally
|zookeeper 内部有一些状态，一些 znode ，

110
00:03:29,400 --> 00:03:30,840
0,120 120,300 300,810 1230,1350 1350,1440
how some states, you know

111
00:03:30,840 --> 00:03:32,160
0,180 180,390 390,1050 1050,1140 1140,1320
some {znodes -},| you know
|它们是以树的形式存在的，

112
00:03:32,160 --> 00:03:33,300
0,180 180,300 300,600 600,960 960,1140
that are hanging off in

113
00:03:33,300 --> 00:03:35,070
0,390 390,600 600,660 660,1170 1560,1770
a form of tree,| and
|所以，当一个操作进来时，

114
00:03:35,070 --> 00:03:36,150
0,150 150,360 360,450 450,870 870,1080
so when an operation comes

115
00:03:36,150 --> 00:03:37,710
0,330 330,450 450,570 570,1410 1440,1560
in,| you know zookeeper you
|zookeeper 把这个操作转发给 ZAB 库，

116
00:03:37,710 --> 00:03:39,720
0,300 570,1020 1020,1170 1170,1590 1590,2010
know forwards that operation basically

117
00:03:39,720 --> 00:03:41,910
0,210 210,600 720,1350 1350,1650 1650,2190
to the Raft ZAB library,|
|

118
00:03:41,910 --> 00:03:42,990
0,180 180,360 360,480 480,870 870,1080
it does some chatting back
它会来回聊天，

119
00:03:42,990 --> 00:03:44,060
0,90 90,840
and forth,|
|

120
00:03:44,240 --> 00:03:45,230
0,90 90,240 240,690 690,960 960,990
{} and to get a
为了获得服务器的大多数，

121
00:03:45,230 --> 00:03:46,670
0,480 480,600 600,690 690,1050 1050,1440
majority of the servers| to
|为了接受那个命令，

122
00:03:46,760 --> 00:03:48,260
0,600 600,660 660,750 750,1080 1110,1500
accept you know that {}

123
00:03:48,260 --> 00:03:49,610
0,570 810,990 990,1110 1110,1200 1200,1350
command,| and then at some
|然后在某个时刻，

124
00:03:49,610 --> 00:03:50,570
0,390 390,480 480,630 630,870 870,960
point,| you know once it's
|一旦它被接受，它出来了，

125
00:03:50,570 --> 00:03:52,430
0,420 420,480 480,720 720,1200 1230,1860
accepted, it comes out {},|
|

126
00:03:52,430 --> 00:03:54,320
0,390 390,720 720,1110 1110,1200 1200,1890
the servers applies the operation,|
服务器应用了操作，|

127
00:03:54,530 --> 00:03:55,760
0,300 300,510 510,570 570,990 990,1230
and sends a response back
并将响应发送回客户端，

128
00:03:55,760 --> 00:03:57,170
0,120 120,180 180,630 930,1110 1110,1410
to the client,| so the
|所以这是复制状态机的标准故事，

129
00:03:57,170 --> 00:03:58,820
0,210 210,600 600,900 930,1230 1230,1650
standard story of {} replicated

130
00:03:58,820 --> 00:04:00,170
0,210 210,630 630,720 720,840 840,1350
state machine,| if you start,|
|如果你启动，|

131
00:04:00,440 --> 00:04:01,790
0,390 390,480 480,900 900,1080 1080,1350
all the replicated state machine
所有复制状态机都会以相同的状态启动，

132
00:04:01,790 --> 00:04:02,990
0,330 330,390 390,630 630,1140 1140,1200
starting the same state,| you
|你以相同的顺序应用相同的操作，

133
00:04:02,990 --> 00:04:04,250
0,300 300,390 390,660 660,1200 1200,1260
apply the same operation in

134
00:04:04,250 --> 00:04:05,750
0,60 60,360 360,870 930,1410 1410,1500
the same order,| then you
|然后你就会以同样的状态结束，

135
00:04:05,750 --> 00:04:06,380
0,120 120,300 300,480 480,570 570,630
will end up in the

136
00:04:06,380 --> 00:04:07,580
0,210 210,570 570,690 690,960 960,1200
same state,| and so any
|所以，如果有必要，任何一台机器都可以接管。

137
00:04:07,580 --> 00:04:08,720
0,120 120,330 330,690 690,930 930,1140
of the machines can take

138
00:04:08,720 --> 00:04:10,100
0,330 330,480 480,1050
over if necessary.|
|

139
00:04:11,430 --> 00:04:12,510
0,540 570,750 750,840 840,900 900,1080
Now, one of the things
现在，关于 zookeeper 有趣的事情之一是，

140
00:04:12,510 --> 00:04:13,680
0,90 90,210 210,840 840,1020 1020,1170
that was cool, {about -}

141
00:04:13,680 --> 00:04:15,300
0,330 330,690 720,1080 1080,1410 1410,1620
interesting, about {zookeeper -} is

142
00:04:15,300 --> 00:04:16,890
0,330 330,420 420,630 630,870 870,1590
that,| you know read operations
|读操作可有由任何服务器提供，

143
00:04:16,890 --> 00:04:18,870
0,480 510,870 870,1290 1290,1380 1380,1980
can be served for any

144
00:04:18,900 --> 00:04:21,450
0,1020 1050,1710 1920,2220 2220,2400 2400,2550
{} servers,| for any of
|对于任何节点或任何一个服务器，

145
00:04:21,450 --> 00:04:22,290
0,90 90,480 480,570 570,750 750,840
the peers or any of

146
00:04:22,290 --> 00:04:23,340
0,90 90,300 300,360 360,510 510,1050
the one of the servers,|
|

147
00:04:23,790 --> 00:04:24,960
0,300 300,420 420,840 840,930 930,1170
and this allows {zookeeper -}
这使得 zookeeper 拥有极高的性能，

148
00:04:24,960 --> 00:04:26,730
0,150 150,600 600,780 780,1320 1320,1770
to extremely high performance,| because
|因为你可以通过扩展服务器的数量来扩展读操作的数量，

149
00:04:26,730 --> 00:04:29,100
0,90 90,240 240,810 990,1770 1800,2370
you can actually {} scale

150
00:04:29,100 --> 00:04:30,330
0,90 90,360 360,480 480,660 660,1230
the number of read operations

151
00:04:30,330 --> 00:04:31,650
0,150 150,270 270,630 630,720 720,1320
with the number of servers,|
|

152
00:04:32,190 --> 00:04:33,810
0,450 450,660 660,990 1020,1380 1380,1620
{} as a flip side
作为它的另一面，

153
00:04:33,810 --> 00:04:35,250
0,60 60,510 540,1080 1080,1350 1350,1440
of that,| {} you know
|zookeeper 放弃了，

154
00:04:35,250 --> 00:04:37,620
0,750 780,1140 1140,1320 1320,1620 1620,2370
zookeeper actually gave up,| on
|在特定场景下，

155
00:04:37,920 --> 00:04:39,420
0,330 330,720 720,1230 1230,1290 1290,1500
that particular scenario,| {} gave
|放弃了线性一致性。

156
00:04:39,420 --> 00:04:41,520
0,150 150,390 390,780 780,1230
up on {linearizability -}.|
|

157
00:04:49,920 --> 00:04:51,900
0,360 360,480 480,810 810,1290 1350,1980
Because we know from {for,example}
因为我们知道，比如在 Raft 中，

158
00:04:51,900 --> 00:04:54,090
0,630 630,750 750,990 990,1500 1500,2190
{in,Raft},| we can't actually arbitrary
|我们不能从任何服务器进行读取，

159
00:04:54,090 --> 00:04:56,430
0,390 390,630 630,780 780,1230 1500,2340
server read from any server,|
|

160
00:04:56,550 --> 00:04:59,190
0,1350 1350,1560 1560,1710 1710,1950 1950,2640
because I have not seen
因为我还没有看到最新的更新，

161
00:04:59,190 --> 00:05:00,900
0,90 90,390 390,810 810,1170 1380,1710
the latest update yet, {}|
|

162
00:05:00,900 --> 00:05:02,010
0,150 150,390 390,690 690,1020 1020,1110
and so in case of
所以在 zookeeper 的情况下，

163
00:05:02,010 --> 00:05:03,300
0,240 240,390 390,630 630,930 930,1290
zookeeper,| {} that {} is
|这是[]，

164
00:05:03,300 --> 00:05:05,820
0,90 90,300 300,780 960,1860 1890,2520
a {[] -},| and, {}
|读操作不是，

165
00:05:05,820 --> 00:05:07,980
0,240 240,660 690,930 930,1710 1710,2160
and so read operations are

166
00:05:07,980 --> 00:05:09,900
0,540 570,720 720,960 960,1140 1140,1920
not you know,| or the
|或者 zookeeper 定义的操作不提供线性化的接口。

167
00:05:09,900 --> 00:05:11,730
0,480 480,810 810,1260 1260,1410 1410,1830
operation zookeeper defines {} don't

168
00:05:11,730 --> 00:05:13,480
0,270 270,420 420,840 840,1470
provide a linearizable interface.|
|

169
00:05:13,960 --> 00:05:15,490
0,420 480,660 660,1320 1320,1410 1410,1530
{} But nevertheless you know
尽管如此，我们看到是，

170
00:05:15,490 --> 00:05:17,050
0,120 120,630 660,810 810,1260 1260,1560
we saw that actually is,|
|

171
00:05:17,080 --> 00:05:18,160
0,270 270,390 390,720 720,750 750,1080
{} it provides a slightly
它提供了一种与线性一致性略微不同的正确性保证，

172
00:05:18,160 --> 00:05:19,780
0,420 420,600 600,660 660,1080 1080,1620
different sort of correctness guarantee

173
00:05:19,780 --> 00:05:21,880
0,90 90,480 480,990 1290,1620 1620,2100
that {linearizability -},| {} and
|而且这种正确性保证是有用的，

174
00:05:21,880 --> 00:05:24,370
0,390 390,630 630,1020 1020,1350 1980,2490
that actually correctness guarantee is

175
00:05:24,760 --> 00:05:26,860
0,630 840,1140 1140,1320 1320,1710 1710,2100
useful,| {} and useful enough
|并且足够有用，能够编写实际的程序，

176
00:05:26,860 --> 00:05:27,850
0,330 330,480 480,630 630,750 750,990
to be able to write

177
00:05:27,850 --> 00:05:29,860
0,270 270,900 900,1230 1230,1320 1320,2010
actually programs,| and the particular
|zookeeper 所关注的特定程序是，

178
00:05:29,980 --> 00:05:31,060
0,270 270,360 360,840 840,1020 1020,1080
set of programs that you

179
00:05:31,060 --> 00:05:33,640
0,90 90,540 540,990 1470,2160 2160,2580
know zookeeper {was,you,know} focusing on

180
00:05:33,730 --> 00:05:35,680
0,840 870,1290 1290,1650 1650,1860 1860,1950
is,| {} these what they
|他们称为配置或协调程序。

181
00:05:35,680 --> 00:05:39,700
0,480 510,660 660,1620 2940,3150 3150,4020
call {} configuration or coordination

182
00:05:42,770 --> 00:05:44,600
0,990
programs.|
|

183
00:05:52,220 --> 00:05:53,360
0,210 210,360 360,720 720,900 900,1140
And so the thing to
所以想一想这件事，

184
00:05:53,360 --> 00:05:54,050
0,150 150,360 360,420 420,570 570,690
think about it,| there's a
|过去我们看到了很多系统，

185
00:05:54,050 --> 00:05:55,400
0,240 240,300 300,690 690,810 810,1350
lot of systems that we

186
00:05:55,430 --> 00:05:56,630
0,210 210,450 450,780 780,870 870,1200
looked at in the past,|
|

187
00:05:56,630 --> 00:05:58,490
0,210 240,630 630,1200 1230,1380 1380,1860
they typically have some replication
它们通常有一些复制的故事，

188
00:05:58,490 --> 00:06:01,010
0,360 360,570 570,690 690,1200 1680,2520
story,| and they have {}
|它们有 coordinator master 用来协调组，

189
00:06:01,130 --> 00:06:03,530
0,930 930,1020 1020,1650 1860,2250 2250,2400
coordinator {} master that sort

190
00:06:03,530 --> 00:06:05,090
0,60 60,630 630,960 960,1080 1080,1560
of coordinates the the group,|
|

191
00:06:05,090 --> 00:06:06,440
0,390 510,960 960,1110 1110,1230 1230,1350
and {} {zookeeper - -}
zookeeper 想要的是作为一个服务，

192
00:06:06,440 --> 00:06:08,060
0,240 240,780 780,870 870,1110 1110,1620
really intended you know for

193
00:06:08,060 --> 00:06:09,260
0,150 150,180 180,690 690,1020 1020,1200
as a service,| for that
|对于那种 master 或 coordinator 的角色，

194
00:06:09,260 --> 00:06:10,850
0,210 210,480 510,630 630,840 840,1590
kind of you know master

195
00:06:10,850 --> 00:06:13,040
0,450 540,1380 1380,1710 1920,2100 2100,2190
or coordinator role,| and it
|它提供了一系列原语来实现这一点，

196
00:06:13,040 --> 00:06:14,150
0,330 330,360 360,540 540,600 600,1110
provides a bunch of primitives

197
00:06:14,150 --> 00:06:15,440
0,180 180,510 510,720 720,990 990,1290
{you,know} to {} make that

198
00:06:15,440 --> 00:06:17,780
0,300 300,840 930,1350 1560,2010 2010,2340
{} doable,| and {} the
|我们上周讨论了原子增加，

199
00:06:17,870 --> 00:06:19,010
0,480 480,780 810,960 960,1080 1080,1140
two the you know we

200
00:06:19,010 --> 00:06:19,850
0,210 210,240 240,450 450,570 570,840
talked a little bit about

201
00:06:19,850 --> 00:06:22,670
0,360 360,960 990,1590 1590,1950 2070,2820
atomic increment last week, {}|
|

202
00:06:22,670 --> 00:06:24,560
0,630 660,1050 1050,1680 1680,1740 1740,1890
and with some the other
和一些其他服务，

203
00:06:24,560 --> 00:06:26,180
0,300 300,480 480,630 630,1020 1260,1620
service| and want to finish
|想通过谈论锁来结束。

204
00:06:26,180 --> 00:06:27,530
0,330 330,390 390,510 510,960 960,1350
off you know talking about

205
00:06:27,530 --> 00:06:28,600
0,600
locks.|
|

206
00:06:28,840 --> 00:06:30,880
0,600 1170,1620 1620,1830 1830,1920 1920,2040
{} One, because there were
第一，因为有很多关于它的问题，

207
00:06:30,880 --> 00:06:31,720
0,60 60,180 180,240 240,570 570,840
a lot of questions about

208
00:06:31,720 --> 00:06:32,650
0,120 120,240 240,540 540,840 840,930
it,| and two, actually is
|第二，它是非常有趣的，

209
00:06:32,650 --> 00:06:34,270
0,210 210,660 1110,1350 1350,1470 1470,1620
quite interesting,| and there's sort
|这里有两种不同的锁实现。

210
00:06:34,270 --> 00:06:36,370
0,270 300,660 660,960 960,1260 1260,2100
of two different lock {in,implementation}.|
|

211
00:06:36,370 --> 00:06:36,910
0,120 120,150 150,360 360,480 480,540
And {} first {I,want} to
首先我想谈谈简单的那个，

212
00:06:36,910 --> 00:06:38,050
0,180 180,360 360,420 420,750 750,1140
talk about the simple one,|
|

213
00:06:38,290 --> 00:06:40,720
0,930 930,1530 1710,2130 2130,2310 2310,2430
namely where, {} let me
让我写下伪代码，

214
00:06:40,720 --> 00:06:42,700
0,300 300,570 570,870 1050,1470 1470,1980
write down the pseudo code,|
|

215
00:06:42,820 --> 00:06:43,810
0,300 300,450 450,540 540,780 780,990
then we can talk about
然后我们可以谈谈细节，

216
00:06:43,810 --> 00:06:44,710
0,150 180,540 540,600 600,780 780,900
it again a little bit

217
00:06:44,710 --> 00:06:46,870
0,120 120,750 960,1380 1380,1800 1830,2160
in detail,| {} so the
|所以锁的伪代码是像这样，

218
00:06:46,900 --> 00:06:49,660
0,480 480,720 720,1020 1020,1500 2460,2760
{pseudo -} code for the

219
00:06:49,660 --> 00:06:51,700
0,300 300,870 1230,1500 1500,1650 1650,2040
lock was something like this,|
|

220
00:06:51,700 --> 00:06:53,470
0,120 120,930 960,1350 1350,1470 1470,1770
{you,know} acquire, {} in {an,infinite}
acquire ，在一个无限循环中，

221
00:06:53,470 --> 00:06:55,540
0,660 930,1140 1140,1470 1470,1680 1680,2070
loop,| {you,know} try to create
|试着创建锁文件，

222
00:06:55,540 --> 00:06:56,720
0,90 90,360 360,870
the lock file,|
|

223
00:07:01,190 --> 00:07:03,180
0,840 840,1110 1110,1470
name {lf -},
命名为 lf ，并将 ephmeral 设置为 true ，

224
00:07:03,180 --> 00:07:04,770
0,480 480,810 810,870 870,1470 1470,1590
and set {ephemeral -} to

225
00:07:04,770 --> 00:07:06,400
0,540
true,|
|

226
00:07:11,460 --> 00:07:12,150
0,150 150,240 240,360 360,540 540,690
and we'll talk about that
我们稍后会讨论为什么。

227
00:07:12,150 --> 00:07:13,380
0,90 90,120 120,360 360,960 1020,1230
in a second why.| You
|如果创建成功，

228
00:07:13,380 --> 00:07:15,300
0,60 60,390 390,780 810,1140 1140,1920
know if the create succeeds,|
|

229
00:07:16,120 --> 00:07:17,800
0,330 330,840 840,960 960,1140 1140,1680
{} then you know the
然后那个进程，

230
00:07:17,920 --> 00:07:19,570
0,300 300,810 810,1020 1020,1170 1170,1650
that process,| where the client
|第一个创建文件的客户端，

231
00:07:19,570 --> 00:07:20,410
0,150 150,240 240,510 510,720 720,840
was the first one to

232
00:07:20,410 --> 00:07:21,820
0,240 240,390 390,750 750,870 870,1410
create that file,| and basically
|成功地获得了锁

233
00:07:21,850 --> 00:07:23,950
0,900 930,1350 1350,1560 1560,2010 2010,2100
successfully gets the lock| and
|所以，它打破 for 循环并返回。

234
00:07:23,950 --> 00:07:24,760
0,150 150,300 300,600 600,720 720,810
so it breaks out of

235
00:07:24,760 --> 00:07:26,080
0,120 120,360 360,570 570,690 690,1320
the for loop and returns.|
|

236
00:07:26,980 --> 00:07:29,000
0,630 810,1530
{} If
如果客户端没有，

237
00:07:29,120 --> 00:07:31,340
0,1050 1080,1470 1470,1620 1620,2040 2070,2220
the client did not,| you
|创建一个文件，

238
00:07:31,340 --> 00:07:32,210
0,120 120,240 240,480 480,570 570,870
know be able to create

239
00:07:32,210 --> 00:07:33,410
0,60 60,420 420,840 840,840 840,1200
a file,| then {} it
|然后它调用 exists ，

240
00:07:33,410 --> 00:07:34,920
0,210 210,930
calles exists,|
|

241
00:07:34,920 --> 00:07:36,780
0,390 840,1200 1200,1500 1500,1770 1770,1860
and the call exists is
调用 exists 并不是为了看它是否存在，

242
00:07:36,780 --> 00:07:38,010
0,210 210,540 540,990 990,1080 1080,1230
not really for you know

243
00:07:38,010 --> 00:07:38,790
0,210 210,330 330,420 420,720 720,780
see if it exists or

244
00:07:38,790 --> 00:07:40,260
0,270 270,750 780,990 990,1410 1410,1470
not,| because you know it
|因为它并不存在，

245
00:07:40,260 --> 00:07:42,360
0,240 240,750 1050,1800 1800,2010 2010,2100
doesn't exist,| basically set a
|就是设置一个 watch ，

246
00:07:42,360 --> 00:07:43,480
0,660
watch,|
|

247
00:07:47,420 --> 00:07:48,770
0,420 420,570 570,1020 1020,1140 1140,1350
and the idea is that
想法是， watch 会触发，

248
00:07:48,770 --> 00:07:50,660
0,90 90,270 270,390 390,1650 1680,1890
you know the watch will

249
00:07:50,660 --> 00:07:51,800
0,180 180,570 570,750 750,1020 1020,1140
go off,| if actually the
|如果文件消失了，

250
00:07:51,800 --> 00:07:55,310
0,360 360,1140 2100,2610 2610,3180 3180,3510
file disappears,| {} and if
|如果它消失了，

251
00:07:55,310 --> 00:07:56,420
0,60 60,540 540,870 870,960 960,1110
it disappears,| then you know
|客户端会收到通知，

252
00:07:56,420 --> 00:07:57,080
0,90 90,390 390,480 480,630 630,660
the client will get a

253
00:07:57,080 --> 00:07:59,300
0,780 780,900 900,1530 1680,2070 2070,2220
notification,| so basically we're going
|所以我们在这里要做的是

254
00:07:59,300 --> 00:08:00,380
0,90 90,210 210,450 450,840 840,1080
to be doing here is|
|

255
00:08:00,380 --> 00:08:01,640
0,180 180,390 390,480 480,630 630,1260
just wait for that notification.|
等待通知。|

256
00:08:09,390 --> 00:08:10,080
0,180 180,330 330,480 480,570 570,690
So that's sort of the
所以这是 acquire 操作，

257
00:08:10,080 --> 00:08:12,810
0,690 690,1410 1560,1890 1890,2010 2010,2730
acquire operation,| then the release
|然后 release 就很简单了。

258
00:08:13,410 --> 00:08:15,660
0,450 450,780 780,1380
is very simple.|
|

259
00:08:17,080 --> 00:08:18,370
0,240 240,570 570,960 960,1140 1140,1290
The release actually is that
release 基本上不做任何其他事情，

260
00:08:18,370 --> 00:08:20,020
0,210 210,480 480,810 810,1230 1260,1650
does nothing else| than sending
|只是发送 delete 操作到 zookeeper 服务，

261
00:08:20,020 --> 00:08:21,550
0,120 120,630 660,1260 1260,1440 1440,1530
the delete operation to the

262
00:08:21,550 --> 00:08:23,020
0,150 150,390 390,1050 1260,1350 1350,1470
{zookeeper -} service,| you know
|对于锁文件来说，

263
00:08:23,020 --> 00:08:24,280
0,150 150,240 240,780 780,960 960,1260
for the for the lock

264
00:08:24,280 --> 00:08:25,200
0,360
file,|
|

265
00:08:25,440 --> 00:08:26,400
0,240 240,330 330,720 720,780 780,960
so {lf -} in this
在这种情况下是 lf 。

266
00:08:26,400 --> 00:08:27,380
0,480
case.|
|

267
00:08:27,800 --> 00:08:28,850
0,360 360,450 450,630 630,780 780,1050
And so what does that
那么这是做什么，

268
00:08:28,850 --> 00:08:30,680
0,180 180,570 570,750 750,1080 1110,1830
do,| well if the delete
|如果 delete 发送给 zookeeper 服务，

269
00:08:30,680 --> 00:08:31,550
0,90 90,240 240,480 480,570 570,870
you know sent to the

270
00:08:31,550 --> 00:08:32,750
0,210 210,450 450,990 990,1050 1050,1200
{zookeeper -} service,| you know
|zookeeper 服务执行 delete 操作，

271
00:08:32,750 --> 00:08:34,280
0,270 270,450 450,720 720,1140 1140,1530
the {zookeeper -} service {}

272
00:08:34,340 --> 00:08:37,280
0,780 780,1410 1410,1710 1710,2310 2670,2940
perform {} delete operation,| that
|这将会让文件消失，

273
00:08:37,280 --> 00:08:40,490
0,180 180,750 900,1890 1950,2370 2370,3210
will actually, {} {that -}

274
00:08:40,490 --> 00:08:41,420
0,240 240,330 330,600 600,780 780,930
{that,make} the file would go

275
00:08:41,420 --> 00:08:43,340
0,600 720,1110 1110,1290 1290,1800 1800,1920
away,| that will fire to
|会通知 watch ，

276
00:08:43,340 --> 00:08:45,350
0,660 810,990 990,1170 1170,1410 1410,2010
watch,| and so every client
|所以每个在等待的客户端，

277
00:08:45,350 --> 00:08:46,670
0,180 180,450 450,540 540,1140 1140,1320
that actually is waiting,| you
|对于通知，

278
00:08:46,670 --> 00:08:48,920
0,150 150,900 900,1500 1500,1620 1620,2250
know for {} the notification,|
|

279
00:08:48,920 --> 00:08:50,450
0,90 90,270 270,300 300,1140 1380,1530
will get a notification,| and
将会收到一条通知，|然后它们会去重试，

280
00:08:50,450 --> 00:08:51,440
0,120 120,240 240,420 420,570 570,990
then {they -} go retry,|
|

281
00:08:52,100 --> 00:08:53,510
0,660 690,1020 1020,1110 1110,1200 1200,1410
and {} you know one
它们中的一个将在重试中成功，

282
00:08:53,510 --> 00:08:54,530
0,90 90,240 240,390 390,480 480,1020
of them will be successful

283
00:08:54,530 --> 00:08:55,430
0,90 90,180 180,660 660,750 750,900
in the retry,| will get
|将获取锁文件或创建锁文件，

284
00:08:55,430 --> 00:08:56,480
0,90 90,330 330,690 690,780 780,1050
the lock file or create

285
00:08:56,480 --> 00:08:57,680
0,60 60,300 300,810 870,1050 1050,1200
a lock file,| and then
|然后继续，

286
00:08:57,680 --> 00:08:59,000
0,480 660,810 810,930 930,1020 1020,1320
proceed,| and then the others
|然后其他的又回到那里，

287
00:08:59,000 --> 00:09:01,400
0,390 390,870 870,1260 1260,2100 2100,2400
one go back into {}

288
00:09:01,400 --> 00:09:04,190
0,450 660,1500 1530,1830 1830,2460 2490,2790
there,| {} call exists and
|调用 exists 并等待通知。

289
00:09:04,190 --> 00:09:05,360
0,120 120,210 210,510 510,1020 1020,1170
going to wait for {}

290
00:09:05,360 --> 00:09:06,560
0,720
notification.|
|

291
00:09:07,280 --> 00:09:09,440
0,570 660,1020 1020,1170 1170,1410 1410,2160
And the {zookeeper -} semantics
zookeeper 语义足够好，

292
00:09:09,440 --> 00:09:10,610
0,90 90,330 330,540 540,1020 1050,1170
you know good enough,| you
|对写操作的线性一致性，

293
00:09:10,610 --> 00:09:13,700
0,150 150,450 450,2550 2550,3000 3000,3090
know the strong {the,linearizability -

294
00:09:13,700 --> 00:09:15,860
0,420 420,570 570,840 840,1590 1650,2160
-} for write operations,| plus
|加上通知发出的规则，

295
00:09:15,860 --> 00:09:17,180
0,90 90,210 210,510 540,1110 1110,1320
you know the rules for

296
00:09:17,180 --> 00:09:18,800
0,210 210,840 840,990 990,1410 1470,1620
when notifications go off| are
|足够强，来实现一个[]锁，

297
00:09:18,800 --> 00:09:20,090
0,330 330,600 600,750 750,1110 1110,1290
strong enough, that basically this

298
00:09:20,090 --> 00:09:21,770
0,450 450,840 840,900 900,1320 1320,1680
actually implements a [] lock,|
|

299
00:09:21,950 --> 00:09:23,780
0,180 180,450 450,1110 1110,1680 1680,1830
where only one client,| if
只有一个客户端，|如果同时有多个客户端试图获取锁，

300
00:09:23,780 --> 00:09:24,590
0,120 120,180 180,330 330,720 720,810
there are many clients at

301
00:09:24,590 --> 00:09:25,340
0,60 60,300 300,510 510,690 690,750
the same time trying to

302
00:09:25,340 --> 00:09:26,270
0,150 150,240 240,480 480,690 690,930
get the lock,| only one
|只有一个会得到它。

303
00:09:26,270 --> 00:09:27,260
0,90 90,270 270,570
will get it.|
|

304
00:09:27,260 --> 00:09:29,360
0,420 420,810 810,1170 1350,1950 1950,2100
And when the release is
当 release 完成时，

305
00:09:29,360 --> 00:09:30,860
0,510 510,660 660,930 930,1140 1170,1500
done| or when the file
|或者当文件被删除时，

306
00:09:30,860 --> 00:09:32,330
0,120 120,270 270,810 870,1170 1170,1470
has been deleted,| only one
|在下一轮中只有一个能拿到它。

307
00:09:32,330 --> 00:09:33,440
0,90 90,150 150,570 600,990 990,1110
in the next round will

308
00:09:33,440 --> 00:09:34,380
0,150 150,420
get it.|
|

309
00:09:34,620 --> 00:09:35,940
0,510 660,960 960,1110 1110,1230 1230,1320
{} So that's sort of
所以这有点酷，

310
00:09:35,940 --> 00:09:38,220
0,570 960,1500 1500,1680 1680,1830 1830,2280
cool,| {} and it's interesting,|
|它是有趣的，|

311
00:09:38,220 --> 00:09:39,900
0,150 150,270 270,570 570,1110 1140,1680
that you could build {}
你可以构建某种基础原语，

312
00:09:39,900 --> 00:09:40,860
0,90 90,150 150,360 360,690 720,960
you know sort of sort

313
00:09:40,860 --> 00:09:42,900
0,120 120,270 270,1020 1020,1620 1710,2040
of the foundational primitive| on
|使用 zookeeper 提供的原语。

314
00:09:42,900 --> 00:09:44,460
0,240 240,330 330,810 810,1110 1110,1560
using the primitives that the

315
00:09:44,460 --> 00:09:46,080
0,180 180,540 540,1140
{zookeeper -} offers.|
|

316
00:09:46,280 --> 00:09:47,300
0,360 360,450 450,600 600,750 750,1020
And you see here, both
你看这两个角色，

317
00:09:47,300 --> 00:09:49,220
0,90 90,630 660,1170 1170,1620 1740,1920
the role,| of the you
|watch 和第二个角色 ephemeral ，

318
00:09:49,220 --> 00:09:51,230
0,180 180,480 510,720 720,1380 1590,2010
know the the watch and

319
00:09:51,230 --> 00:09:52,250
0,180 180,390 390,480 480,750 750,1020
then there's the second role

320
00:09:52,250 --> 00:09:53,120
0,120 120,240 240,660 660,750 750,870
for the ephemeral,| you know
|ephemeral 在这里，

321
00:09:53,120 --> 00:09:55,280
0,420 510,1170 1170,1350 1350,1650 1650,2160
the ephemeral is there,| because,
|因为，如果客户端失败或崩溃，

322
00:09:55,460 --> 00:09:57,050
0,450 450,900 900,1320 1320,1530 1530,1590
{} what happens if a

323
00:09:57,050 --> 00:09:59,450
0,720 900,1500 1500,1590 1590,2040 2040,2400
client fails or crash,| before
|在它调用 release 之前，

324
00:09:59,450 --> 00:10:01,370
0,90 90,330 330,390 390,990 1230,1920
it calls {} release,| and
|ephemeral 文件的语义，

325
00:10:01,490 --> 00:10:03,140
0,540 540,1080 1080,1170 1170,1290 1290,1650
the semantics of the ephemeral

326
00:10:03,140 --> 00:10:05,060
0,600 600,1050 1050,1290 1290,1530 1530,1920
files,| that {zookeeper -} service
|zookeeper 服务将会，

327
00:10:05,060 --> 00:10:06,560
0,570 780,930 930,1020 1020,1410 1410,1500
will,| if it decides that
|如果它确定客户端已经崩溃，

328
00:10:06,560 --> 00:10:07,430
0,60 60,330 330,450 450,810 810,870
the client has crashed,| it
|它会执行操作，

329
00:10:07,430 --> 00:10:09,740
0,330 360,840 840,990 990,1800 1950,2310
will do the operation, {}|
|

330
00:10:09,740 --> 00:10:11,270
0,150 150,420 420,840 840,930 930,1530
it will remove the file
它将删除代表客户端的文件，

331
00:10:11,390 --> 00:10:13,250
0,270 270,840 840,990 990,1350 1350,1860
on behalf of the client,|
|

332
00:10:13,340 --> 00:10:14,630
0,210 210,570 570,720 720,780 780,1290
so even if the client
所以，即使客户端出现故障或崩溃，

333
00:10:15,140 --> 00:10:17,240
0,510 510,630 630,1320 1620,1950 1950,2100
fails or crashes,| {zookeeper -}
|zookeeper 服务[]，

334
00:10:17,240 --> 00:10:18,500
0,360 360,450 450,990 990,1110 1110,1260
service the [site],| at some
|某个时刻，客户端掉线，

335
00:10:18,500 --> 00:10:19,910
0,300 300,420 420,750 750,840 840,1410
point the client is down,|
|

336
00:10:20,060 --> 00:10:21,530
0,360 360,510 510,660 660,1230 1320,1470
and that will remove the
这将删除文件锁 f ，

337
00:10:21,530 --> 00:10:23,090
0,330 330,570 570,990 1050,1320 1320,1560
file lock f,| which will
|这将导致发送通知

338
00:10:23,090 --> 00:10:24,710
0,480 480,1110 1110,1200 1200,1290 1290,1620
cause notifications to be sent|
|

339
00:10:24,710 --> 00:10:25,850
0,90 90,360 360,780 780,1050 1050,1140
to other clients actually are
到等待它的其他客户端。

340
00:10:25,850 --> 00:10:26,900
0,270 270,540 540,720
waiting for it.|
|

341
00:10:27,450 --> 00:10:29,730
0,360 360,750 870,1140 1140,1500 1500,2280
{} So, {} it's a
所以，这是一组很酷的原语，

342
00:10:29,730 --> 00:10:31,260
0,450 450,660 660,720 720,1230 1230,1530
cool set of primitives| to
|构建在应用程序中有用的强大[抽象]。

343
00:10:31,260 --> 00:10:33,240
0,450 450,720 720,1110 1110,1680 1680,1980
build {} powerful abstraction that

344
00:10:33,240 --> 00:10:34,680
0,150 150,240 240,540 540,630 630,1440
can be useful in applications.|
|

345
00:10:35,870 --> 00:10:37,670
0,300 300,870 870,990 990,1230 1230,1800
One downside of this particular
这个实现的一个缺点是，

346
00:10:37,670 --> 00:10:39,180
0,930
implementation

347
00:10:39,240 --> 00:10:41,700
0,630 630,1110 1110,1590 1860,2100 2100,2460
{} is that,| it has
|它具有所谓的羊群效应，

348
00:10:41,700 --> 00:10:43,110
0,240 240,480 480,510 510,840 840,1410
what's called a herding effect,|
|

349
00:10:43,470 --> 00:10:45,780
0,960 990,1710 1710,1830 1830,2160 2160,2310
{} namely {you,know} let's say
也就是说，假设你有一千个客户端，

350
00:10:45,780 --> 00:10:46,860
0,120 120,240 240,300 300,660 660,1080
you have a thousand clients,|
|

351
00:10:46,860 --> 00:10:48,630
0,240 240,390 390,660 720,1320 1320,1770
{you,know} want to go grab
想要获取锁文件或创建锁文件，

352
00:10:48,630 --> 00:10:49,950
0,360 360,720 720,990 990,1110 1110,1320
the lock file or make

353
00:10:49,950 --> 00:10:51,750
0,90 90,330 330,720 720,1290 1290,1800
the lock file,| {acquire,the} lock,|
|获取锁，|

354
00:10:51,960 --> 00:10:53,370
0,690 810,960 960,1200 1200,1290 1290,1410
{you,know} {} one is going
一个会成功，

355
00:10:53,370 --> 00:10:55,170
0,90 90,840 990,1170 1350,1560 1560,1800
to succeed,| and {999 -
|999 将调用 exists 并等待通知，

356
00:10:55,170 --> 00:10:56,610
0,480 480,690 690,810 810,900 900,1440
-} are going to call

357
00:10:56,640 --> 00:10:58,440
0,540 540,1080 1080,1410 1410,1680 1680,1800
{} exists and wait for

358
00:10:58,440 --> 00:10:59,640
0,60 60,750
{} notification,|
|

359
00:10:59,700 --> 00:11:01,680
0,300 300,690 690,870 870,1500 1770,1980
then when the first {}
然后当第一个客户端删除文件或释放文件锁时，

360
00:11:01,680 --> 00:11:03,660
0,690 720,1170 1170,1290 1290,1740 1740,1980
client deletes the file or

361
00:11:03,660 --> 00:11:06,150
0,390 390,480 480,780 780,1200 2280,2490
releases the file lock,| {999
|999 将尝试获取锁，

362
00:11:06,150 --> 00:11:06,960
0,210 210,510 510,630 630,750 750,810
- -} are going to

363
00:11:06,960 --> 00:11:09,270
0,450 570,840 840,1080 1080,1470 1470,2310
try {} to actually acquire

364
00:11:09,540 --> 00:11:10,600
0,150 150,570
the lock,|
|

365
00:11:10,750 --> 00:11:11,770
0,330 330,450 450,660 660,840 840,1020
and of course only one
当然，只有一个会成功，

366
00:11:11,770 --> 00:11:12,670
0,90 90,210 210,270 270,690 690,900
is going to succeed,| {and,998
|998 将会等待通知，

367
00:11:12,670 --> 00:11:13,990
0,840 840,930 930,1050 1050,1170 1170,1320
-} are going to be

368
00:11:13,990 --> 00:11:16,210
0,270 270,390 390,450 450,1020 1800,2220
sitting for a notification,| but
|但你知道这个，

369
00:11:16,420 --> 00:11:18,400
0,330 330,630 630,1170 1200,1650 1650,1980
you know the {} this,|
|

370
00:11:18,400 --> 00:11:19,510
0,150 150,330 330,750 750,900 900,1110
you know every sort of
每一个随机消失，

371
00:11:19,510 --> 00:11:21,220
0,420 420,990 990,1050 1050,1440 1440,1710
random disappearance,| a huge amount
|会产生巨大的流量，

372
00:11:21,220 --> 00:11:23,770
0,60 60,540 690,1530 1560,2130 2160,2550
of traffic,| {} and {}
|基本上就是轰炸 zookeeper 服务器，

373
00:11:23,770 --> 00:11:25,390
0,150 150,270 270,660 660,1350 1350,1620
you know basically bombarding {you,know}

374
00:11:25,390 --> 00:11:27,520
0,90 90,270 270,570 570,900 1830,2130
the {zookeeper -} server,| {999
|999 尝试重新执行，

375
00:11:27,520 --> 00:11:29,230
0,870 870,1170 1170,1290 1290,1500 1500,1710
- -} to try to

376
00:11:29,230 --> 00:11:30,970
0,330 330,420 420,1020 1110,1260 1260,1740
do it again,| you know
|除了一个，所有都会失败。

377
00:11:30,970 --> 00:11:33,190
0,360 360,480 480,840 840,1320 1680,2220
all but one are {}

378
00:11:33,190 --> 00:11:34,260
0,150 150,330 330,690
are gonna fail.|
|

379
00:11:34,610 --> 00:11:35,810
0,240 240,570 660,930 930,990 990,1200
And so that's a little
所以这是不受欢迎的性质，这种羊群效应，

380
00:11:35,810 --> 00:11:38,510
0,120 120,210 210,1440 1440,2010 2010,2700
bit of undesirable property, {}

381
00:11:38,510 --> 00:11:40,490
0,0 0,480 480,750 750,1200 1560,1980
{} this herding effect, {}|
|

382
00:11:40,490 --> 00:11:41,630
0,330 330,480 480,600 600,810 810,1140
and it's a real problem
这在实践中是一个真正的问题，

383
00:11:41,630 --> 00:11:42,800
0,120 120,630 630,720 720,840 840,1170
in practice,| you know move
|在小规模的多核机器上移动，

384
00:11:42,800 --> 00:11:45,170
0,480 510,1110 1350,1740 1740,2100 2100,2370
on a small scale {multi-core

385
00:11:45,170 --> 00:11:46,580
0,270 270,780 780,960 960,1290 1290,1410
-} machines| as well as
|当然还有像这样的设置，

386
00:11:46,580 --> 00:11:47,810
0,420 420,600 600,840 840,990 990,1230
{of,course} {} setting like this,|
|

387
00:11:47,810 --> 00:11:49,700
0,420 420,810 810,1410 1410,1560 1560,1890
where network messages are not
网络消息不是免费的。

388
00:11:49,700 --> 00:11:50,560
0,390
free.|
|

389
00:11:51,390 --> 00:11:52,980
0,180 180,300 300,690 690,1140 1290,1590
So it's interesting that, actually
所以，有趣的是， zookeeper 提供了足够的原语，

390
00:11:52,980 --> 00:11:54,060
0,180 180,450 450,750 750,810 810,1080
{zookeeper -} provides {} enough

391
00:11:54,060 --> 00:11:55,080
0,480 480,570 570,690 690,810 810,1020
primitives,| that you could actually
|你可以做得更好，

392
00:11:55,080 --> 00:11:56,070
0,90 90,450 450,480 480,660 660,990
do quite a bit better,|
|

393
00:11:56,070 --> 00:11:56,820
0,150 150,240 240,330 330,540 540,750
and you can actually build
你可以创建一个锁，

394
00:11:56,820 --> 00:11:58,320
0,60 60,570 660,840 840,1110 1110,1500
a lock,| that doesn't have
|不会受到羊群效应的影响。

395
00:11:58,320 --> 00:12:00,420
0,360 360,540 540,630 630,1170 1200,2100
suffered from the herding effect.|
|

396
00:12:01,310 --> 00:12:03,460
0,450 450,570 570,900 900,1350
So a better lock,|
所以更好的锁，|

397
00:12:08,950 --> 00:12:10,330
0,510 510,660 660,780 780,1230 1230,1380
and it's very interesting,| let
它是非常有趣的，|让我找出这个的伪代码，

398
00:12:10,330 --> 00:12:11,770
0,300 300,600 630,900 900,1020 1020,1440
me a pull out the

399
00:12:13,420 --> 00:12:15,120
0,390 390,630 630,720 720,1140
pseudo code for this,|
|

400
00:12:15,180 --> 00:12:16,260
0,180 180,300 300,420 420,480 480,1080
which is in the paper,|
在论文中，|

401
00:12:16,290 --> 00:12:17,430
0,270 270,480 480,600 600,750 750,1140
{} so we can look
这样我们就能看到它了，

402
00:12:17,430 --> 00:12:18,380
0,120 120,360
at it,|
|

403
00:12:18,730 --> 00:12:20,110
0,150 150,660 660,750 750,900 900,1380
and discuss you know why
并讨论为什么这个锁更好，

404
00:12:20,110 --> 00:12:20,830
0,120 120,210 210,390 390,600 600,720
you know this lock is

405
00:12:20,830 --> 00:12:23,140
0,420 1110,1560 1560,2070 2070,2190 2190,2310
better,| and particularly what we'll
|我们看到的是这个锁更好，

406
00:12:23,140 --> 00:12:24,130
0,360 360,480 480,660 660,810 810,990
see is that this lock

407
00:12:24,130 --> 00:12:25,540
0,90 90,420 420,720 720,1140 1140,1410
is better,| because basically there's
|因为这里没有重试，

408
00:12:25,540 --> 00:12:26,840
0,750
no,

409
00:12:26,840 --> 00:12:29,780
0,300 300,570 570,1290 1290,1860 2100,2940
there's no retry,| where all
|所有未成功获取锁的客户端都将重试获取，

410
00:12:29,810 --> 00:12:31,460
0,420 420,570 570,840 840,1410 1410,1650
clients that didn't succeed getting

411
00:12:31,460 --> 00:12:33,050
0,120 120,570 690,1170 1170,1500 1500,1590
the lock will retry to

412
00:12:33,050 --> 00:12:34,400
0,210 210,300 300,690 720,1260 1260,1350
try to get,| instead {you,know}
|相反，所有的客户端都排成一条线，

413
00:12:34,400 --> 00:12:36,290
0,660 870,1260 1260,1440 1440,1500 1500,1890
basically the all the clients

414
00:12:36,290 --> 00:12:37,700
0,60 60,240 240,300 300,630 630,1410
are sort of for {a,line},|
|

415
00:12:37,850 --> 00:12:39,290
0,300 300,690 690,1080 1080,1260 1260,1440
{} and {} they get
它们可以一个接一个地获取锁。

416
00:12:39,290 --> 00:12:40,280
0,60 60,300 300,540 540,660 660,990
the lock one by one.|
|

417
00:12:40,900 --> 00:12:42,220
0,330 330,420 420,870 870,960 960,1320
And the way you know
你可以 zookeeper 原语编程的方式，

418
00:12:42,220 --> 00:12:43,390
0,270 270,390 390,480 480,960 960,1170
that you can program that

419
00:12:43,390 --> 00:12:45,580
0,240 240,690 690,1350 1560,2070 2070,2190
using zookeeper's primitives| as in
|像这个伪代码一样。

420
00:12:45,580 --> 00:12:47,480
0,150 150,720 720,990 990,1410
this particular pseudo code.|
|

421
00:12:47,740 --> 00:12:48,340
0,240 240,330 330,360 360,390 390,600
And there are a couple
这与上一个有些不同，

422
00:12:48,340 --> 00:12:50,470
0,720 810,1260 1260,1740 1740,2070 2070,2130
differences that {} compared to

423
00:12:50,470 --> 00:12:52,360
0,90 90,420 420,840 1260,1680 1680,1890
the previous one,| {} first
|首先，这个，

424
00:12:52,360 --> 00:12:54,240
0,120 120,570 660,1320
of all, the,|
|

425
00:12:54,780 --> 00:12:56,120
0,390 390,810

426
00:12:56,180 --> 00:12:57,800
0,390 390,510 510,930 930,1530 1530,1620
there's an additional flag {you,know}
这有一个额外的传递给 create 的标志，即 SEQUENTIAL ，

427
00:12:57,800 --> 00:13:00,200
0,510 510,630 630,1140 1140,1650 1650,2400
pass to create, namely SEQUENTIAL,|
|

428
00:13:00,560 --> 00:13:02,030
0,180 180,450 450,930 930,1260 1260,1470
{} which basically means that,|
这意味着，|

429
00:13:02,030 --> 00:13:03,980
0,60 60,1230 1260,1500 1500,1770 1770,1950
as {} these files are
当创建这些文件时，

430
00:13:03,980 --> 00:13:05,810
0,510 540,600 600,1170 1200,1440 1440,1830
created,| the {} lock file
|锁文件被创建，

431
00:13:05,810 --> 00:13:06,650
0,120 120,510 510,630 630,690 690,840
is created,| but it will
|但它将被创建为，第一个将是 lock-0 ，

432
00:13:06,650 --> 00:13:08,720
0,120 120,480 480,750 1710,1860 1860,2070
be created as, the first

433
00:13:08,720 --> 00:13:09,560
0,210 210,360 360,450 450,600 600,840
one, it will be {lock-0

434
00:13:09,560 --> 00:13:10,910
0,600 630,870 870,930 930,1110 1110,1350
-},| then the next one
|下一个将是 lock-1 ，依此类推。

435
00:13:10,910 --> 00:13:12,980
0,180 180,270 270,540 540,1080 1320,2070
will be {lock-1 -}, etc.|
|

436
00:13:16,920 --> 00:13:17,910
0,180 180,240 240,390 390,660 660,990
So {} we have like
所以，我们有一千个客户端

437
00:13:17,910 --> 00:13:19,680
0,180 180,480 480,870 870,1500 1500,1770
a thousand clients| rushing {you,know}
|争先恐后地到服务上试图获取锁，

438
00:13:19,680 --> 00:13:20,820
0,150 150,270 270,690 690,810 810,1140
to the service to actually

439
00:13:20,820 --> 00:13:22,170
0,210 210,330 330,840 840,930 930,1350
try to acquire to lock,|
|

440
00:13:22,260 --> 00:13:23,910
0,750 750,870 870,1200 1200,1530 1530,1650
basically a thousand files will
基本上会创建一千个文件，

441
00:13:23,910 --> 00:13:25,650
0,150 150,630 660,1230 1230,1590 1590,1740
be created,| all numbered from
|所有的数字是从 0 到 999 。

442
00:13:25,650 --> 00:13:27,960
0,360 360,720 750,1470 1470,1770
0 to {999 -}.|
|

443
00:13:28,750 --> 00:13:31,600
0,690 870,1680 1800,2280
Then, {} so.|
然后，那么。|

444
00:13:31,600 --> 00:13:32,920
0,360 360,510 510,900 900,1230 1230,1320
So, I'll succeed creating a
所以，我将成功创建一个文件，

445
00:13:32,920 --> 00:13:35,830
0,450 480,1230 1260,1890 1890,2310 2310,2910
file,| {} the creator returns
|创建者返回你得到的数字，

446
00:13:35,830 --> 00:13:39,490
0,450 450,750 780,1500 1800,2640 2730,3660
actually the number that that

447
00:13:39,490 --> 00:13:40,360
0,150 150,450 450,630 630,780 780,870
you got,| so if the
|所以如果客户端 0 ，

448
00:13:40,360 --> 00:13:41,620
0,330 330,780 780,930 930,1020 1020,1260
client 0,| if the first
|如果第一个客户端创建了 lock-0 ，

449
00:13:41,620 --> 00:13:43,870
0,300 300,510 510,990 1260,1950 1950,2250
client gets {you,know} lock, creates

450
00:13:43,870 --> 00:13:45,490
0,210 210,810 900,1380 1380,1500 1500,1620
{lock-0 -},| then it will
|那么它将获得 0 ，

451
00:13:45,490 --> 00:13:46,930
0,210 210,570 570,990 1020,1350 1350,1440
get 0 back,| and the
|第二个将得到 1 ，依此类推。

452
00:13:46,930 --> 00:13:48,010
0,240 240,360 360,540 540,810 810,1080
second will get 1 back,

453
00:13:48,010 --> 00:13:49,160
0,330 330,750
etc, etc.|
|

454
00:13:49,780 --> 00:13:50,890
0,510 510,600 600,690 690,930 930,1110
Then you know the pseudo
然后伪代码要求，

455
00:13:50,890 --> 00:13:52,720
0,150 150,540 540,1020 1020,1290 1290,1830
code basically ask| {you,know} to
|获取这个目录中的所有子项，

456
00:13:52,780 --> 00:13:54,040
0,270 270,480 480,600 600,1110 1110,1260
get all the children in

457
00:13:54,040 --> 00:13:55,990
0,390 390,1200 1230,1500 1500,1830 1830,1950
that directory| {you,know} which you
|那些文件被创建的，

458
00:13:55,990 --> 00:13:57,100
0,90 90,270 270,540 540,600 600,1110
know these files are created,|
|

459
00:13:57,130 --> 00:13:57,970
0,270 270,390 390,450 450,600 600,840
and so in this case,|
所以在这种情况下，|

460
00:13:57,970 --> 00:13:58,600
0,210 210,330 330,420 420,570 570,630
maybe that would be a
可能有一千个子节点，一千个 znode ，

461
00:13:58,600 --> 00:14:01,150
0,510 960,1620 1620,2160 2160,2250 2250,2550
thousand {} children and thousand

462
00:14:01,150 --> 00:14:03,190
0,150 150,690 1050,1560 1560,1740 1740,2040
{znodes -},| {} and then
|然后你可以查看 n ，

463
00:14:03,190 --> 00:14:04,180
0,150 150,240 240,390 390,690 720,990
you can just look at

464
00:14:04,180 --> 00:14:05,420
0,300 330,810
the n,|
|

465
00:14:05,480 --> 00:14:08,210
0,1260 1500,1800 1800,1950 1950,2280 2280,2730
and see if your n,|
看看你的 n ，|

466
00:14:08,270 --> 00:14:09,350
0,240 240,390 390,600 600,930 930,1080
in this case, 0 is
在这种情况下， 0 是要查看的最小 znode ，

467
00:14:09,350 --> 00:14:11,240
0,90 90,420 420,720 720,1320 1410,1890
the lowest znode {to,see}, {}|
|

468
00:14:11,240 --> 00:14:12,230
0,120 120,210 210,480 480,540 540,990
and if that's the case,
如果是这样的话，就意味着你拿到了锁。

469
00:14:12,260 --> 00:14:12,950
0,180 180,360 360,450 450,630 630,690
that means you got the

470
00:14:12,950 --> 00:14:13,880
0,420
lock.|
|

471
00:14:13,880 --> 00:14:14,720
0,240 240,330 330,450 450,600 600,840
And so that makes total
所以这完全有道理，

472
00:14:14,720 --> 00:14:15,740
0,300 300,450 450,510 510,750 750,1020
sense,| but the first line
|第一行得到了 0 ，

473
00:14:15,740 --> 00:14:17,780
0,210 210,660 660,1080 1080,1530 1740,2040
gets actually 0 back, {}|
|

474
00:14:17,780 --> 00:14:18,620
0,180 180,270 270,420 420,720 720,840
all the other clients have
所有其他客户端都有更高的数字，

475
00:14:18,620 --> 00:14:19,580
0,60 60,330 330,660 660,870 870,960
a higher number,| because {they're
|因为它们是按顺序编号的，

476
00:14:19,580 --> 00:14:21,200
0,120 120,210 210,510 510,960 1260,1620
-} {sequentially -} numbered,| and
|所以，第一个客户端将成功地获得它，

477
00:14:21,200 --> 00:14:22,310
0,330 330,570 570,780 780,1020 1020,1110
so the first client will

478
00:14:22,310 --> 00:14:23,270
0,330 330,420 420,660 660,810 810,960
succeed in getting it,| and
|而所有其他，它们要做的是，

479
00:14:23,270 --> 00:14:24,320
0,120 120,210 210,360 360,840 870,1050
all the other ones, what

480
00:14:24,320 --> 00:14:26,240
0,120 120,300 300,600 600,1110 1380,1920
they're gonna do is, {}|
|

481
00:14:26,420 --> 00:14:28,280
0,360 360,480 480,1020 1050,1440 1440,1860
{they're,going} to look at,| they're
它们会查看，|它们会找到 p ，

482
00:14:28,280 --> 00:14:29,420
0,120 120,180 180,390 390,480 480,1140
going to find the p,|
|

483
00:14:29,810 --> 00:14:30,830
0,300 300,480 480,840 840,930 930,1020
{you,know} the number that is
这个数字正好在它前面，

484
00:14:30,830 --> 00:14:31,760
0,270 270,360 360,570 570,660 660,930
right in front of there,|
|

485
00:14:31,790 --> 00:14:32,900
0,270 270,360 360,840 840,960 960,1110
so for example if this
例如，如果这是客户端，

486
00:14:32,900 --> 00:14:34,610
0,120 120,630 1050,1290 1290,1500 1500,1710
is client,| {} that got
|它获得 lock-10 ，

487
00:14:34,610 --> 00:14:36,320
0,450 450,570 570,810 810,1230 1230,1710
back you know {lock-10 -},|
|

488
00:14:36,410 --> 00:14:37,190
0,150 150,270 270,330 330,690 690,780
it's going to look you
它将查找 znode 9 ， lock-9 ，

489
00:14:37,190 --> 00:14:39,380
0,210 210,870 900,1110 1110,1470 1470,2190
know for {} znode 9

490
00:14:39,380 --> 00:14:40,820
0,180 180,450 450,960 1020,1170 1170,1440
{you,know} {lock-9 -},| and basically
|在那个文件上放一个 watch ，

491
00:14:40,820 --> 00:14:41,840
0,150 150,240 240,690 690,780 780,1020
put a watch on that

492
00:14:41,840 --> 00:14:42,720
0,420
file,|
|

493
00:14:45,760 --> 00:14:46,900
0,150 150,330 330,660 660,840 840,1140
so this means that every
这意味着每个客户端都有一个 watch 在它的前一个节点，

494
00:14:46,900 --> 00:14:48,880
0,660 930,1350 1350,1710 1710,1890 1890,1980
client {} will have a

495
00:14:48,880 --> 00:14:50,680
0,420 420,900 900,1080 1080,1230 1230,1800
watch basically on its predecessor,|
|

496
00:14:50,770 --> 00:14:52,120
0,420 420,690 690,870 870,960 960,1350
so it goes to see
所以所有的客户都排成一条线，

497
00:14:52,120 --> 00:14:53,290
0,390 390,570 570,630 630,930 930,1170
that's all the clients form

498
00:14:53,290 --> 00:14:56,420
0,60 60,660 960,1920 1950,2610
a line,| and {}
|然后，客户端等待通知发出。

499
00:14:56,420 --> 00:14:57,590
0,180 180,630 630,690 690,1020 1020,1170
and then {you,know,the} client just

500
00:14:57,590 --> 00:14:59,690
0,510 540,1200 1200,1290 1290,1530 1530,2100
gonna wait for that notification

501
00:14:59,690 --> 00:15:00,820
0,60 60,180 180,570
to go off.|
|

502
00:15:00,850 --> 00:15:02,170
0,420 420,570 570,810 810,1140 1140,1320
And so that means for
这意味着，例如，当客户端 0 得到 0 ，

503
00:15:02,170 --> 00:15:03,790
0,360 360,600 600,900 900,1470 1500,1620
example when client 0 you

504
00:15:03,790 --> 00:15:05,110
0,180 180,330 330,600 600,930 930,1320
know we got 0 back,|
|

505
00:15:05,110 --> 00:15:06,460
0,90 90,360 360,780 810,1230 1230,1350
you know {} releases the
释放锁，

506
00:15:06,460 --> 00:15:07,960
0,330 360,570 570,750 750,1080 1080,1500
lock,| it will delete n,|
|它将删除 n ，|

507
00:15:08,470 --> 00:15:09,520
0,360 360,570 570,750 750,960 960,1050
{} this will get a
文件 1 将收到通知发出，

508
00:15:09,520 --> 00:15:10,990
0,690 690,750 750,960 960,1260 1260,1470
notification to go off for

509
00:15:10,990 --> 00:15:12,860
0,120 120,570 570,1230
the file one,|
|

510
00:15:13,010 --> 00:15:14,000
0,270 270,360 360,450 450,870 870,990
and so the client is
所以，客户端正在等待该通知，

511
00:15:14,000 --> 00:15:15,140
0,240 240,540 540,660 660,840 840,1140
actually waiting for that particular

512
00:15:15,140 --> 00:15:19,010
0,720 720,1110 1110,1110 2100,3120 3360,3870
notification,| then will run,| but
|然后运行，|但它是唯一可以运行的，

513
00:15:19,010 --> 00:15:20,000
0,180 180,300 300,630 630,810 810,990
it's the only one that

514
00:15:20,000 --> 00:15:23,570
0,540 840,1650 1680,3270 3270,3420 3420,3570
runs,| and a it will
|而且它会成功。

515
00:15:23,570 --> 00:15:24,520
0,480
succeed.|
|

516
00:15:25,330 --> 00:15:26,440
0,300 300,420 420,660 660,750 750,1110
And so here we see,|
所以我们在这里看到，|

517
00:15:26,440 --> 00:15:27,580
0,120 120,300 300,480 480,570 570,1140
you know this is sometimes
这有时是一种更简单的锁，称为标签锁，

518
00:15:27,580 --> 00:15:28,960
0,300 300,510 510,600 600,1080 1080,1380
easier type of {locks\,,called} ticket

519
00:15:28,960 --> 00:15:30,060
0,540
locks,|
|

520
00:15:30,640 --> 00:15:32,500
0,480 510,780 780,1080 1080,1350 1350,1860
in {} {multi-core -} programming,|
在多核编程中，|

521
00:15:32,500 --> 00:15:33,520
0,120 120,210 210,570 570,660 660,1020
if you're familiar with them,|
如果你对它们很熟悉，|

522
00:15:33,670 --> 00:15:34,210
0,120 120,240 240,330 330,480 480,540
and they are sort of
它们在某种程度上与标签锁是相同的想法，

523
00:15:34,210 --> 00:15:36,700
0,90 90,450 450,1740 1740,2160 2160,2490
the same {} same idea

524
00:15:36,700 --> 00:15:38,080
0,300 300,540 540,900 900,1170 1170,1380
of ticket locks,| actually you're
|你将使用 zookeeper 原语构建这个。

525
00:15:38,080 --> 00:15:40,450
0,600 600,1050 1050,1500 1590,2130 2130,2370
building into this, {} using

526
00:15:40,450 --> 00:15:42,280
0,180 180,750 780,1440
{zookeeper -} primitives.|
|

527
00:15:42,580 --> 00:15:44,260
0,540 540,750 750,840 840,1380 1380,1680
Again, what is interesting about
再说一次，有趣的是，

528
00:15:44,260 --> 00:15:45,790
0,90 90,300 300,570 930,1440 1440,1530
it is that,| {} you
|这些原语足够强大，

529
00:15:45,790 --> 00:15:46,900
0,60 60,210 210,600 600,690 690,1110
know these primitives are powerful

530
00:15:46,900 --> 00:15:47,680
0,270 270,390 390,450 450,570 570,780
enough,| that you can actually
|你可以创建这种锁。

531
00:15:47,680 --> 00:15:48,850
0,240 240,390 390,540 540,600 600,1170
build these kind of locks.|
|

532
00:15:51,260 --> 00:15:52,860
0,210 210,510 510,720 720,1110
Any questions about this?|
对于这个，有什么问题吗？|

533
00:15:57,840 --> 00:15:58,440
0,210 210,240 240,390 390,450 450,600
Okay, I want to make
好的，关于这些锁，我想再说一句，

534
00:15:58,440 --> 00:16:00,570
0,300 300,510 510,1020 1080,1500 1500,2130
one more comment {you,know,about} the

535
00:16:00,600 --> 00:16:03,300
0,210 210,810 1020,1770 1770,2100 2100,2700
these locks,| before moving onto
|在进入链式复制之前。

536
00:16:03,300 --> 00:16:05,520
0,780 810,1050 1050,1140 1140,1770 2040,2220
{} chain {} replication.| We
|我们在聊天中有一个问题。

537
00:16:05,520 --> 00:16:06,090
0,90 90,150 150,450 450,510 510,570
have a question in the

538
00:16:06,090 --> 00:16:07,710
0,450 600,990 990,1290 1290,1530 1530,1620
chat.| Yeah, okay, what's the
|好的，聊天中的问题是什么？

539
00:16:07,710 --> 00:16:09,270
0,450 450,720 720,960 960,1110 1110,1560
question {in,chat}?| What is the
|第 4 行的 watch 是做什么的？

540
00:16:09,300 --> 00:16:11,550
0,600 810,1320 1320,1530 1530,1800 1800,2250
watch for on line 4?|
|

541
00:16:12,140 --> 00:16:14,240
0,540 570,810 810,1380 1770,1920 1920,2100
Good, go back, on this
好的，回去，在这个第 4 行吗？

542
00:16:14,240 --> 00:16:16,060
0,270 270,540 540,990
one line 4?|
|

543
00:16:17,480 --> 00:16:18,140
0,240 240,330 330,450 450,600 600,660
Yeah, I think that's the
是的，我想这就是问题。

544
00:16:18,140 --> 00:16:19,120
0,420
question.|
|

545
00:16:19,580 --> 00:16:21,980
0,510 510,1620 1620,1680 1680,2040 2040,2400
Yeah, well, { -} that
好的，这个 watch ，我的注释，

546
00:16:21,980 --> 00:16:23,210
0,390 390,720 720,1080 1080,1170 1170,1230
watch my comment,| {} the
|这个 watch 应该在第 5 行，

547
00:16:23,210 --> 00:16:24,590
0,300 300,510 510,690 690,930 930,1380
watch actually should go with

548
00:16:24,710 --> 00:16:26,440
0,30 390,690 690,1230
{you,know} line 5,|
|

549
00:16:26,500 --> 00:16:27,850
0,210 210,390 390,630 630,1020 1020,1350
so there's no watch {on,line}
所以在第 4 行没有 watch ，

550
00:16:27,850 --> 00:16:29,440
0,300 330,690
4, right,|
|

551
00:16:29,590 --> 00:16:31,270
0,510 540,930 930,1080 1080,1260 1260,1680
{} line 4 just finds
第 4 行只是查找 p ，你的 n 之前的数字，

552
00:16:31,270 --> 00:16:32,410
0,390 390,480 480,600 600,720 720,1140
p, you know the numbers

553
00:16:32,410 --> 00:16:34,680
0,270 270,870 900,1380 1380,1680
right before your n,|
|

554
00:16:39,850 --> 00:16:40,660
0,210 210,360 360,570 570,750 750,810
if that doesn't answer the
如果这没有回答问题，

555
00:16:40,660 --> 00:16:41,740
0,390 390,660 660,840 840,960 960,1080
question,| please, if you come
|你可以晚点再提问，也可以。

556
00:16:41,740 --> 00:16:42,880
0,240 240,480 480,660 660,810 810,1140
back later and that's fine.|
|

557
00:16:43,570 --> 00:16:45,910
0,450 450,600 600,1080 1080,1650 1800,2340
Actually, {I,have} another question.| Yeah.|
事实上，我还有一个问题。|嗯。|

558
00:16:45,910 --> 00:16:46,780
0,180 180,300 300,480 480,750 750,870
This is going actually I
我想回退几张幻灯片，

559
00:16:46,780 --> 00:16:48,040
0,180 180,420 420,510 510,750 750,1260
think back a few slides,|
|

560
00:16:48,040 --> 00:16:49,570
0,300 360,570 570,780 780,1020 1020,1530
but how does {zookeeper -}
但是 zookeeper 如何确定客户失败，

561
00:16:49,570 --> 00:16:51,040
0,570 570,840 870,960 960,1320 1320,1470
determine that a client has

562
00:16:51,040 --> 00:16:52,480
0,390 390,540 540,840 840,1290 1290,1440
failed,| and thus release the
|从而释放 ephemeral 锁，

563
00:16:52,480 --> 00:16:54,790
0,480 480,960 1260,1560 1560,1830 1830,2310
ephemeral lock,| {like -} often,
|比如通常只是短暂出现分区。

564
00:16:54,850 --> 00:16:56,380
0,240 240,570 570,750 750,1350 1350,1530
it's just like partitions for

565
00:16:56,380 --> 00:16:57,440
0,30 30,600
a moment.|
|

566
00:16:57,440 --> 00:16:59,600
0,390 390,660 660,1110 1110,1410 1410,2160
Yeah, so, {} well, yeah
是的，所以这是可能的，

567
00:16:59,780 --> 00:17:00,800
0,180 180,330 330,570 570,870 870,1020
so that could happen,| so
|所以客户端可能会，

568
00:17:00,800 --> 00:17:01,940
0,60 60,390 390,690 690,1020 1020,1140
the client might actually,| so
|客户端有一个与 zookeeper 服务交互的 session ，

569
00:17:01,940 --> 00:17:02,930
0,90 90,330 330,450 450,510 510,990
the client has a session

570
00:17:03,020 --> 00:17:04,940
0,360 360,570 570,750 750,1620 1620,1920
right with the zookeeper {}

571
00:17:04,940 --> 00:17:08,030
0,660 1080,1950 1950,2370 2370,2850 2850,3090
service,| and {} {the,client} needs
|客户端需要，

572
00:17:08,030 --> 00:17:09,650
0,450 450,990 1020,1380 1380,1470 1470,1620
to,| {} actually the {zookeeper
|zookeeper 和客户端互相发送心跳，

573
00:17:09,650 --> 00:17:10,970
0,330 330,420 420,750 750,1020 1020,1320
-} and client basically sends

574
00:17:10,970 --> 00:17:12,890
0,420 420,540 540,690 690,1050 1530,1920
heartbeats to each other, {}|
|

575
00:17:12,890 --> 00:17:15,290
0,300 300,510 510,990 990,1950 1980,2400
if {zookeeper -} {} service
如果 zookeeper 服务一段时间没有收到客户端的心跳，

576
00:17:15,290 --> 00:17:16,580
0,360 360,780 780,930 930,990 990,1290
doesn't hear from a client

577
00:17:16,580 --> 00:17:17,930
0,90 90,120 120,300 300,870 960,1350
for a little while,| then
|然后，它决定客户端掉线并关闭会话。

578
00:17:17,930 --> 00:17:18,800
0,90 90,300 300,360 360,780 780,870
it's just {} desides that

579
00:17:18,800 --> 00:17:20,510
0,300 300,600 600,720 720,1320 1320,1710
{client,is} down and {close,the} session.|
|

580
00:17:21,600 --> 00:17:22,980
0,420 420,690 690,870 870,1170 1170,1380
And so the client is
客户端尝试在会话上发送消息，

581
00:17:22,980 --> 00:17:24,030
0,210 210,300 300,540 540,930 930,1050
trying to send messages on

582
00:17:24,030 --> 00:17:24,930
0,90 90,420 420,540 540,600 600,900
the session,| but the session
|但是会话已经关闭，已经消失，

583
00:17:24,930 --> 00:17:26,010
0,90 90,270 270,600 600,690 690,1080
is just closed, is gone,|
|

584
00:17:26,550 --> 00:17:27,690
0,240 240,480 480,900 900,1020 1020,1140
and any files that were
任何被创建的文件，

585
00:17:27,690 --> 00:17:30,090
0,540 540,660 660,780 780,1980 1980,2400
created in the,| {ephemeral -}
|这个会话期间创建的 ephemeral 文件会被删除，

586
00:17:30,090 --> 00:17:31,230
0,270 270,360 360,450 450,810 810,1140
files that were created during

587
00:17:31,230 --> 00:17:33,280
0,150 150,540 600,1080 1080,1470
that session {are,basically} deleted,|
|

588
00:17:34,860 --> 00:17:36,120
0,150 150,270 270,450 450,630 630,1260
and so if the network
如果网络恢复，

589
00:17:36,120 --> 00:17:40,290
0,930 960,1680 1680,2820 2970,3660 3750,4170
{} reconvenes or [],| then
|客户端尝试通过那个 session 发送消息，

590
00:17:40,290 --> 00:17:41,580
0,60 60,750 750,900 900,1140 1140,1290
the client will try to

591
00:17:41,580 --> 00:17:42,780
0,180 180,480 480,690 690,870 870,1200
send messages over that session,|
|

592
00:17:42,780 --> 00:17:43,740
0,120 120,570 570,720 720,870 870,960
and basically {zookeeper - -}
zookeeper 服务会说那个 session 已经不存在了，

593
00:17:43,740 --> 00:17:44,970
0,360 360,450 450,660 660,870 870,1230
service {} say like that

594
00:17:45,240 --> 00:17:47,080
0,390 390,600 600,900 900,1350
session doesn't exist anymore,|
|

595
00:17:47,370 --> 00:17:48,780
0,150 150,330 330,750 750,900 900,1410
you gotta retry or restart
你必须重试或重新开始一个新的 session 。

596
00:17:48,780 --> 00:17:50,060
0,120 120,270 270,690
a new session.|
|

597
00:17:50,830 --> 00:17:52,280
0,240 240,390 390,570 570,870
Got it, thank you.|
知道了，谢谢。|

598
00:17:53,470 --> 00:17:54,730
0,330 330,720 750,900 900,1080 1080,1260
Okay good, so there's one
好的，有一点很重要，

599
00:17:54,730 --> 00:17:56,500
0,360 360,720 750,1110 1110,1380 1380,1770
important point about this, {}|
|

600
00:17:56,500 --> 00:17:59,050
0,300 300,720 720,1200 1200,1680 1710,2550
I'll call zlocks, where {zookeeper
我称为  zlock ， zookeeper 锁，

601
00:17:59,050 --> 00:18:02,350
0,300 300,810 1800,2370 2550,2910 2910,3300
-} locks,| and that is
|它们并不相同或具有相似的语义，

602
00:18:02,380 --> 00:18:03,850
0,240 240,540 540,600 600,1290 1290,1470
they're not the same or

603
00:18:03,850 --> 00:18:05,290
0,210 210,540 540,960 960,1260 1260,1440
have similar {semantics -},| like
|你正在使用的锁， Go 锁或 mutex 。

604
00:18:05,290 --> 00:18:06,070
0,90 90,390 390,510 510,630 630,780
the locks that you were

605
00:18:06,070 --> 00:18:07,360
0,480 480,720 720,930 930,1230 1230,1290
using or Go locks or

606
00:18:07,360 --> 00:18:08,840
0,150 150,720
{mutex -}.|
|

607
00:18:09,360 --> 00:18:10,170
0,420 420,540 540,630 630,750 750,810
{} And it's sort of
这是一个需要注意的重要问题，

608
00:18:10,170 --> 00:18:11,400
0,90 90,420 420,600 600,690 690,1230
an important point to realize,|
|

609
00:18:11,400 --> 00:18:12,480
0,90 90,330 450,750 750,960 960,1080
you know {} even though
即使它们不同，

610
00:18:12,480 --> 00:18:13,290
0,150 150,480 480,570 570,750 750,810
they're different,| we'll see in
|我们一会儿就会知道，它们仍然很有用，

611
00:18:13,290 --> 00:18:14,490
0,60 60,330 330,450 450,660 660,1200
a second, they're still useful,|
|

612
00:18:14,490 --> 00:18:15,840
0,240 240,360 360,540 540,630 630,1350
but they're not as strong
但它们不像 Go 锁那样强，

613
00:18:15,840 --> 00:18:16,800
0,300 300,600 600,780 780,870 870,960
as {} sort of the

614
00:18:16,800 --> 00:18:19,170
0,810 1290,1770 1770,1860 1860,2310 2310,2370
{Go,locks},| {} in particular the
|尤其是有趣的是，

615
00:18:19,170 --> 00:18:20,280
0,300 300,360 360,570 570,690 690,1110
case is that is interesting

616
00:18:20,280 --> 00:18:21,150
0,210 210,360 360,540 540,630 630,870
is,| like when the lock
|当锁的持有者失败时，

617
00:18:21,150 --> 00:18:22,680
0,300 300,870
holder fails,|
|

618
00:18:23,360 --> 00:18:25,760
0,300 330,630 630,1080 1080,1710
so {if,lock} holder fails,|
如果锁持有者失败了，|

619
00:18:27,930 --> 00:18:29,430
0,180 180,510 510,720 720,990 990,1500
{} basically {zookeeper -} decides
zookeeper 确认锁持有者失败了，

620
00:18:29,430 --> 00:18:31,020
0,180 180,750 750,1050 1050,1200 1200,1590
that lock holder has failed,

621
00:18:31,020 --> 00:18:32,400
0,180 180,270 270,630 630,810 810,1380
correct,| as we just discussed,|
|正如我们刚才所讨论的，|

622
00:18:32,520 --> 00:18:35,250
0,840 960,1080 1080,1200 1200,2040 2130,2730
then it is possible,| that
那是可能的，|我们会看到一些中间状态。

623
00:18:35,250 --> 00:18:35,970
0,180 180,300 300,360 360,540 540,720
we're going to see some

624
00:18:35,970 --> 00:18:37,580
0,510 510,1080
intermediate state.|
|

625
00:18:42,820 --> 00:18:44,230
0,150 150,660 660,930 930,1020 1020,1410
And remember like the whole
记得锁的整个规则是，

626
00:18:44,230 --> 00:18:45,550
0,240 240,390 390,870 870,1080 1080,1320
rule that {locks,is},| like it's
|它是临界区间，

627
00:18:45,550 --> 00:18:47,350
0,330 330,1050 1050,1140 1140,1260 1260,1800
critical section,| you know you're
|一些不变量是 true ，

628
00:18:47,350 --> 00:18:49,300
0,240 240,540 540,750 750,1230 1260,1950
some invariant is true,| while
|当你通过临界区间的时候，

629
00:18:49,300 --> 00:18:50,830
0,240 240,870 870,1170 1170,1260 1260,1530
you're going through the critical

630
00:18:50,830 --> 00:18:52,060
0,330 330,540 540,750 750,1110 1110,1230
section,| so that it might
|所以这可能不是 true ，

631
00:18:52,060 --> 00:18:52,990
0,150 150,270 270,540 540,660 660,930
not be true,| but then
|但到了最后，你会重建不变量。

632
00:18:52,990 --> 00:18:54,370
0,120 120,240 240,510 510,780 780,1380
at the end, you reestablish

633
00:18:54,370 --> 00:18:55,980
0,90 90,450
{[invariant] -}.|
|

634
00:18:56,320 --> 00:18:57,880
0,810 810,990 990,1350 1350,1500 1500,1560
{} In here, it's the
在这里，情况就是这样，

635
00:18:57,880 --> 00:18:59,350
0,330 330,540 540,630 630,1050 1050,1470
case,| like it required lock,|
|它获取锁，|

636
00:18:59,350 --> 00:19:00,550
0,270 270,630 630,900 900,1080 1080,1200
client requires lock, does some
客户端获取锁，执行一些步骤，

637
00:19:00,550 --> 00:19:01,930
0,660 690,840 840,1140 1140,1260 1260,1380
steps,| and then you know
|然后 zookeeper 决定，

638
00:19:01,930 --> 00:19:02,950
0,240 240,390 390,600 600,960 960,1020
maybe {zookeeper -} decides| if
|如果客户端崩溃，

639
00:19:02,950 --> 00:19:04,570
0,90 90,870 870,1170 1170,1290 1290,1620
the client decides the client

640
00:19:04,570 --> 00:19:07,090
0,630 690,1560 1560,1800 1800,2130 2130,2520
crash| and {} basically revokes
|然后撤销锁，

641
00:19:07,090 --> 00:19:08,500
0,510 660,1050 1050,1140 1140,1290 1290,1410
lock,| but you know the
|但是你知道状态，

642
00:19:08,500 --> 00:19:09,670
0,510 510,600 600,690 690,810 810,1170
state,| you know the system
|系统可能在某种中间状态，

643
00:19:09,670 --> 00:19:11,200
0,240 240,600 600,930 930,1050 1050,1530
might actually be some intermediate

644
00:19:11,200 --> 00:19:12,490
0,240 240,360 360,510 510,690 690,1290
state,| {return - -} invariant
|返回不变量不是 true ，

645
00:19:12,490 --> 00:19:14,290
0,120 120,300 300,690 1350,1590 1590,1800
was not true, right,| so
|所以不是这种情况，

646
00:19:14,290 --> 00:19:15,460
0,270 270,510 510,600 600,990 990,1170
it's not the case,| that
|这些日志保证临界区间的[坚固性]。

647
00:19:15,460 --> 00:19:17,770
0,660 780,1020 1020,1320 1320,1740 1740,2310
basically {} these logs guarantee

648
00:19:17,770 --> 00:19:19,990
0,900 900,1110 1140,1500 1500,1800 1800,2220
adamicity of the critical section.|
|

649
00:19:21,180 --> 00:19:22,830
0,600 780,960 960,1320 1350,1500 1500,1650
{} So what, so what
那么，它们做什么，它们有什么用处，

650
00:19:22,830 --> 00:19:24,870
0,120 120,1110 1140,1320 1320,1500 1500,2040
they do, what they useful

651
00:19:24,870 --> 00:19:27,140
0,480 900,1620
for, {}|
|

652
00:19:29,510 --> 00:19:31,010
0,330 330,510 510,630 630,840 840,1500
is for some other purposes,|
是出于其他目的，|

653
00:19:33,640 --> 00:19:35,410
0,450 450,690 690,1110 1110,1590 1590,1770
{in,fact} {sort,of} two primary use
事实上，有两种主要用例，

654
00:19:35,410 --> 00:19:37,030
0,450 450,1200 1200,1320 1320,1500 1500,1620
cases,| one, I think is
|一个，我认为是领导者选举，

655
00:19:37,030 --> 00:19:38,640
0,300 300,780
leader election,|
|

656
00:19:43,380 --> 00:19:45,420
0,510 630,1530 1530,1680 1680,1830 1830,2040
so basically if we need
所以如果我们需要一组客户端，

657
00:19:45,420 --> 00:19:46,680
0,480 480,660 660,720 720,1140 1140,1260
a set of clients,| that
|需要从它们当中选出领导者，

658
00:19:46,680 --> 00:19:47,520
0,150 150,240 240,480 480,570 570,840
need to select the leader

659
00:19:47,520 --> 00:19:48,690
0,270 270,570 570,660 660,780 780,1170
among them,| you know they
|它们可以尝试创建锁文件，

660
00:19:48,810 --> 00:19:50,820
0,480 480,780 780,1050 1050,1530 1560,2010
can all try to basically

661
00:19:50,970 --> 00:19:52,500
0,300 300,390 390,660 660,1170 1200,1530
create the lock file,| one
|其中一个成功了，

662
00:19:52,500 --> 00:19:54,210
0,60 60,240 240,990 1020,1350 1350,1710
of them succeed,| that's basically
|成为领导者，

663
00:19:54,210 --> 00:19:55,640
0,210 210,510 510,570 570,960
then becomes a leader,|
|

664
00:19:55,860 --> 00:19:57,450
0,210 210,360 360,1020 1020,1320 1320,1590
and that leader could clean
如果有必要，领导者可以清理任何中间状态，

665
00:19:57,450 --> 00:19:59,610
0,300 300,540 540,990 990,1560 1560,2160
up any intermediate states {if,possible}

666
00:19:59,610 --> 00:20:01,740
0,390 390,1050
if necessary,|
|

667
00:20:02,070 --> 00:20:03,930
0,690 1080,1260 1260,1410 1410,1620 1620,1860
or you know do these
或者做这些原子更新，

668
00:20:03,930 --> 00:20:05,460
0,360 360,870 870,1200 1200,1290 1290,1530
atomic updates,| using the ready
|使用 ready 的技巧，

669
00:20:05,460 --> 00:20:06,690
0,330 360,630 630,990 990,1110 1110,1230
trick,| where basically you do
|你对某个文件执行一些写入操作，

670
00:20:06,690 --> 00:20:07,860
0,60 60,300 300,420 420,840 840,1170
a bunch of writes to

671
00:20:07,860 --> 00:20:08,700
0,150 150,510 510,600 600,720 720,840
some file,| but then you
|但只在最后[展示]文件，

672
00:20:08,700 --> 00:20:09,870
0,420 420,510 510,870 870,1080 1080,1170
expose the file only at

673
00:20:09,870 --> 00:20:11,040
0,60 60,420 420,630 630,870 870,1170
the very end,| and that
|通过这种方式进行一组写操作

674
00:20:11,040 --> 00:20:13,110
0,180 180,420 420,450 450,1140 1530,2070
way make a set of

675
00:20:13,110 --> 00:20:15,540
0,450 450,930 930,1440 1440,1710 1710,2430
writes| actually are more transactional
|是更具事务性的工作。

676
00:20:15,540 --> 00:20:16,260
0,270
work.|
|

677
00:20:16,390 --> 00:20:17,980
0,360 360,570 570,1050 1050,1260 1260,1590
So that's one use case
所以，这是这类锁的一个使用案例，

678
00:20:17,980 --> 00:20:19,090
0,150 150,330 330,510 510,570 570,1110
for these kind of locks,|
|

679
00:20:19,240 --> 00:20:21,040
0,360 360,900 990,1380 1380,1710 1710,1800
the second use case is
第二个用例是我所说的软锁，

680
00:20:21,040 --> 00:20:22,630
0,240 240,330 330,660 660,1020 1020,1590
what I call soft locks,|
|

681
00:20:27,260 --> 00:20:28,790
0,540 540,780 780,1170 1170,1410 1410,1530
{the,soft,locks} you know the way
你可以考虑软锁是，

682
00:20:28,790 --> 00:20:30,380
0,90 90,240 240,600 600,810 810,1590
to think about is that,|
|

683
00:20:30,560 --> 00:20:33,110
0,240 240,810 900,1500 1500,2220 2430,2550
let's say {we,have,a} worker in
假设我们有一个 mapreduce 式的 worker ，

684
00:20:33,110 --> 00:20:34,760
0,60 60,270 270,540 540,1140 1230,1650
the {mapreduce -} style,| and
|而且 map ，

685
00:20:34,760 --> 00:20:35,930
0,60 60,390 390,840 840,1110 1110,1170
the map,| I want to
|我想安排每个 worker

686
00:20:35,930 --> 00:20:38,450
0,420 420,1080 1080,1710 1710,2190 2190,2520
basically arrange that {you,know,every} {}

687
00:20:38,450 --> 00:20:40,190
0,300 300,810 810,1050 1050,1470 1470,1740
worker| executes a particular map
|只执行一次特定的 map 任务，

688
00:20:40,190 --> 00:20:43,310
0,270 270,540 540,1080 1470,2040 2040,3120
task only once { -},|
|

689
00:20:43,460 --> 00:20:44,720
0,210 210,600 660,810 810,1080 1080,1260
and so the one way
所以，要做到这个的一种方法，

690
00:20:44,720 --> 00:20:45,800
0,90 90,210 210,480 480,720 720,1080
to do that,| we basically
|我们从外面获取一个锁，

691
00:20:45,800 --> 00:20:46,880
0,210 210,270 270,630 630,960 960,1080
take a lock out,| you
|对于特定的输入文件，

692
00:20:46,880 --> 00:20:48,770
0,90 90,330 330,510 510,1290 1440,1890
know for that particular {}

693
00:20:48,770 --> 00:20:50,930
0,360 360,870 1110,1500 1530,2100 2100,2160
input file,| {} run you
|执行计算，

694
00:20:50,930 --> 00:20:53,270
0,150 150,240 240,1080 1230,1380 1380,2340
know the computation,| and then
|然后，一旦 map 完成，

695
00:20:53,300 --> 00:20:54,740
0,330 330,720 720,1050 1050,1290 1290,1440
{you,know} once the map is

696
00:20:54,740 --> 00:20:55,880
0,330 330,600 600,780 780,1080 1080,1140
done,| then you release the
|然后释放锁文件，

697
00:20:55,880 --> 00:20:58,190
0,240 240,570 720,1680 1680,1830 1830,2310
lock file,| {so,this} will cost
|所以，通常情况下，执行特定任务只需花费一个 mapper ，

698
00:20:58,190 --> 00:20:59,960
0,420 420,960 960,1290 1290,1470 1470,1770
only one {mapper -} to

699
00:20:59,960 --> 00:21:01,490
0,120 120,420 420,780 780,900 900,1530
the common case to execute

700
00:21:01,760 --> 00:21:04,520
0,690 690,960 960,1320 1320,1890 2310,2760
{} a particular task,| and
|而这正是我们想要的，

701
00:21:04,670 --> 00:21:06,530
0,570 690,990 990,1350 1350,1740 1740,1860
and that's exactly what we

702
00:21:06,530 --> 00:21:07,550
0,270 270,390 390,480 480,930 930,1020
want,| but of course you
|当然，如果 mapper 失败，

703
00:21:07,550 --> 00:21:09,050
0,120 120,630 630,780 780,1170 1170,1500
know if the mapper would

704
00:21:09,050 --> 00:21:10,160
0,390 390,630 630,720 720,990 990,1110
fail,| then the lock will
|那么锁就会被释放，

705
00:21:10,160 --> 00:21:12,050
0,150 150,750 900,1050 1050,1620 1620,1890
be release,| and then we
|然后我们可能会再执行一次，

706
00:21:12,050 --> 00:21:13,190
0,270 270,630 630,780 780,810 810,1140
might execute it a second

707
00:21:13,190 --> 00:21:14,510
0,300 300,600 600,960 960,1230 1230,1320
time,| because somebody else will
|因为其他人会试图获取锁，

708
00:21:14,510 --> 00:21:15,740
0,210 210,300 300,810 810,840 840,1230
try to acquire a lock,|
|

709
00:21:16,040 --> 00:21:17,000
0,210 210,300 300,360 360,510 510,960
and so in that case,|
所以在这种情况下，|

710
00:21:17,000 --> 00:21:17,600
0,90 90,210 210,330 330,390 390,600
you know for the case
对于 mapreduce 的情况，这是非常好的，

711
00:21:17,600 --> 00:21:18,710
0,60 60,270 270,540 540,720 720,1110
of {mapreduce -}, that's perfectly

712
00:21:18,710 --> 00:21:20,960
0,330 360,720 930,1590 1590,1740 1740,2250
fine, right,| the, it's okay
|这个任务执行两次也没关系，

713
00:21:20,960 --> 00:21:22,070
0,120 120,180 180,540 540,660 660,1110
if the task is executed

714
00:21:22,070 --> 00:21:23,380
0,630
twice,|
|

715
00:21:24,870 --> 00:21:27,440
0,210 210,510 510,1410
if happens twice.|
如果发生两次。|

716
00:21:29,680 --> 00:21:30,460
0,150 150,210 210,390 390,630 630,780
And in some ways what
在某些方面，它到底是什么，

717
00:21:30,460 --> 00:21:31,600
0,90 90,600 600,780 780,900 900,1140
it really is,| it's more
|更多的性能优化，

718
00:21:31,600 --> 00:21:33,190
0,390 390,990 990,1230 1230,1320 1320,1590
performance optimization,| in the usual
|在通常的情况下，你想要，

719
00:21:33,190 --> 00:21:34,720
0,240 240,300 300,540 540,1110 1320,1530
case, you wanted to,| you
|你想要只执行一次，

720
00:21:34,720 --> 00:21:36,130
0,240 240,510 510,900 900,1020 1020,1410
wanted that actually is execute

721
00:21:36,130 --> 00:21:37,720
0,90 90,330 330,840 990,1290 1290,1590
the only once,| {} but
|但是如果失败了，

722
00:21:37,720 --> 00:21:38,350
0,90 90,210 210,390 390,540 540,630
you know if there's a

723
00:21:38,350 --> 00:21:39,400
0,570 570,720 720,900 900,990 990,1050
failure,| it might be the
|情况可能是这样的，

724
00:21:39,400 --> 00:21:40,450
0,270 270,390 390,510 510,990 990,1050
case,| that you're executing a
|你执行了两次 map 作业，

725
00:21:40,450 --> 00:21:42,310
0,240 240,480 480,990 1290,1620 1620,1860
map job twice,| {then,that} thing,
|然后那个东西， mapreduce 意味着

726
00:21:42,310 --> 00:21:43,660
0,420 420,510 510,750 750,1080 1080,1350
{you,know} the {mapreduce -} means|
|

727
00:21:43,660 --> 00:21:44,440
0,90 90,300 300,450 450,570 570,780
you set up in such
你以这种方式设置，是可以的。

728
00:21:44,440 --> 00:21:45,280
0,90 90,240 240,420 420,660 660,840
a way, that actually {that's

729
00:21:45,280 --> 00:21:47,320
0,1320 1320,1380
-} okay.|
|

730
00:21:47,870 --> 00:21:48,890
0,300 300,420 420,480 480,690 690,1020
And so in those cases,|
所以，在这些情况下，|

731
00:21:48,890 --> 00:21:49,490
0,120 120,180 180,300 300,480 480,600
{ -} these sort of
这种锁也很有用。

732
00:21:49,670 --> 00:21:51,170
0,480 480,570 570,840 840,1170 1170,1500
locks are really useful, too.|
|

733
00:21:52,780 --> 00:21:54,070
0,180 180,480 480,630 630,990 990,1290
Any questions about this, about
关于这个，有什么问题吗，关于锁的这个观点，

734
00:21:54,070 --> 00:21:55,180
0,360
{}

735
00:21:55,830 --> 00:21:57,330
0,210 210,690 690,840 840,1410 1410,1500
this perspective for locks,| you
|zookeeper 锁与 Go 锁不太一样，

736
00:21:57,330 --> 00:21:58,350
0,120 120,330 330,510 510,750 750,1020
know the {zookeeper -} locks

737
00:21:58,350 --> 00:21:59,370
0,30 30,210 210,720 720,930 930,1020
are not exactly like the

738
00:21:59,370 --> 00:22:00,930
0,600 600,900 960,1290 1290,1440 1440,1560
{Go,locks},| and it's just an
|这是一件需要记住的重要事情。

739
00:22:00,930 --> 00:22:01,890
0,330 330,450 450,690 690,870 870,960
important thing to keep in

740
00:22:01,890 --> 00:22:02,900
0,450
mind.|
|

741
00:22:03,760 --> 00:22:07,660
0,210 210,540 1080,1800 2100,3060 3090,3900
Oh.| Yeah, {go,ahead}, Alexander.| Yeah,
噢。|好的，继续， Alexander 。|是的，我有个问题，

742
00:22:07,660 --> 00:22:09,010
0,480 480,600 600,720 720,1170 1170,1350
I had a question,| you
|你说过，其中一个区别是，

743
00:22:09,010 --> 00:22:10,210
0,270 270,570 570,840 840,1080 1080,1200
said that, {} one of

744
00:22:10,210 --> 00:22:12,100
0,120 120,930 930,1080 1080,1440 1440,1890
the differences is that, {}|
|

745
00:22:12,850 --> 00:22:15,800
0,840 840,1080 1080,1680 1680,2340
in {zlocks -}, the,
在 zlock 中，如果持有锁的服务器宕机，

746
00:22:16,420 --> 00:22:18,480
0,270 270,510 510,1140
if, if the,

747
00:22:18,480 --> 00:22:19,680
0,150 150,300 300,690 690,1050 1050,1200
if the server holding the

748
00:22:19,680 --> 00:22:21,390
0,480 480,1050 1050,1260 1260,1380 1380,1710
lock dies,| then the lock
|那么锁就可以被撤销，

749
00:22:21,390 --> 00:22:24,140
0,270 270,780 810,1380 1410,2070
can be revoked,| but,
|但是，如果你不通过，是不是仍然会发生，

750
00:22:24,600 --> 00:22:25,860
0,360 360,510 510,780 780,1140 1140,1260
does that still happen if

751
00:22:25,860 --> 00:22:27,720
0,150 150,420 420,810 810,1440 1680,1860
you don't pass the,| because
|因为有一个标志是 EPHEMERAL 。

752
00:22:27,720 --> 00:22:29,660
0,270 270,510 510,1350
there's that flag

753
00:22:30,400 --> 00:22:33,640
0,510 510,960 1110,1740 1740,2220 2250,3240
called {} EPHEMERAL.| {EPHEMERAL -},
|EPHEMERAL ，是的，只有 ephemeral 文件才会发生这种情况。

754
00:22:33,700 --> 00:22:34,780
0,210 210,390 390,630 630,900 900,1080
yeah, it only happens with

755
00:22:34,780 --> 00:22:36,320
0,120 120,600 600,1020
the ephemeral file.|
|

756
00:22:36,350 --> 00:22:37,790
0,360 360,540 540,1020 1020,1170 1170,1440
Right, so can we just
是的，所以我们能不能通过不传递 EPHEMERAL 来模拟 Go 锁。

757
00:22:37,790 --> 00:22:40,460
0,960 1140,1770 1770,1920 1920,2400 2400,2670
like emulate the {Go,locks} by

758
00:22:40,460 --> 00:22:44,460
0,330 330,840 840,990 990,1620
not passing {EPHEMERAL -}.|
|

759
00:22:46,570 --> 00:22:47,470
0,150 150,270 270,510 510,840 840,900
{Okay\,,good}, what would happen then,|
好的，接下来会发生什么，|

760
00:22:47,470 --> 00:22:49,040
0,480 480,1020
{you,create} {basically,a,persistent,file},|
你创建了一个永久文件，|

761
00:22:49,040 --> 00:22:50,780
0,90 90,510 510,1200
the client dies.|
客户端宕机。|

762
00:22:51,400 --> 00:22:53,080
0,180 180,390 390,570 570,1110
You said the lock?|
你是说锁？|

763
00:22:53,640 --> 00:22:54,630
0,150 150,270 270,360 360,600 600,990
And so the lock will
锁将继续存在，没有人会释放它，

764
00:22:54,660 --> 00:22:56,880
0,210 210,330 330,1020 1260,1920 1920,2220
keep on existing and nobody

765
00:22:56,880 --> 00:22:58,300
0,150 150,450 450,690
will release it,|
|

766
00:22:58,450 --> 00:22:59,950
0,570 570,750 750,840 840,900 900,1500
and we have a deadlock,|
我们会陷入死锁，|

767
00:23:02,050 --> 00:23:03,310
0,570 600,690 690,900 900,1170 1170,1260
because the one person that
因为唯一可以释放它的已经宕机，或者崩溃，

768
00:23:03,310 --> 00:23:04,930
0,240 240,510 510,750 780,960 960,1620
could release it is dead

769
00:23:06,540 --> 00:23:07,920
0,150 150,810
or crashed,|
|

770
00:23:09,000 --> 00:23:09,720
0,270 270,330 330,510 510,660 660,720
and in fact, this is
这就是为什么会有 EPHEMERAL 。

771
00:23:09,720 --> 00:23:11,340
0,390 390,570 570,930 930,1230 1230,1620
why {EPHEMERAL -} [] there.|
|

772
00:23:13,350 --> 00:23:15,390
0,450 540,870 1050,1260 1260,1500 1530,2040
{} Is, is it actually
它真的是唯一可以释放它的吗，

773
00:23:15,390 --> 00:23:16,740
0,180 180,780
the only,

774
00:23:17,100 --> 00:23:18,030
0,150 150,330 330,630 630,720 720,930
the only person who could

775
00:23:18,030 --> 00:23:19,290
0,270 270,420 420,690 690,1110 1110,1260
release it,| because anyone can
|因为任何人都可以删除那个文件，

776
00:23:19,290 --> 00:23:21,030
0,330 330,510 510,810 810,1140 1560,1740
delete that file, right,| you
|你有[后台]，比如。

777
00:23:21,030 --> 00:23:23,520
0,180 180,870 870,1440 1440,1860 2190,2490
have a background, like.| That
|这将破坏，

778
00:23:23,520 --> 00:23:25,500
0,1110 1110,1560 1560,1620 1620,1740 1740,1980
will break,| you know maybe
|可能另一个客户端仍在运行，

779
00:23:25,500 --> 00:23:26,370
0,150 150,300 300,570 570,630 630,870
the other client is still

780
00:23:26,370 --> 00:23:27,840
0,360 360,510 510,990 990,1260 1260,1470
running,| and also still thinks
|并且仍然认为它持有锁。

781
00:23:27,840 --> 00:23:29,080
0,90 90,240 240,390 390,810
it holds a lock.|
|

782
00:23:32,370 --> 00:23:33,440
0,180 180,630
{Sure -}.|
好的。|

783
00:23:33,750 --> 00:23:34,740
0,180 180,510 510,690 690,750 750,990
{} You get are getting
你会得到，

784
00:23:34,740 --> 00:23:36,480
0,210 210,450 450,1170 1170,1650 1650,1740
sort of, basically you're,| {this,is}
|这又是一个共识问题。

785
00:23:36,480 --> 00:23:38,070
0,480 480,840 840,990 990,1260 1260,1590
consensus problem all over again,

786
00:23:38,100 --> 00:23:39,200
0,300
right.|
|

787
00:23:39,350 --> 00:23:41,480
0,930 930,1410 1410,1470 1470,1680 1680,2130
{} And you know we,|
你知道我们，|

788
00:23:44,820 --> 00:23:45,630
0,330 330,480 480,570 570,720 720,810
so this is sort of
所以，这是一种获得大部分信息的简单的方式，

789
00:23:45,630 --> 00:23:46,740
0,210 210,510 510,840 840,960 960,1110
a clean way to get

790
00:23:46,740 --> 00:23:48,570
0,270 270,390 390,720 1020,1650 1650,1830
most of it,| but not
|但不是全部，

791
00:23:48,570 --> 00:23:49,860
0,210 210,300 300,540 960,1170 1170,1290
all of it,| if you
|如果你愿意的话，

792
00:23:49,860 --> 00:23:51,300
0,390 630,960 960,990 990,1200 1200,1440
will,| and I think if
|我想如果你想让东西变的原子化，

793
00:23:51,300 --> 00:23:51,900
0,90 90,210 210,270 270,420 420,600
you want to make things

794
00:23:51,900 --> 00:23:53,520
0,480 480,1050 1050,1110 1110,1440 1440,1620
atomic,| across a number of
|让一组写入原子化，

795
00:23:53,520 --> 00:23:55,350
0,690 690,900 900,960 960,1230 1230,1830
a set of writes atomic,|
|

796
00:23:55,530 --> 00:23:56,460
0,90 90,240 240,630 630,810 810,930
so you basically use this
所以你使用这个技巧，

797
00:23:56,460 --> 00:23:59,160
0,510 780,1470 1500,2280
trick of {},|
|

798
00:23:59,460 --> 00:24:00,820
0,780

799
00:24:01,540 --> 00:24:02,980
0,330 330,450 450,720 720,1290 1290,1440
use this trick, basically {}
使用这个技巧， ready 技巧，

800
00:24:02,980 --> 00:24:03,880
0,120 120,390 390,630 630,840 840,900
the ready trick,| where you
|执行很多写入，但是[同时]展示它们。

801
00:24:03,880 --> 00:24:04,720
0,120 120,180 180,360 360,480 480,840
do a bunch of writes

802
00:24:04,720 --> 00:24:05,740
0,150 150,630 630,720 720,780 780,1020
and {expose,them} at the same

803
00:24:05,740 --> 00:24:06,620
0,330
time.|
|

804
00:24:10,640 --> 00:24:12,110
0,270 270,390 390,810 810,1050 1050,1470
Could you explain those soft
你能再解释一下那些软锁吗？

805
00:24:12,110 --> 00:24:13,640
0,390 390,990
locks again?|
|

806
00:24:13,640 --> 00:24:15,800
0,660 660,870 870,1200 1200,1560 1590,2160
{} Okay, soft locks means
好的，软锁意味着一个操作可以发生两次。

807
00:24:15,800 --> 00:24:16,790
0,90 90,390 390,450 450,870 870,990
that basically an operation can

808
00:24:16,790 --> 00:24:18,020
0,210 210,720
happen twice.|
|

809
00:24:18,200 --> 00:24:19,550
0,720 720,1050 1050,1200 1200,1290 1290,1350
{} And so in the
在常见的情况下，

810
00:24:19,550 --> 00:24:20,510
0,300 300,570 570,690 690,810 810,960
common case,| if there's no
|如果没有崩溃，

811
00:24:20,510 --> 00:24:21,710
0,600 600,720 720,810 810,960 960,1200
crashes,| you know {it,will} happen
|它只会发生一次，

812
00:24:21,710 --> 00:24:22,880
0,510 510,630 630,720 720,1050 1050,1170
once,| you know because {you,know
|因为客户端用一个锁，

813
00:24:22,880 --> 00:24:24,110
0,180 180,510 510,870 870,1020 1020,1230
-} the client will take

814
00:24:24,110 --> 00:24:24,920
0,60 60,300 300,600 600,690 690,810
a lock out,| will do
|会进行释放操作，

815
00:24:24,920 --> 00:24:26,660
0,90 90,660 660,1260
the operation release,|
|

816
00:24:26,720 --> 00:24:29,060
0,810 810,1560 1590,1890 1890,2160 2160,2340
{} and, {} but if
但是如果客户端在半路失败了，

817
00:24:29,060 --> 00:24:31,010
0,240 240,540 540,1110 1170,1530 1530,1950
there client failed, {} halfway

818
00:24:31,010 --> 00:24:32,240
0,270 270,330 330,810 810,1140 1140,1230
through,| for example, then the
|然后锁将由 zookeeper 自动释放，

819
00:24:32,240 --> 00:24:33,590
0,240 240,390 390,480 480,1020 1020,1350
lock would be automatically released

820
00:24:33,590 --> 00:24:34,490
0,90 90,270 270,690 690,810 810,900
by {zookeeper -},| and then
|然后可能是第二个客户端执行相同的 map 任务。

821
00:24:34,490 --> 00:24:36,200
0,330 330,390 390,870 930,1440 1440,1710
maybe a second client will

822
00:24:36,200 --> 00:24:37,640
0,450 450,540 540,750 750,1020 1020,1440
execute the same map task.|
|

823
00:24:41,710 --> 00:24:42,430
0,180 180,270 270,360 360,600 600,720
So in the case of
所以在领导者选举的例子中，

824
00:24:42,430 --> 00:24:44,650
0,540 720,1290 1290,1710 1710,2130 2130,2220
leader election,| {} what's the
|在这里可以暴露的中间状态是什么，

825
00:24:44,650 --> 00:24:46,450
0,420 420,780 780,1140 1170,1380 1380,1800
intermediate state could get exposed

826
00:24:46,450 --> 00:24:48,430
0,210 630,900 900,1170 1170,1680 1680,1980
here,| it seems that first.|
|这似乎是第一个。|

827
00:24:49,090 --> 00:24:50,800
0,480 480,780 810,1200 1200,1440 1440,1710
Okay, {} pure leader election
好的，纯粹的领导人选举不会有中间状态，

828
00:24:50,800 --> 00:24:51,760
0,90 90,240 240,330 330,510 510,960
there would be no intermediate

829
00:24:51,760 --> 00:24:53,020
0,330 330,450 450,840 840,960 960,1260
state,| but typically the leader
|但是通常领导者会创建配置文件，

830
00:24:53,020 --> 00:24:54,520
0,180 180,510 510,570 570,1140 1140,1500
will create a configuration file,

831
00:24:54,550 --> 00:24:55,900
0,390 540,810 810,930 930,1230 1230,1350
right,| as we saw in
|像我们在 zookeeper 中看到的那样，

832
00:24:55,900 --> 00:24:58,000
0,150 150,540 540,1320 1350,1800 1800,2100
{zookeeper -},| where {you,know} using
|使用 ready 技巧。

833
00:24:58,000 --> 00:24:59,140
0,90 90,330 330,720
the ready trick.|
|

834
00:25:00,060 --> 00:25:01,050
0,120 120,390 450,600 600,780 780,990
I see, and so you
我明白了，所以你把整个文件都写好了，

835
00:25:01,050 --> 00:25:02,040
0,270 270,480 480,540 540,720 720,990
just write the whole file,|
|

836
00:25:02,040 --> 00:25:03,960
0,120 120,300 300,660 690,1320 1350,1920
and then {convert,it} atomic, {use,rename}.|
然后原子地进行转换，使用重命名。|

837
00:25:03,960 --> 00:25:05,660
0,750
Yep.|
是的。|

838
00:25:06,870 --> 00:25:09,780
0,300 300,510 510,1140 1380,2400 2490,2910
Sorry, could you explain what
抱歉，你能具体解释一下 ready 技巧是什么吗？

839
00:25:09,780 --> 00:25:12,240
0,120 120,330 330,930 930,1680 1860,2460
the ready trick is, exactly?|
|

840
00:25:13,830 --> 00:25:14,640
0,270 270,360 360,540 540,600 600,810
{I,was,hoping,not,to}, I think we talked
我希望不用，我想我们上次谈过了。

841
00:25:14,640 --> 00:25:17,010
0,180 180,420 420,660 1020,1590 1650,2370
about last time.| Sorry. {}|
|抱歉。|

842
00:25:17,010 --> 00:25:19,650
0,390 630,1290 1320,1740 1740,2490 2520,2640
So so maybe we, {you,can}
所以也许你可以保持这个问题，

843
00:25:19,650 --> 00:25:20,640
0,180 180,270 270,660 660,900 900,990
hold that question,| well I'm
|我很高兴在课程结束后再讲一次，

844
00:25:20,640 --> 00:25:21,270
0,240 240,330 330,420 420,540 540,630
happy to do it at

845
00:25:21,270 --> 00:25:21,900
0,90 90,270 270,330 330,390 390,630
the end of the lecture

846
00:25:21,900 --> 00:25:22,660
0,330
again,|
|

847
00:25:25,980 --> 00:25:27,540
0,510 510,810 810,1080 1110,1320 1320,1560
because otherwise I have little
否则，我很少有时间来谈论链式复制。

848
00:25:27,540 --> 00:25:28,890
0,180 180,300 300,480 480,690 690,1350
time to actually talk about

849
00:25:28,890 --> 00:25:30,220
0,210 210,750
chain replication.|
|

850
00:25:35,560 --> 00:25:37,870
0,150 150,570 570,840 840,1440 1470,2310
Any other {[] -} questions?|
还有其他问题吗？|

851
00:25:40,290 --> 00:25:42,480
0,540 630,960 960,1050 1050,1290 1290,2190
Okay, let me set the
好的，让我设置一下链式复制的状态，

852
00:25:42,480 --> 00:25:43,920
0,420 420,630 630,900 900,1380 1380,1440
states where chain replication a

853
00:25:43,920 --> 00:25:45,240
0,240 240,630 630,1080 1080,1230 1230,1320
little bit,| and then we'll
|有时也会回到 zookeeper ，

854
00:25:45,240 --> 00:25:46,230
0,180 180,300 300,600 600,780 780,990
also come back to {zookeeper

855
00:25:46,230 --> 00:25:47,910
0,270 270,360 360,540 540,1050 1230,1680
-} in some sense, {}|
|

856
00:25:47,910 --> 00:25:50,340
0,570 660,1410 1410,1710 1710,2160 2190,2430
and basically turns out,| there's
事实证明，|有两种常见的方法来构建复制状态机，

857
00:25:50,340 --> 00:25:52,080
0,120 120,240 240,660 660,1110 1110,1740
sort of two common approaches

858
00:25:52,080 --> 00:25:54,030
0,390 390,690 690,1110 1110,1350 1350,1950
to build replicated state machines,|
|

859
00:25:54,330 --> 00:25:55,620
0,240 240,360 360,690 690,930 930,1290
and we really haven't called
我们还没有提出这两种方法，

860
00:25:55,620 --> 00:25:57,180
0,240 240,420 420,570 570,1110 1230,1560
out these two approaches,| and
|我们见过它们，

861
00:25:57,180 --> 00:25:58,290
0,330 330,570 570,840 840,990 990,1110
we've seen them,| but I
|但我很明确地谈到了它们，

862
00:25:58,290 --> 00:25:59,700
0,300 300,540 540,1050 1050,1260 1260,1410
really talked explicitly about them,|
|

863
00:25:59,700 --> 00:26:00,360
0,60 60,240 240,300 300,390 390,660
I want to do this,
我想这次是明确的。

864
00:26:00,360 --> 00:26:01,960
0,330 330,510 510,1110
this time explicitly.|
|

865
00:26:01,960 --> 00:26:03,080
0,570
So.|
所以。|

866
00:26:05,790 --> 00:26:07,260
0,270 270,420 420,570 570,900 900,1470
Because there's some interesting observations
因为有一些有趣的观察

867
00:26:07,260 --> 00:26:09,750
0,90 90,210 210,600 1380,2250 2250,2490
to be made| approaches to
|用来构建复制状态机的方法。

868
00:26:09,750 --> 00:26:13,480
0,330 330,780 780,960 960,1530
building replicated state machines.|
|

869
00:26:14,550 --> 00:26:17,640
0,630 810,1020 1020,1320 1320,1860 2160,3090
And the first one is
第一个是我们在实验中看到的那个，

870
00:26:17,700 --> 00:26:19,050
0,330 330,540 540,840 840,990 990,1350
{} the one we've basically

871
00:26:19,050 --> 00:26:20,520
0,300 300,390 390,990 1050,1350 1350,1470
seen the labs,| which is
|也就是运行所有操作通过 Raft ，

872
00:26:20,520 --> 00:26:23,500
0,570 600,960 960,1920
{you,run} all operations

873
00:26:25,260 --> 00:26:27,140
0,180 180,300 300,660 660,1350
you know through raft,|
|

874
00:26:30,330 --> 00:26:31,530
0,480 480,570 570,720 720,1020 1020,1200
Raft, {zookeeper - - -}
Raft zookeeper 或者 Paxos ，

875
00:26:31,530 --> 00:26:32,970
0,450 450,660 660,780 780,1020 1020,1440
Raft or you know Paxos,|
|

876
00:26:32,970 --> 00:26:34,780
0,570 570,960
whatever {you,know}
无论使用什么共识算法，

877
00:26:34,840 --> 00:26:36,400
0,390 390,780 780,870 870,1140 1140,1560
{consensus -} you know the

878
00:26:36,400 --> 00:26:38,860
0,360 360,780 780,990 990,1440 1950,2460
consensus algorithm you're using,| and
|这有点像键值存储，

879
00:26:38,860 --> 00:26:39,460
0,90 90,270 270,360 360,480 480,600
so this is sort of

880
00:26:39,460 --> 00:26:40,540
0,150 150,210 210,360 360,690 690,1080
like the key value store,

881
00:26:40,570 --> 00:26:43,330
0,900 930,1260 1260,1770 1770,2280 2310,2760
right,| {} {in,lab,3}, where {you,do}
|在实验 3 中，你执行 put get 操作，

882
00:26:43,330 --> 00:26:44,920
0,450 450,690 690,1260 1260,1380 1380,1590
{put,and} get operation,| you run
|你通过 Raft 执行所有 put get 操作，

883
00:26:44,920 --> 00:26:46,330
0,300 300,510 510,690 690,1200 1200,1410
{all,the} {put,and} get operation through

884
00:26:46,330 --> 00:26:48,360
0,690 840,1530
Raft,| and
|服务更新键值存储状态，

885
00:26:48,450 --> 00:26:49,740
0,180 180,330 330,480 480,930 930,1290
you know the service basically

886
00:26:49,740 --> 00:26:50,850
0,510 510,570 570,690 690,960 960,1110
update you know the key

887
00:26:50,850 --> 00:26:52,530
0,330 330,600 600,1050 1050,1290 1290,1680
value store state| as the
|当操作进入 apply channel 时，

888
00:26:52,800 --> 00:26:54,510
0,990 990,1080 1080,1290 1290,1500 1500,1710
operations are coming in on

889
00:26:54,510 --> 00:26:55,940
0,90 90,390 390,900
the apply channel,|
|

890
00:26:56,060 --> 00:26:58,160
0,660 750,1680 1680,1830 1830,2010 2010,2100
and {} you know and
我们有自己的复制状态，

891
00:26:58,160 --> 00:26:59,690
0,420 420,600 600,900 900,1140 1140,1530
basically we have our replicated

892
00:26:59,690 --> 00:27:01,880
0,450 1020,1500 1500,1650 1650,1740 1740,2190
states,| so this is how
|这就是实验 3 的工作方式。

893
00:27:01,880 --> 00:27:04,100
0,330 330,480 480,1110
lab 3 works.|
|

894
00:27:05,960 --> 00:27:07,160
0,210 210,450 450,690 690,840 840,1200
{} It turns out that
事实证明， Raft 使用的这种风格，

895
00:27:07,160 --> 00:27:09,710
0,960 960,1500 1500,1920 1920,2430 2430,2550
style where basically Raft is

896
00:27:09,710 --> 00:27:11,630
0,390 390,510 510,1050 1080,1770 1770,1920
used,| the also run all
|运行所有操作的情况并不常见，

897
00:27:11,630 --> 00:27:12,950
0,120 120,690 690,780 780,1020 1020,1320
the operations is actually not

898
00:27:12,950 --> 00:27:14,600
0,240 240,600 1080,1350 1350,1500 1500,1650
that common,| {} we'll see
|我们将在本学期晚些时候看到一些其他设计来实现这一点，

899
00:27:14,600 --> 00:27:15,650
0,150 150,360 360,780 780,990 990,1050
some other designs later in

900
00:27:15,650 --> 00:27:16,550
0,60 60,480 480,570 570,690 690,900
the semester to do that

901
00:27:16,550 --> 00:27:17,930
0,180 180,420 480,900 900,1110 1110,1380
too,| like Spanner does it,|
|比如 Spanner 实现了，|

902
00:27:18,200 --> 00:27:19,430
0,360 360,510 510,690 690,930 930,1230
{} but it's not actually
但这并不完全是标准的方法，

903
00:27:19,430 --> 00:27:21,620
0,840 840,990 990,1380 1380,1950 1950,2190
completely the standard approach| or
|或者更常见的方法是有一个配置服务器，

904
00:27:21,620 --> 00:27:23,060
0,180 180,390 390,750 750,1110 1110,1440
{} more common approach actually

905
00:27:23,060 --> 00:27:25,250
0,180 180,540 750,1290 1290,1590 1590,2190
is to have a configuration

906
00:27:25,250 --> 00:27:27,580
0,540 570,930 960,1230 1230,1740
server,| like {zookeeper -}
|比如 zookeeper 服务，

907
00:27:33,750 --> 00:27:36,030
0,720 1110,1290 1290,1440 1440,1950 1950,2280
service,| and the configuration service
|配置服务内部可能使用 Paxos Raft ZAB 或任何其他，

908
00:27:36,030 --> 00:27:38,430
0,450 450,1080 1080,1290 1290,1710 1710,2400
itself internally might use Paxos

909
00:27:38,430 --> 00:27:42,240
0,510 510,1140 1290,3210 3210,3420 3420,3810
Raft or {} or ZAB

910
00:27:42,240 --> 00:27:44,730
0,90 90,690 990,1650 1680,1980 1980,2490
or whatever,| and really {}
|配置服务扮演着 coordinator 或 master 的角色，

911
00:27:44,730 --> 00:27:46,500
0,150 150,420 420,660 660,1410 1410,1770
the {configuration -} service really

912
00:27:46,500 --> 00:27:48,450
0,300 300,390 390,900 900,1020 1020,1950
plays the role of the

913
00:27:48,510 --> 00:27:50,460
0,810 810,870 870,960 960,1500 1500,1950
coordinator or the master,| like
|就像 GFS master ，

914
00:27:50,460 --> 00:27:53,460
0,90 90,630 630,1110 1680,2430 2820,3000
the GFS master,| and in
|配置服务除了

915
00:27:53,460 --> 00:27:55,380
0,540 540,720 720,1050 1050,1350 1350,1920
addition to basically having configuration

916
00:27:55,380 --> 00:27:58,410
0,540 540,750 750,1470 1710,2370 2370,3030
service| actually implemented {} using
|使用 Raft Paxos 算法实现，

917
00:27:58,410 --> 00:28:00,330
0,510 510,600 600,930 930,1620 1620,1920
one of these Raft Paxos

918
00:28:00,330 --> 00:28:02,190
0,720 900,1170 1170,1320 1320,1530 1530,1860
algorithms,| { -} you actually
|你也可以运行主备复制。

919
00:28:02,190 --> 00:28:04,680
0,570 1080,1170 1170,1530 1530,1920 1950,2490
run {} primary backup replication.|
|

920
00:28:12,680 --> 00:28:14,060
0,240 240,390 390,720 720,900 900,1380
And so we think about
所以考虑 GFS ，

921
00:28:14,090 --> 00:28:16,190
0,1110 1140,1260 1260,1800 1800,1920 1920,2100
GFS,| you know we saw
|我们在本学期早些时候看到的，

922
00:28:16,190 --> 00:28:17,570
0,300 300,360 360,420 420,1050 1110,1380
early in the semester,| has
|有这种结构，

923
00:28:17,570 --> 00:28:18,830
0,120 120,300 300,360 360,1080 1080,1260
that sort of structure,| {like,in}
|就像在 GFS 中有一个 master ，

924
00:28:18,830 --> 00:28:20,270
0,120 120,540 540,750 750,810 810,1440
the GFS was a master,|
|

925
00:28:20,480 --> 00:28:22,730
0,210 210,360 360,720 720,1590 1590,2250
and that basically determines which
这决定了哪组服务器保存特定的块，

926
00:28:22,730 --> 00:28:23,870
0,210 210,300 300,720 720,1110 1110,1140
set of servers hold {}

927
00:28:23,870 --> 00:28:26,090
0,420 420,900 1200,1410 1410,1770 1770,2220
particular chunk,| so basically determined
|确定区块的复制组，

928
00:28:26,090 --> 00:28:27,440
0,90 90,510 510,1050 1050,1260 1260,1350
the replica group for a

929
00:28:27,440 --> 00:28:29,570
0,420 810,1050 1050,1500 1560,1680 1680,2130
chunk,| and then the replica
|然后复制块组组执行主备复制，

930
00:28:29,570 --> 00:28:31,790
0,990 990,1380 1380,1680 1680,2130 2130,2220
chunk group basically executed the

931
00:28:31,790 --> 00:28:33,530
0,300 300,660 660,1230 1380,1620 1620,1740
primary backup replication,| one of
|其中一块是主节点，

932
00:28:33,530 --> 00:28:35,210
0,270 270,570 570,720 720,1050 1080,1680
the chunks was the primary|
|

933
00:28:35,330 --> 00:28:36,020
0,150 150,210 210,360 360,570 570,690
and the other ones were
另一个是备份，

934
00:28:36,020 --> 00:28:37,490
0,90 90,720 720,990 990,1170 1170,1470
the backups,| and they basically
|它们有一个用于主备复制的协议。

935
00:28:37,490 --> 00:28:38,600
0,120 120,180 180,750 750,930 930,1110
had a protocol that they

936
00:28:38,600 --> 00:28:40,100
0,210 210,330 330,630 630,960 960,1500
use for primary backup replication.|
|

937
00:28:41,140 --> 00:28:42,130
0,180 180,270 270,450 450,660 660,990
You can think about {VM-FT
你可以考虑 VM-FT 使用类似的形式，

938
00:28:42,130 --> 00:28:43,900
0,630 630,720 720,780 780,1350 1350,1770
-} in a similar style,|
|

939
00:28:43,900 --> 00:28:45,460
0,300 300,810 810,1140 1140,1230 1230,1560
where configuration server is basically
其中配置服务器是 test-and-set 服务器，

940
00:28:45,460 --> 00:28:47,140
0,330 330,540 540,1050 1140,1410 1410,1680
{test-and-set -} server,| which basically
|它记录了谁是主节点，

941
00:28:47,140 --> 00:28:48,430
0,480 480,720 720,900 900,1170 1170,1290
recorded who was actually the

942
00:28:48,430 --> 00:28:50,020
0,570 840,990 990,1110 1110,1200 1200,1590
primary,| and then the primary
|然后主备有一个协议，

943
00:28:50,020 --> 00:28:51,490
0,480 480,720 720,840 840,1230 1230,1470
backup have a protocol,| to
|发送[通道操作]到通道，

944
00:28:51,490 --> 00:28:53,560
0,510 510,930 930,1140 1140,1590 1590,2070
basically send {you,know} channel operation

945
00:28:53,560 --> 00:28:54,820
0,180 180,270 270,810 990,1140 1140,1260
down to channel,| and so
|因此，主备大致同步，

946
00:28:54,820 --> 00:28:57,670
0,540 780,1110 1110,1500 1500,1830 1890,2850
the primary backup is roughly

947
00:28:57,670 --> 00:28:59,530
0,120 120,510 540,870 870,1440 1440,1860
in sync| and implement {}
|实现复制状态机。

948
00:28:59,740 --> 00:29:01,800
0,720 720,1110 1110,1290 1290,1620
{} replicated state machine.|
|

949
00:29:02,540 --> 00:29:04,310
0,300 300,780 780,1320 1320,1710 1710,1770
And this approach tends to
这种方法往往是一种更常见的方法，

950
00:29:04,310 --> 00:29:05,270
0,150 150,390 390,420 420,660 660,960
be serve a more common

951
00:29:05,270 --> 00:29:07,240
0,660
approach,|
|

952
00:29:10,230 --> 00:29:12,480
0,750 750,1290 1290,1800 1830,2100 2100,2250
{} although the approach number
虽然第一种方法也会发生。

953
00:29:12,480 --> 00:29:15,480
0,240 240,570 570,1200 1770,2370 2430,3000
one also happens.| {} One
|一种思考这个问题的方法，

954
00:29:15,480 --> 00:29:16,500
0,240 240,360 360,510 510,750 750,1020
one way to think about

955
00:29:16,500 --> 00:29:18,090
0,450 450,570 570,990 990,1380 1380,1590
this,| {} is that you
|如果 Raft 状态，

956
00:29:18,090 --> 00:29:19,300
0,570
know

957
00:29:19,750 --> 00:29:21,430
0,570 600,810 810,1110 1110,1500 1500,1680
if the Raft states,| like
|比如，我们在实验 3 的键值服务器将是巨大的，

958
00:29:21,430 --> 00:29:22,450
0,60 60,360 360,450 450,600 600,1020
for example our key value

959
00:29:22,450 --> 00:29:24,100
0,240 240,660 660,810 810,960 960,1650
{} {server,in,lab,3} would be gigantic,|
|

960
00:29:24,100 --> 00:29:25,570
0,90 90,540 540,900 960,1260 1260,1470
you know {have,a} huge amount
有大量的这种状态，

961
00:29:25,570 --> 00:29:26,680
0,90 90,270 270,690 720,840 840,1110
of this state,| you know
|数 TB 的键值服务器，

962
00:29:26,710 --> 00:29:28,510
0,750 780,900 900,1110 1110,1380 1380,1800
terabytes of key value server,|
|

963
00:29:28,810 --> 00:29:30,400
0,360 360,720 720,990 990,1290 1290,1590
would Raft be very good
对于这种应用， Raft 会是非常好的匹配吗，

964
00:29:30,400 --> 00:29:31,360
0,420 420,600 600,720 720,870 870,960
match for that kind of

965
00:29:31,360 --> 00:29:32,600
0,750
application,|
|

966
00:29:34,740 --> 00:29:35,940
0,210 210,390 390,480 480,600 600,1200
or what is the risk,|
或者风险是什么，|

967
00:29:38,610 --> 00:29:40,480
0,210 210,270 270,660 660,1290
or the potential problem?|
或者潜在的问题？|

968
00:29:47,380 --> 00:29:49,570
0,360 360,870 870,1290 1290,1650 1710,2190
{} We flush the log
我们经常刷新日志，

969
00:29:49,570 --> 00:29:51,620
0,360 360,900 900,1470
very often,| so
|所以，这可能会带来问题。

970
00:29:51,680 --> 00:29:53,360
0,300 300,510 510,600 600,720 720,1680
maybe that could be problematic.|
|

971
00:29:53,750 --> 00:29:56,120
0,240 240,330 330,1140 1140,2160 2160,2370
Could be problematic,| what how
可能会有问题，|检查点的大小是多少，

972
00:29:56,120 --> 00:29:57,320
0,570 570,750 750,1050 1050,1110 1110,1200
what's the size of the

973
00:29:57,320 --> 00:29:58,460
0,600
checkpoint,|
|

974
00:29:59,740 --> 00:30:01,420
0,330 330,810 840,1050 1050,1560 1560,1680
if our key {value,server} is
如果我们的键值服务器非常大。

975
00:30:01,420 --> 00:30:02,640
0,240 240,660
really big.|
|

976
00:30:04,930 --> 00:30:06,370
0,270 270,780 780,990 990,1050 1050,1440
It's linear in the size
它与键值服务器的大小成正比。

977
00:30:06,370 --> 00:30:07,720
0,120 120,270 270,900 900,1080 1080,1350
of the {key,value,server} {}.| Yeah,
|是的，所以这也可能是巨大的，

978
00:30:07,720 --> 00:30:08,800
0,150 240,300 300,690 690,900 900,1080
so that could also be

979
00:30:08,800 --> 00:30:10,780
0,750 840,1020 1020,1200 1200,1830 1860,1980
gigantic,| so at any you
|所以在任何时候，检查点必须被发送，

980
00:30:10,780 --> 00:30:12,040
0,270 270,540 540,750 750,870 870,1260
know any time the checkpoint

981
00:30:12,040 --> 00:30:12,910
0,150 150,240 240,330 330,750 780,870
has to be sent,| you
|这将是一个很大的检查点。

982
00:30:12,910 --> 00:30:13,420
0,150 150,240 240,360 360,420 420,510
know it's going to be

983
00:30:13,420 --> 00:30:14,780
0,60 60,270 270,900
a big checkpoint.|
|

984
00:30:14,900 --> 00:30:16,040
0,390 390,510 510,690 690,1050 1050,1140
And so the Raft it's
所以 Raft 并不是设置好的，

985
00:30:16,040 --> 00:30:16,820
0,210 210,360 360,510 510,570 570,780
not really sort of set

986
00:30:16,820 --> 00:30:19,610
0,330 330,450 450,1470 1470,2160 2580,2790
up,| you know {} so
|主节点需要通信，

987
00:30:19,610 --> 00:30:20,270
0,120 120,420 420,480 480,600 600,660
the primary is going to

988
00:30:20,270 --> 00:30:21,230
0,510 510,600 600,750 750,840 840,960
communicate,| you know the new
|新的主节点将与快照通信，

989
00:30:21,230 --> 00:30:23,510
0,330 330,960 960,1560 1560,2040 2040,2280
{primary,is,going,to} communicate [] snapshots,| you
|你在实验 2d 中所做的，

990
00:30:23,510 --> 00:30:24,530
0,150 150,240 240,510 510,630 630,1020
did in lab {2d -},|
|

991
00:30:24,530 --> 00:30:25,400
0,60 60,240 240,540 540,810 810,870
you know to the the
到备节点，

992
00:30:25,400 --> 00:30:27,020
0,510 510,1020 1020,1170 1170,1260 1260,1620
backups,| they're gonna be big.|
|它们会很大。|

993
00:30:27,760 --> 00:30:29,440
0,360 360,780 930,1230 1230,1500 1500,1680
And so you often want
所以你想要更聪明的方案，

994
00:30:29,440 --> 00:30:30,040
0,180 180,300 300,330 330,480 480,600
to be a little bit

995
00:30:30,040 --> 00:30:32,560
0,180 180,540 540,1170 1350,1770 1770,2520
more clever plan| to synchronize
|重新同步新服务器，

996
00:30:32,560 --> 00:30:34,840
0,180 180,420 420,1230 1260,1710 1710,2280
and {re-synchronize -} new servers,|
|

997
00:30:35,020 --> 00:30:37,510
0,570 750,1320 1320,1890 1890,2070 2070,2490
and {} so and one
所以，一个原因，

998
00:30:37,510 --> 00:30:38,830
0,300 300,420 420,840 840,1170 1170,1320
reason that,| basically often these
|这些东西通常被分成两个不同的部分，

999
00:30:38,830 --> 00:30:40,150
0,210 210,300 300,720 720,1140 1140,1320
things are split into two

1000
00:30:40,150 --> 00:30:41,980
0,270 270,690 690,1230 1230,1290 1290,1830
different pieces,| where the configuration
|其中配置服务在状态方面很小，

1001
00:30:41,980 --> 00:30:43,810
0,480 480,630 630,1020 1020,1530 1530,1830
service that basically small {in,terms,of}

1002
00:30:43,810 --> 00:30:45,640
0,480 780,930 930,1290 1290,1470 1470,1830
state,| and then {you,know} primary
|然后，主备方案可能复制大量数据。

1003
00:30:45,640 --> 00:30:48,430
0,390 390,930 930,1680 1680,2130 2160,2790
backup plan actually may replicate

1004
00:30:48,430 --> 00:30:49,900
0,420 420,660 660,720 720,1020
huge amount of data.|
|

1005
00:30:50,390 --> 00:30:51,530
0,270 270,630 720,870 870,930 930,1140
And so this is why,
这就是为什么，你看到这两种方法的一个原因。

1006
00:30:51,530 --> 00:30:52,580
0,360 360,660 660,750 750,930 930,1050
one reason you see sort

1007
00:30:52,580 --> 00:30:54,020
0,60 60,240 240,930
of both approaches.|
|

1008
00:30:54,920 --> 00:30:56,180
0,120 120,210 210,330 330,720
Does that make sense?|
这能理解吗？|

1009
00:30:57,620 --> 00:30:58,490
0,240 240,360 360,570 570,630 630,870
I'll come back to that
我会在课程结束时再讲到这一点，

1010
00:30:58,490 --> 00:30:58,970
0,60 60,180 180,300 300,390 390,480
at the end of the

1011
00:30:58,970 --> 00:31:00,650
0,300 300,660 720,1380 1380,1530 1530,1680
lecture again,| {} but it's
|但重要的是要记住这一点。

1012
00:31:00,650 --> 00:31:01,820
0,360 360,420 420,540 540,690 690,1170
important to keep this {in,mind}.|
|

1013
00:31:02,470 --> 00:31:04,510
0,540 540,780 1110,1260 1260,1470 1470,2040
So {what,approach} or what benefits
那么，方案 1 比 2 有什么好处呢？

1014
00:31:04,510 --> 00:31:06,130
0,300 300,690 690,930 930,1170 1170,1620
does 1 give over 2?|
|

1015
00:31:07,360 --> 00:31:08,530
0,540 540,750 750,960 960,1110 1110,1170
{} You don't have to
你不需要有它们两个，

1016
00:31:08,530 --> 00:31:10,150
0,240 240,450 450,540 540,870 1200,1620
have two of them, right,|
|

1017
00:31:10,150 --> 00:31:11,740
0,240 240,750 750,900 900,1260 1260,1590
in one, you basically have
在 1 中，你有 Raft ，

1018
00:31:11,740 --> 00:31:13,060
0,420 420,540 540,720 720,810 810,1320
Raft,| you run the operations
|你运行[]操作，然后也为你进行配置，

1019
00:31:13,060 --> 00:31:14,260
0,180 180,690 690,780 780,990 990,1200
for [] and then does

1020
00:31:14,260 --> 00:31:16,180
0,90 90,600 600,750 750,1260 1620,1920
the configuration for {you,too},| so
|所以，所有的东西都在一个单一的组件中，

1021
00:31:16,180 --> 00:31:17,500
0,360 360,510 510,600 600,660 660,1320
everything is in a single,

1022
00:31:18,550 --> 00:31:21,400
0,420 420,900 1770,2100 2100,2670 2670,2850
single component,| and here in
|在 2 中，我们有两个组件，

1023
00:31:21,400 --> 00:31:22,090
0,210 210,360 360,480 480,570 570,690
number two, we have two

1024
00:31:22,090 --> 00:31:23,530
0,600 600,690 690,810 810,930 930,1440
components,| you know we have
|我们有一个配置服务，包括 Raft ，

1025
00:31:23,530 --> 00:31:25,000
0,120 120,570 570,960 960,1110 1110,1470
a configuration service, that includes

1026
00:31:25,000 --> 00:31:26,710
0,600 690,1110 1110,1230 1230,1620 1620,1710
Raft,| and we have a
|而且我们有一个主备方案。

1027
00:31:26,710 --> 00:31:28,940
0,270 270,570 570,1110
primary backup scheme.|
|

1028
00:31:30,400 --> 00:31:31,840
0,120 120,300 300,390 390,930 1110,1440
So maybe this will become
所以，这个可能会变得更加清楚，

1029
00:31:31,840 --> 00:31:32,860
0,120 120,450 450,570 570,780 780,1020
more clear,| as we talk
|当我们讨论链式复制时。

1030
00:31:32,860 --> 00:31:34,400
0,210 210,420 420,960
about chain replication.|
|

1031
00:31:36,480 --> 00:31:38,280
0,480 840,990 990,1320 1320,1560 1560,1800
{} Yeah.| I had a
嗯。|我有一个非常简短的问题，

1032
00:31:38,280 --> 00:31:39,810
0,150 150,330 330,870 900,1230 1230,1530
really quick question,| so I
|所以第二个，

1033
00:31:39,840 --> 00:31:41,730
0,510 510,750 750,1230 1560,1710 1710,1890
[] for two,| I guess
|优势是什么，

1034
00:31:41,730 --> 00:31:43,470
0,300 510,750 750,1110 1110,1230 1230,1740
would like what the advantage

1035
00:31:43,470 --> 00:31:45,270
0,180 180,270 270,420 420,870 1410,1800
being that you have like,|
|

1036
00:31:45,270 --> 00:31:46,740
0,240 240,810 810,1170 1170,1320 1320,1470
if consensus reached through the
如果通过领导者达成共识，

1037
00:31:46,740 --> 00:31:48,270
0,510 630,810 810,900 900,1140 1140,1530
leader| and the leader never
|领导者永远不会失败，对吧。

1038
00:31:48,270 --> 00:31:49,800
0,420 420,720 720,1050
fails, right, like.|
|

1039
00:31:50,220 --> 00:31:51,390
0,360 360,540 540,750 750,1050 1050,1170
Yeah, so the advantage of
是的，所以第二个的优势是，

1040
00:31:51,390 --> 00:31:52,350
0,270 270,480 480,720 720,840 840,960
two is that,| as we
|正如我们随后会在链式复制中看到的，

1041
00:31:52,350 --> 00:31:53,460
0,150 150,270 270,660 660,840 840,1110
see in second in chain

1042
00:31:53,460 --> 00:31:55,470
0,690 840,1260 1260,1470 1470,1650 1650,2010
replication is,| there's a separate
|有一个单独的进程负责配置部分，

1043
00:31:55,470 --> 00:31:56,670
0,360 360,570 600,870 870,1110 1110,1200
process that takes care of

1044
00:31:56,670 --> 00:31:58,500
0,90 90,750 750,1170 1200,1710 1710,1830
the configuration part,| and you
|你不必担心你的主备份复制方案。

1045
00:31:58,500 --> 00:31:59,580
0,300 300,420 420,540 540,780 780,1080
don't have to worry about

1046
00:31:59,580 --> 00:32:00,570
0,120 120,360 360,480 480,690 690,990
in terms of your primary

1047
00:32:00,570 --> 00:32:02,200
0,330 330,780 780,1140
backup replication scheme.|
|

1048
00:32:02,600 --> 00:32:04,520
0,360 360,780 780,1170 1170,1410 1410,1920
{} And that just decides
这就像 GFS 一样决定了，

1049
00:32:04,520 --> 00:32:05,600
0,270 270,750 750,900 900,1020 1020,1080
like GFS,| that's sort of
|比如 master ，

1050
00:32:05,600 --> 00:32:06,650
0,150 150,210 210,690 690,900 900,1050
like the master,| it just
|它决定这里的几个，

1051
00:32:06,650 --> 00:32:07,520
0,420 420,510 510,600 600,810 810,870
decides for a couple of

1052
00:32:07,520 --> 00:32:08,150
0,240 240,300 300,450 450,570 570,630
here,| set up have the
|设置服务形成特定复制组，

1053
00:32:08,150 --> 00:32:09,470
0,360 360,540 540,810 810,930 930,1320
service to form this particular

1054
00:32:09,470 --> 00:32:10,560
0,330 330,630
replica group,|
|

1055
00:32:10,620 --> 00:32:13,500
0,630 660,1290 1290,1620 1620,2490 2490,2880
and backup primary backup protocol
而主备协议不用考虑这个。

1056
00:32:13,500 --> 00:32:14,280
0,210 210,330 330,420 420,570 570,780
doesn't have to think about

1057
00:32:14,280 --> 00:32:15,200
0,330
this.|
|

1058
00:32:16,240 --> 00:32:17,220
0,450
Thanks.|
谢谢。|

1059
00:32:17,370 --> 00:32:18,780
0,240 240,870 960,1200 1200,1350 1350,1410
And so this is a
这是对链式复制的一个很好的介绍，

1060
00:32:18,780 --> 00:32:20,310
0,150 150,690 690,1080 1080,1260 1290,1530
good introduction to {} chain

1061
00:32:20,310 --> 00:32:21,930
0,480 480,780 780,870 870,1110 1110,1620
replication,| because the chain replication
|因为链式复制正是

1062
00:32:21,930 --> 00:32:23,400
0,90 90,840 1020,1260 1260,1410 1410,1470
is exactly| that sort of
|方法 2 的主备复制方案。

1063
00:32:23,400 --> 00:32:27,330
0,120 120,810 930,1710 2190,3330 3330,3930
a primary backup replication scheme

1064
00:32:29,010 --> 00:32:31,300
0,330 330,660 660,1020
for approach 2.|
|

1065
00:32:35,650 --> 00:32:36,490
0,120 120,240 240,360 360,480 480,840
And that is to say
就是说，链式复制假设，

1066
00:32:36,490 --> 00:32:37,780
0,240 240,360 360,660 660,1050 1050,1290
that you know {} chain

1067
00:32:37,780 --> 00:32:40,780
0,510 510,1200 1230,1410 1410,1650 1650,3000
replication assumes,| there is a
|有一个配置服务，

1068
00:32:40,780 --> 00:32:43,090
0,630 630,1200 1650,2040 2040,2160 2160,2310
configuration service,| {} and I
|我想他们在论文中成为 master 。

1069
00:32:43,090 --> 00:32:44,080
0,150 150,240 240,510 510,630 630,990
think they called the master

1070
00:32:44,080 --> 00:32:45,500
0,450 450,930
{process,in} paper.|
|

1071
00:32:45,880 --> 00:32:47,950
0,570 660,1230 1230,1470 1470,1890 1890,2070
{} Then chain replication themselves,|
然后链式复制本身，|

1072
00:32:47,950 --> 00:32:49,330
0,180 180,210 210,870 870,990 990,1380
there's a couple of cool
有几个很酷的属性。

1073
00:32:49,330 --> 00:32:50,580
0,720
properties.|
|

1074
00:32:50,580 --> 00:32:53,840
0,330 330,990 1110,1440 1440,2310
{} One, read operations
一，读操作或者他们称为查询操作只涉及一个服务器，

1075
00:32:53,840 --> 00:32:54,740
0,210 210,330 330,510 510,720 720,900
or as they call them

1076
00:32:54,740 --> 00:32:58,100
0,330 330,1170 2400,2850 2850,3150 3150,3360
query operations involve only one

1077
00:32:58,100 --> 00:32:59,940
0,570
server,|
|

1078
00:33:01,430 --> 00:33:03,950
0,600 600,1170 1380,1680 1680,2040 2070,2520
namely {the,tail} as we've seen
也就是我们随后会看到的 tail 。

1079
00:33:03,950 --> 00:33:05,120
0,60 60,540
{in,a} second.|
|

1080
00:33:05,120 --> 00:33:06,640
0,810

1081
00:33:07,120 --> 00:33:09,070
0,420 420,900 900,1260 1260,1740 1740,1950
Another nice property about chain
链式复制的另一个很好的特性是具有非常简单的恢复方案。

1082
00:33:09,070 --> 00:33:10,180
0,450 450,570 570,750 750,840 840,1110
replication that has a very

1083
00:33:10,180 --> 00:33:12,440
0,600 600,1080 1080,1440
simple recovery plan.|
|

1084
00:33:13,510 --> 00:33:14,290
0,240 240,360 360,420 420,570 570,780
I'm going to talk about
我随后将更详细地讨论这些。

1085
00:33:14,290 --> 00:33:14,950
0,150 150,240 240,420 420,510 510,660
all of these in more

1086
00:33:14,950 --> 00:33:17,300
0,420 420,480 480,570 570,990
detail in the second.|
|

1087
00:33:18,910 --> 00:33:20,350
0,600 690,870 870,1050 1050,1320 1320,1440
And {presumably -} something that
很可能一些事情开始，

1088
00:33:20,350 --> 00:33:22,660
0,210 210,690 870,1470 1590,2160 2160,2310
you started,| have you you
|你理解这个事实，

1089
00:33:22,660 --> 00:33:24,250
0,540 540,750 750,810 810,1230 1230,1590
appreciate given the fact| how
|在 Raft 上能有多复杂。

1090
00:33:24,250 --> 00:33:25,780
0,570 570,660 660,870 870,960 960,1530
complicated can be in Raft.|
|

1091
00:33:26,230 --> 00:33:28,060
0,480 480,990 990,1230 1230,1590 1590,1830
{} And it provides actually
而且它提供了很强的性质，即线性一致性，

1092
00:33:28,060 --> 00:33:32,920
0,720 2340,3600 3600,4170 4170,4650 4650,4860
strong strong properties, namely {linearizability

1093
00:33:32,920 --> 00:33:34,100
0,690
-},|
|

1094
00:33:34,550 --> 00:33:35,210
0,240 240,360 360,540 540,600 600,660
if we put {and -}
如果我们进行 put 和 get 操作。

1095
00:33:35,210 --> 00:33:37,790
0,210 210,930 1440,1770 1770,2310 2310,2580
get operations.| And finally just
|最后，很多人问到，

1096
00:33:37,790 --> 00:33:38,960
0,180 180,330 330,390 390,600 600,1170
a lot of people askes,|
|

1097
00:33:38,960 --> 00:33:40,640
0,210 210,480 480,540 540,1050 1050,1680
{you,know} actually a reasonable influential
是一个合理的有影响力的设计，

1098
00:33:40,640 --> 00:33:41,760
0,540
design,|
|

1099
00:33:43,020 --> 00:33:44,190
0,450 450,780 780,900 900,1140 1140,1170
and used by quite a
并被很多系统使用，

1100
00:33:44,190 --> 00:33:46,440
0,240 240,330 330,990
number of systems,|
|

1101
00:33:46,640 --> 00:33:47,870
0,330 330,630 630,810 810,1020 1020,1230
{} so these are used
所以这些都是在实践中使用的。

1102
00:33:47,870 --> 00:33:49,080
0,90 90,660
in practice.|
|

1103
00:33:50,080 --> 00:33:51,130
0,330 330,600 600,840 840,900 900,1050
This is going to talk
这将讨论这些组件中的每一个，

1104
00:33:51,130 --> 00:33:52,210
0,210 210,330 330,420 420,570 570,1080
about each of these components,|
|

1105
00:33:52,210 --> 00:33:53,470
0,90 90,270 270,450 450,630 630,1260
and we'll get more detail,|
我们会得到更多细节，|

1106
00:33:53,710 --> 00:33:55,120
0,480 480,810 810,930 930,1050 1050,1410
and then we'll come back
然后我们将回到方法一对比方法二。

1107
00:33:55,120 --> 00:33:55,960
0,180 180,330 330,510 510,570 570,840
to this sort of approach

1108
00:33:55,960 --> 00:33:57,760
0,240 240,570 570,930 930,1260
one versus approach two.|
|

1109
00:34:00,250 --> 00:34:01,300
0,360 360,660 660,780 780,990 990,1050
{} So in terms of
所以从总体上来说，

1110
00:34:01,300 --> 00:34:02,720
0,60 60,750
an overview,|
|

1111
00:34:07,060 --> 00:34:09,880
0,450 570,1320 1740,2040 2040,2130 2130,2820
oops,| {} {in,terms,of} an overview,|
糟糕，|一个概述，|

1112
00:34:10,210 --> 00:34:11,800
0,570 720,1110 1110,1260 1260,1320 1320,1590
{} new sort of []
新的[]类型，

1113
00:34:11,800 --> 00:34:12,700
0,90 90,180 180,660 690,810 810,900
of the land,| you know
|这里有一个大的进程或一个配置服务，

1114
00:34:12,700 --> 00:34:15,370
0,180 180,360 360,810 1170,1860 1860,2670
there is a massive process

1115
00:34:17,550 --> 00:34:20,240
0,420 420,960 960,1680
{or,a} configuration service,|
|

1116
00:34:23,820 --> 00:34:25,200
0,120 120,360 360,660 660,780 780,1380
and then basically keep track|
然后跟踪|

1117
00:34:25,230 --> 00:34:26,640
0,90 90,300 300,840 840,1260 1260,1410
you know which server {you,know
哪台服务器属于特定的链。

1118
00:34:26,640 --> 00:34:28,140
0,150 150,240 240,840 1050,1410 1410,1500
- -} belong to a

1119
00:34:28,140 --> 00:34:30,320
0,870 870,1500
particular chain.|
|

1120
00:34:30,320 --> 00:34:32,120
0,420 450,660 660,1110 1110,1350 1350,1800
So {S1 -} {S2 -}
所以 S1 S2 S3 ，

1121
00:34:32,120 --> 00:34:33,380
0,180 180,540 540,750 750,1140 1140,1260
{S3 -}| {you,know} basically have
|有一个关于是什么链的记录，

1122
00:34:33,380 --> 00:34:34,100
0,30 30,420 420,480 480,630 630,720
a record of what the

1123
00:34:34,100 --> 00:34:36,140
0,750 870,1170 1170,1620 1620,1860 1860,2040
{chain,is},| who the head is
|谁是头，谁是尾，

1124
00:34:36,140 --> 00:34:37,430
0,90 90,270 270,360 360,990 1020,1290
and who the {tail,is},| and
|所以这可能是配置服务，

1125
00:34:37,430 --> 00:34:38,990
0,480 870,1110 1110,1320 1320,1380 1380,1560
so that could be configuration

1126
00:34:38,990 --> 00:34:40,490
0,450 450,750 750,1200 1200,1350 1350,1500
service,| and here we do
|在这里，我们有我们的服务，

1127
00:34:40,490 --> 00:34:41,750
0,240 240,510 510,690 690,930 930,1260
actually have our {service -},|
|

1128
00:34:41,750 --> 00:34:43,340
0,90 90,210 210,420 420,930
you know {S1 -}
S1 S2 S3 ，

1129
00:34:43,370 --> 00:34:44,860
0,300 300,930
{S2 -}

1130
00:34:46,160 --> 00:34:47,720
0,390 390,960
{S3 -},|
|

1131
00:34:49,870 --> 00:34:51,160
0,330 330,510 510,600 600,990 990,1290
and one of them is
其中一个是头部，

1132
00:34:51,160 --> 00:34:52,260
0,480
the

1133
00:34:52,410 --> 00:34:54,090
0,510 780,1320 1320,1440 1440,1620 1620,1680
head,| typically {the,one} {with -
|通常是数字较小的那个，

1134
00:34:54,090 --> 00:34:56,370
0,150 150,210 210,840 930,1680 1680,2280
-} the smaller number,| and
|一个是尾部。

1135
00:34:56,430 --> 00:34:58,660
0,330 330,450 450,1140
one is {the,tail}.|
|

1136
00:35:00,160 --> 00:35:01,180
0,360 360,510 510,810 810,930 930,1020
And so we have a
所以我们有一个客户端，

1137
00:35:01,180 --> 00:35:02,480
0,600
client,|
|

1138
00:35:03,190 --> 00:35:04,390
0,270 270,510 510,810 810,930 930,1200
{} the client may talk
客户端可以访问配置服务器，

1139
00:35:04,390 --> 00:35:05,710
0,90 90,150 150,690 690,1200 1200,1320
to the configuration server,| who
|它是链的一部分，

1140
00:35:05,710 --> 00:35:08,230
0,900 900,1440 1980,2340 2340,2400 2400,2520
are actually part of the

1141
00:35:08,230 --> 00:35:10,150
0,630 900,1440 1440,1680 1680,1860 1860,1920
chain,| {} and then it
|然后它向头部发送写请求，

1142
00:35:10,150 --> 00:35:12,220
0,240 240,600 600,1230 1290,1860 1860,2070
sends {a,write} request to the

1143
00:35:12,220 --> 00:35:13,340
0,480
head,|
|

1144
00:35:13,370 --> 00:35:14,570
0,180 180,390 390,540 540,660 660,1200
so this is a protocol
所以这是一种链式复制协议，

1145
00:35:14,570 --> 00:35:16,130
0,300 300,690 690,1200 1200,1320 1320,1560
in chain replication,| the write
|写请求总是发送到头部，

1146
00:35:16,130 --> 00:35:17,660
0,390 390,720 720,1020 1020,1200 1200,1530
request always goes to the,

1147
00:35:18,370 --> 00:35:20,620
0,570 960,1110 1110,1590 1860,2100 2100,2250
{} the head,| and what
|头部所做的，头部推送，

1148
00:35:20,620 --> 00:35:21,460
0,90 90,270 270,600 600,660 660,840
the head does, the head

1149
00:35:21,460 --> 00:35:23,470
0,300 300,900 900,1350 1350,1590 1590,2010
basically pushes,| {you,know,the,head} actually applies
|头部对它的状态进行操作，

1150
00:35:23,470 --> 00:35:25,360
0,90 90,780 1050,1500 1500,1740 1740,1890
the operation {} on its

1151
00:35:25,360 --> 00:35:26,440
0,420 420,540 540,780 780,870 870,1080
state,| and maybe it has
|也许它有一个关联的磁盘，

1152
00:35:26,440 --> 00:35:28,030
0,60 60,540 570,1230 1230,1410 1410,1590
a disk associated with it,|
|

1153
00:35:28,030 --> 00:35:30,100
0,840 1140,1230 1230,1530 1530,1890 1890,2070
whatever the {key,value} service on
键值服务在上面，

1154
00:35:30,100 --> 00:35:32,110
0,150 690,1260 1260,1590 1590,1680 1680,2010
it,| and then it sends
|然后它发送更新，

1155
00:35:32,110 --> 00:35:33,580
0,390 420,1020 1050,1110 1110,1230 1230,1470
the update,| you know there's
|所有的操作在链上按照先进先出的顺序可靠地进行，

1156
00:35:33,580 --> 00:35:36,280
0,210 210,300 300,870 900,1860 1890,2700
all of the operation down

1157
00:35:36,280 --> 00:35:37,260
0,90 90,570
the chain

1158
00:35:38,300 --> 00:35:40,280
0,240 240,570 570,810 810,1410 1410,1980
in {FIFO -} order and

1159
00:35:40,280 --> 00:35:42,260
0,630 810,1230 1230,1560 1560,1710 1710,1980
reliably,| {} so {S1 -}
|所以， S1 发送更新给 S2 ，

1160
00:35:42,260 --> 00:35:43,760
0,330 330,570 570,660 660,1050 1050,1500
will send the update to

1161
00:35:43,760 --> 00:35:45,650
0,180 180,690 1050,1410 1410,1620 1620,1890
{S2 -},| {S2 -} it
|S2 有自己的磁盘，

1162
00:35:45,650 --> 00:35:47,420
0,180 180,420 420,870 900,1440 1440,1770
has {make,its,own} disk,| apply the
|将操作或状态更改应用于它的状态，

1163
00:35:47,420 --> 00:35:49,700
0,660 660,1020 1020,1470 1500,1920 1920,2280
operation or the state change

1164
00:35:49,700 --> 00:35:52,130
0,270 270,750 750,1350 1800,2130 2130,2430
to its state,| {} once
|一旦它应用了它，

1165
00:35:52,130 --> 00:35:53,780
0,390 390,870 870,1170 1380,1560 1560,1650
{it,actually} applyed it,| you know
|它会把它发送到链中的最后一个节点，

1166
00:35:53,780 --> 00:35:55,220
0,180 180,420 420,780 780,930 930,1440
it will forward it to

1167
00:35:55,670 --> 00:35:57,950
0,690 780,1500 1500,2130 2130,2220 2220,2280
the last node in the

1168
00:35:57,950 --> 00:35:59,090
0,450 450,570 570,990 990,1110 1110,1140
chain,| {in,this}, because there are
|因为在这个链中只有三个节点，

1169
00:35:59,090 --> 00:35:59,900
0,210 210,360 360,600 600,660 660,810
only three nodes in this

1170
00:35:59,900 --> 00:36:00,950
0,330 330,660 660,750 750,870 870,1050
particular chain,| you could have
|你可以有更长的链，

1171
00:36:00,950 --> 00:36:04,070
0,360 360,480 480,1350 1800,2430 2430,3120
chains are longer,| {if,you,want,more} availability,|
|如果你想要更多的可用性，|

1172
00:36:04,690 --> 00:36:06,430
0,480 750,930 930,1110 1110,1410 1440,1740
{} and when the last
当最后一个节点收到状态改变的消息，

1173
00:36:06,430 --> 00:36:09,160
0,390 390,690 690,1650 1800,2280 2280,2730
node gets the message with

1174
00:36:09,160 --> 00:36:11,260
0,540 540,1110 1200,1560 1560,1680 1680,2100
state change,| {} it applies
|它应用于它的状态，

1175
00:36:11,260 --> 00:36:14,050
0,360 360,780 780,1380 2250,2430 2430,2790
to its state,| and then
|然后这是向客户端发回确认的[时机]，

1176
00:36:14,050 --> 00:36:15,340
0,240 270,510 510,720 720,1110 1110,1290
{} this {is,the} charge actually

1177
00:36:15,340 --> 00:36:16,930
0,120 120,420 420,510 510,1110 1110,1590
{} sending an acknowledgment back

1178
00:36:16,990 --> 00:36:19,220
0,600 600,1080 1110,1710
to the client,|
|

1179
00:36:20,440 --> 00:36:21,640
0,180 180,300 300,840 840,930 930,1200
so it's {the,tail} who sends
所以是尾部发回确认信息。

1180
00:36:21,640 --> 00:36:23,220
0,60 60,630 630,1020
the acknowledgement back.|
|

1181
00:36:23,840 --> 00:36:25,180
0,750

1182
00:36:25,180 --> 00:36:27,460
0,240 240,720 870,1500 1500,1980 1980,2280
And so {} one way
所以，考虑这一问题的一种方式是，

1183
00:36:27,460 --> 00:36:28,600
0,330 330,540 540,780 780,990 990,1140
to think about this is

1184
00:36:28,600 --> 00:36:30,640
0,210 210,480 480,900 1260,1830 1830,2040
that,| when the tail or
|当尾部或在这种情况下 S3 应用了状态变化，

1185
00:36:30,640 --> 00:36:31,660
0,60 60,180 180,390 390,540 540,1020
in this case {S3 -}

1186
00:36:31,660 --> 00:36:32,920
0,60 60,300 300,630 630,1140 1140,1260
you know actually applies to

1187
00:36:32,920 --> 00:36:34,300
0,330 330,780 810,1050 1050,1290 1290,1380
state change,| that's {sort,of} the
|这就是提交点。

1188
00:36:34,300 --> 00:36:35,580
0,330 330,780
commit point.|
|

1189
00:36:39,080 --> 00:36:39,890
0,180 180,240 240,540 540,660 660,810
And the reason that this
之所以这是提交点，

1190
00:36:39,890 --> 00:36:41,000
0,120 120,210 210,510 510,870 870,1110
is the commit point| is
|是因为后续读取总是从尾部获取，

1191
00:36:41,000 --> 00:36:43,910
0,270 270,840 840,1410 2190,2730 2730,2910
because subsequent reads always come

1192
00:36:43,910 --> 00:36:45,110
0,180 180,270 270,750 810,1050 1050,1200
from the tail,| so if
|所以，如果任何客户端执行读操作，

1193
00:36:45,110 --> 00:36:46,640
0,480 480,630 630,810 810,990 990,1530
anybody or any other client

1194
00:36:48,000 --> 00:36:50,010
0,300 300,570 570,870 870,1530 1620,2010
{you,know} {does,a} read operation, {}|
|

1195
00:36:50,010 --> 00:36:51,300
0,150 150,420 420,570 570,690 690,1290
they always go to {the,tail},|
它们总是到尾部，|

1196
00:36:52,160 --> 00:36:53,540
0,150 150,210 210,540 540,930 930,1380
and the tail basically responds
尾部会立即对它们做出反应。

1197
00:36:53,540 --> 00:36:55,080
0,420 420,690 690,750 750,960
immediately back to them.|
|

1198
00:36:55,360 --> 00:36:56,530
0,240 270,510 510,930 930,1050 1050,1170
So read operations go to
所以读操作到尾部，

1199
00:36:56,530 --> 00:36:58,270
0,630 660,870 870,1200 1200,1470 1470,1740
{the,tail},| so here's client 1,
|这是客户端 1 ，这是客户端 2 ，

1200
00:36:58,270 --> 00:36:59,950
0,150 150,240 240,540 540,1050 1290,1680
here is client 2,| client
|客户端 2 进行读操作，

1201
00:36:59,950 --> 00:37:01,720
0,90 90,270 270,480 480,1200 1290,1770
2 does read operation, {}|
|

1202
00:37:01,720 --> 00:37:03,490
0,900 900,1110 1110,1230 1230,1320 1320,1770
it goes to the tail,|
它到达尾部，|

1203
00:37:03,490 --> 00:37:04,780
0,180 180,510 510,990 990,1080 1080,1290
the tail responds and that's
尾部做出响应，就是这样。

1204
00:37:04,780 --> 00:37:05,560
0,180
it.|
|

1205
00:37:06,630 --> 00:37:07,290
0,210 210,330 330,450 450,480 480,660
And so there's a couple
所以有几件事我想指出，

1206
00:37:07,290 --> 00:37:08,310
0,270 270,420 420,540 540,960 960,1020
things that I wanted to

1207
00:37:08,310 --> 00:37:11,550
0,300 300,720 960,1830 2280,2970 3000,3240
point out,| {} the one
|其中一个有趣的问题是，

1208
00:37:11,550 --> 00:37:12,750
0,300 300,390 390,690 690,960 960,1200
of the interesting points out

1209
00:37:12,750 --> 00:37:13,830
0,90 90,210 210,300 300,510 510,1080
is that,| the read operations
|读操作只涉及一台服务器，

1210
00:37:13,830 --> 00:37:15,560
0,150 150,510 510,660 660,1200
just involve one server,

1211
00:37:16,040 --> 00:37:17,420
0,360 360,510 510,900 900,960 960,1380
right,| like if you remember
|如果记得实验 3 ，

1212
00:37:17,420 --> 00:37:19,430
0,420 420,1050 1050,1530 1560,1920 1920,2010
from lab 3,| or if
|或者如果你有任何进展，

1213
00:37:19,430 --> 00:37:20,540
0,60 60,150 150,270 270,690 690,1110
you have any progress,| we've
|我们已经开始实验 3 ，

1214
00:37:20,540 --> 00:37:21,860
0,300 300,420 420,690 690,1020 1020,1320
started to do lab 3,|
|

1215
00:37:21,950 --> 00:37:24,590
0,300 300,840 840,1230 1230,1920 2070,2640
read operations actually involved,| {you,know}
读操作涉及，|在我们的实现中，读取操作通过 Raft 日志，

1216
00:37:24,590 --> 00:37:27,320
0,990 990,1200 1200,1830 1830,2310 2310,2730
in our implementation, read operation

1217
00:37:27,320 --> 00:37:30,140
0,240 240,570 570,1020 1050,1740 1740,2820
go through the Raft log,|
|

1218
00:37:30,140 --> 00:37:30,800
0,210 210,360 360,480 480,600 600,660
and all that kind of
以及所有东西，

1219
00:37:30,800 --> 00:37:33,170
0,420 810,1110 1200,1590 1590,2070 2070,2370
stuff,| the paper discusses an
|论文讨论了一个优化，

1220
00:37:33,170 --> 00:37:35,540
0,1140 1380,1740 1740,1800 1800,1950 1950,2370
optimization,| but the read operation
|但读取操作始终由领导者执行，

1221
00:37:35,540 --> 00:37:36,800
0,420 420,600 600,690 690,840 840,1260
always goes to the leader,|
|

1222
00:37:36,800 --> 00:37:37,910
0,270 270,360 360,630 630,930 930,1110
and the leader first has
而领导者首先必须联系大多数服务器，

1223
00:37:37,910 --> 00:37:39,500
0,330 330,960 960,1050 1050,1500 1500,1590
to contact the majority of

1224
00:37:39,500 --> 00:37:40,580
0,60 60,450 450,810 810,960 960,1080
the servers,| before it can
|在执行操作之前。

1225
00:37:40,580 --> 00:37:41,990
0,480 480,570 570,1020 1020,1080 1080,1410
execute the operation {} local.|
|

1226
00:37:42,410 --> 00:37:43,400
0,210 210,390 390,690 690,810 810,990
{} So what you see
所以你在这里看到的是，

1227
00:37:43,400 --> 00:37:44,750
0,390 390,510 510,780 930,1170 1170,1350
here is that,| the read
|读操作通过尾部，

1228
00:37:44,750 --> 00:37:46,100
0,450 450,660 660,810 810,990 990,1350
operation actually go through tail,|
|

1229
00:37:46,100 --> 00:37:48,890
0,120 120,330 1530,1860 1860,2130 2130,2790
so that {} different server
写操作从不同的服务器，

1230
00:37:48,920 --> 00:37:50,510
0,210 210,480 480,990 990,1170 1170,1590
from write operations,| so the
|所以，读写工作负载至少分布在两台服务器上，

1231
00:37:50,510 --> 00:37:52,070
0,300 300,810 810,930 930,1230 1230,1560
{read,and,write} workload is excellent spread

1232
00:37:52,070 --> 00:37:53,480
0,120 120,360 360,570 570,750 750,1410
at least over two servers,|
|

1233
00:37:54,360 --> 00:37:56,670
0,450 570,780 780,1290 1320,1590 1590,2310
{} for more read operation
对于更多读操作只设计一台服务器，

1234
00:37:56,790 --> 00:37:58,560
0,600 600,810 810,990 990,1440 1470,1770
involves only one server, {}|
|

1235
00:37:58,560 --> 00:38:00,180
0,240 240,810 810,1200 1230,1500 1500,1620
there's never, {} doesn't have
不需要与任何其他服务器交互，

1236
00:38:00,180 --> 00:38:00,900
0,90 90,240 240,330 330,540 540,720
to talk to any other

1237
00:38:00,900 --> 00:38:01,950
0,360 360,450 450,570 570,720 720,1050
server,| it can just respond
|它可以立即做出响应，

1238
00:38:01,950 --> 00:38:02,790
0,60 60,300 450,600 600,690 690,840
{immediately -},| and we'll see
|我们稍后会看到，

1239
00:38:02,790 --> 00:38:04,290
0,60 60,210 210,330 330,810 1020,1500
a little bit later,| why
|为什么这很重要，

1240
00:38:04,290 --> 00:38:06,180
0,240 240,330 330,780 780,1320 1320,1890
this is actually {} important,|
|

1241
00:38:06,180 --> 00:38:07,080
0,120 120,300 300,480 480,600 600,900
or why this is actually,|
或者为什么，|

1242
00:38:07,080 --> 00:38:09,360
0,540 540,840 840,1470 1470,1680 1680,2280
what further optimization this allows.|
这允许什么更多的优化。|

1243
00:38:10,400 --> 00:38:11,780
0,420 570,780 780,870 870,1170 1170,1380
{} So the commit point
所以提交点是，

1244
00:38:11,780 --> 00:38:12,740
0,120 120,390 390,480 480,810 810,960
is really| you know the
|写入发生在尾部的点，

1245
00:38:12,740 --> 00:38:14,060
0,330 330,450 450,570 570,990 1020,1320
point that the write actually

1246
00:38:14,060 --> 00:38:15,650
0,510 510,630 630,930 930,1260 1260,1590
happens at the tail end,|
|

1247
00:38:15,800 --> 00:38:17,540
0,270 270,330 330,600 600,1080 1320,1740
because at that point, the
因为在那一点，写操作可以被读取者看见，

1248
00:38:17,540 --> 00:38:19,160
0,240 240,690 690,780 780,1260 1260,1620
write operation is visible to

1249
00:38:19,160 --> 00:38:20,690
0,480 480,720 720,990 990,1320 1320,1530
readers| and not before any
|而不是在任何其他点之前。

1250
00:38:20,690 --> 00:38:21,920
0,270 270,810
other points.|
|

1251
00:38:22,780 --> 00:38:24,490
0,480 720,1080 1080,1230 1230,1590 1590,1710
{} And this also you
这也提供了线性一致性，

1252
00:38:24,490 --> 00:38:26,260
0,120 120,660 660,930 930,1380 1380,1770
know provides this {linearizability -},|
|

1253
00:38:26,260 --> 00:38:27,100
0,150 150,240 240,540 540,720 720,840
so it's pretty easy to
所以很容易看到，

1254
00:38:27,100 --> 00:38:28,120
0,270 270,480 480,720 720,810 810,1020
see that,| in the case
|在没有崩溃的情况下，

1255
00:38:28,120 --> 00:38:30,460
0,90 90,270 270,870 1440,1860 1860,2340
of no crashes,| scheme guarantees
|这个方案保证了线性一致性，

1256
00:38:30,460 --> 00:38:32,470
0,240 240,810 810,1230 1350,1560 1560,2010
{} linearizability,| because the writes
|因为写入都是按整体顺序在头部应用，

1257
00:38:32,470 --> 00:38:33,490
0,180 180,360 360,720 720,810 810,1020
are all applied in sum

1258
00:38:33,490 --> 00:38:34,840
0,270 270,750 750,930 930,990 990,1350
total order at the head,|
|

1259
00:38:35,380 --> 00:38:38,530
0,1080 1290,1920 1920,2520 2520,2670 2670,3150
and {} when the tail
当尾部收到更新时，

1260
00:38:38,530 --> 00:38:40,150
0,690 690,780 780,870 870,1140 1140,1620
receives you know that update,|
|

1261
00:38:40,180 --> 00:38:41,500
0,420 420,690 690,930 930,1020 1020,1320
it's, {} it's the commit
这是提交点，

1262
00:38:41,500 --> 00:38:43,300
0,300 300,540 540,750 780,1410 1410,1800
point,| it {wants,to} respond to
|它想要响应客户端并发回请求。

1263
00:38:43,300 --> 00:38:44,410
0,420 420,480 480,690 690,750 750,1110
{the,client} and sent the request

1264
00:38:44,410 --> 00:38:45,240
0,390
back.|
|

1265
00:38:45,240 --> 00:38:46,290
0,480 510,600 600,720 720,870 870,1050
If you know that same
如果同一客户端立即执行读取操作，

1266
00:38:46,290 --> 00:38:47,190
0,270 270,330 330,630 630,810 810,900
client {immediately -} does a

1267
00:38:47,190 --> 00:38:48,870
0,180 180,960 1080,1470 1470,1560 1560,1680
read operation,| {} it will
|它会到尾部，

1268
00:38:48,870 --> 00:38:49,830
0,180 180,330 330,450 450,840 840,960
go to the tail,| and
|它将观察到最后一次变化。

1269
00:38:49,830 --> 00:38:51,030
0,120 120,270 270,720 720,810 810,1200
it will observe the last

1270
00:38:51,030 --> 00:38:52,080
0,570
change.|
|

1271
00:38:52,200 --> 00:38:54,330
0,330 330,810 840,1500 1500,1860 1860,2130
{} So, {} certainly within
所以，在单个客户端中，

1272
00:38:54,330 --> 00:38:55,710
0,60 60,330 330,810 810,1110 1110,1380
a single client,| basically all
|所有的操作都是完全有序的，

1273
00:38:55,710 --> 00:38:57,540
0,450 450,540 540,840 840,1320
operations are totally ordered,|
|

1274
00:38:57,760 --> 00:38:58,720
0,180 180,420 420,630 630,720 720,960
it's pretty easy to see
在客户端上很容易看出，

1275
00:38:58,720 --> 00:39:00,580
0,510 510,1110 1110,1380 1380,1650 1650,1860
that {in,client},| if client 2
|如果在客户端 2 读操作开始在客户端 1 操作完成之后，

1276
00:39:00,580 --> 00:39:02,320
0,240 240,330 330,540 540,1050 1050,1740
start to read operation after

1277
00:39:02,380 --> 00:39:04,810
0,450 450,840 870,1710 1710,1830 1830,2430
client 1 operation is finished,|
|

1278
00:39:05,020 --> 00:39:06,610
0,240 240,420 420,630 630,1080 1080,1590
and when it finished, when
当它完成时，当尾部做出响应时，

1279
00:39:06,610 --> 00:39:08,230
0,120 120,420 420,600 600,1200 1380,1620
the tail has responded,| so
|所以，任何开始在写操作之后的读操作，

1280
00:39:08,230 --> 00:39:09,700
0,270 270,510 510,990 990,1110 1110,1470
any read operation that starts

1281
00:39:09,700 --> 00:39:11,770
0,240 240,420 420,660 660,1320 1590,2070
after a write operation| will
|将观察到最后一次或最近一次写入的结果，

1282
00:39:11,770 --> 00:39:13,150
0,630 660,750 750,870 870,960 960,1380
observe you know the last

1283
00:39:13,150 --> 00:39:14,170
0,90 90,390 390,870 870,960 960,1020
or the result of the

1284
00:39:14,170 --> 00:39:15,700
0,240 240,480 480,900 1290,1440 1440,1530
most recent write,| and so
|所以这里很容易得到一个直觉，

1285
00:39:15,700 --> 00:39:16,780
0,150 150,390 390,630 630,840 870,1080
it's pretty easy to get

1286
00:39:16,780 --> 00:39:18,160
0,90 90,570 570,900 900,1080 1080,1380
an intuition here,| that {you,know,this}
|这将为我们提供线性一致性。

1287
00:39:18,160 --> 00:39:19,330
0,180 180,360 360,720 750,1080 1080,1170
is going to provide us

1288
00:39:19,330 --> 00:39:20,640
0,150 150,390 390,900
with {linearizability -}.|
|

1289
00:39:22,050 --> 00:39:23,260
0,600
Okay?|
好的?|

1290
00:39:23,460 --> 00:39:25,080
0,450 570,1170 1260,1440 1440,1500 1500,1620
So, {} what I like
我现在想要开始一个快速讨论室，

1291
00:39:25,080 --> 00:39:26,130
0,60 60,180 180,450 450,600 600,1050
to do now is actually

1292
00:39:26,130 --> 00:39:27,120
0,120 120,300 300,480 480,750 750,990
to take a quick {breakout

1293
00:39:27,120 --> 00:39:28,650
0,180 180,540 570,930 930,1290 1290,1530
-} room {} section,| and
|我想让你们讨论一下这个问题，

1294
00:39:28,650 --> 00:39:29,340
0,210 210,330 330,510 510,630 630,690
I would like you to

1295
00:39:29,340 --> 00:39:32,460
0,690 720,1680 2370,2790 2790,2940 2940,3120
discuss the question,| that was
|在课程中贴出的，

1296
00:39:32,460 --> 00:39:33,870
0,210 210,540 540,1110 1260,1350 1350,1410
was {post,in} lecture,| you know
|会出什么问题，

1297
00:39:33,870 --> 00:39:35,340
0,180 180,300 300,480 480,1140 1140,1470
what could go wrong| or
|或者什么打破线性一致性，

1298
00:39:35,340 --> 00:39:37,500
0,990 1320,1560 1560,1620 1620,1890 1890,2160
like what {} breaking {linearizability

1299
00:39:37,500 --> 00:39:39,390
0,120 120,900 900,1200 1410,1830 1830,1890
- -},| if instead of
|如果不是让尾部响应客户端，

1300
00:39:39,390 --> 00:39:41,430
0,330 330,420 420,1020 1050,1710 1710,2040
having the tail responds to

1301
00:39:41,430 --> 00:39:44,100
0,60 60,600 900,1620 1620,2070 2070,2670
the client,| {} have {the,head}
|让头部立即响应客户端，

1302
00:39:44,100 --> 00:39:45,510
0,360 360,420 420,510 510,870 870,1410
responded to the client immediately|
|

1303
00:39:45,510 --> 00:39:47,160
0,360 360,540 540,630 630,1410 1440,1650
after it is received you
在收到写请求之后，

1304
00:39:47,160 --> 00:39:49,500
0,150 150,750 1140,1680 1680,2040 2070,2340
know the { -} write

1305
00:39:49,500 --> 00:39:50,340
0,570
request,|
|

1306
00:39:51,360 --> 00:39:52,560
0,300 300,660 660,900 900,1080 1080,1200
{} nd maybe those are
也许这些都是很好的话题，

1307
00:39:52,560 --> 00:39:53,820
0,150 150,480 480,630 630,990 990,1260
good topics| or to {}
|或者可以稍微辩论一下，

1308
00:39:53,850 --> 00:39:54,810
0,300 300,360 360,570 570,780 780,960
debate a little bit,| and
|如果你想从任何角度

1309
00:39:54,810 --> 00:39:55,320
0,90 90,180 180,330 330,390 390,510
if you want to go

1310
00:39:55,320 --> 00:39:56,190
0,90 90,270 270,450 450,780 780,870
in any other direction| to
|谈论链式复制，当然欢迎，

1311
00:39:56,190 --> 00:39:57,900
0,210 210,840 840,1050 1050,1470 1470,1710
talk about chain replication {of,course

1312
00:39:57,900 --> 00:39:59,340
0,120 120,570 570,960 960,1140 1140,1440
-} welcome,| maybe that's something
|也许这是一个开始。

1313
00:39:59,340 --> 00:40:00,540
0,150 150,510 510,750
to start with.|
|

1314
00:40:00,720 --> 00:40:01,740
0,210 210,540 540,720 720,810 810,1020
So let's take a five
所以让我们来个五分钟的休息室，

1315
00:40:01,740 --> 00:40:02,970
0,180 180,540 540,810 810,900 900,1230
minute breakout room,| and then
|然后我们这样做并想想，

1316
00:40:03,920 --> 00:40:05,140
0,690
{}

1317
00:40:05,200 --> 00:40:06,100
0,390 390,450 450,570 570,780 780,900
we'll {} do this and

1318
00:40:06,100 --> 00:40:07,280
0,90 90,660
{} think,|
|

1319
00:40:07,280 --> 00:40:08,480
0,330 330,480 480,540 540,960 990,1200
{} let me see, {}|
让我看看，|

1320
00:40:08,480 --> 00:40:09,200
0,330 330,450 450,540 540,660 660,720
Jose, {are,you} going to
Jose 你来做吗？

1321
00:40:09,200 --> 00:40:10,100
0,60 60,300
do it?|
|

1322
00:40:10,320 --> 00:40:13,530
0,570 570,1080 1080,2010 2310,2970 3000,3210
And yeah and okay. {}|
好的。|

1323
00:40:13,530 --> 00:40:14,340
0,180 180,360 360,450 450,660 660,810
You have to make you
你得给做点什么，或者。

1324
00:40:14,340 --> 00:40:16,140
0,390 390,780 780,1110 1230,1590 1590,1800
something, or.| I don't think
|我不认为这是必要的。

1325
00:40:16,140 --> 00:40:18,600
0,90 90,720 1320,1800 1950,2250 2250,2460
it's necessary.| I think it
|我认为是 Zoom 变化，

1326
00:40:18,660 --> 00:40:20,310
0,330 330,780 780,1200 1200,1290 1290,1650
Zoom change,| {so,it,should} be possible
|所以在那里也是可能的。

1327
00:40:20,310 --> 00:40:21,320
0,210 210,480
there, too.|
|

1328
00:40:24,760 --> 00:40:26,440
0,1050
Zoom,
Zoom ，是的，没错。

1329
00:40:27,240 --> 00:40:29,560
0,450 450,690 690,1020
yep, that's right.|
|

1330
00:40:31,810 --> 00:40:34,240
0,480 510,1440
Yep, okay.|
好的，好的。|

1331
00:41:07,320 --> 00:41:08,640
0,750

1332
00:42:08,820 --> 00:42:09,460
0,480

1333
00:42:16,350 --> 00:42:17,740
0,840

1334
00:42:23,860 --> 00:42:24,760
0,60

1335
00:42:48,630 --> 00:42:49,760
0,120

1336
00:42:50,640 --> 00:42:51,520
0,510

1337
00:42:53,650 --> 00:42:54,520
0,60

1338
00:42:56,260 --> 00:42:57,880
0,960

1339
00:43:17,290 --> 00:43:18,240
0,420

1340
00:44:27,090 --> 00:44:28,460
0,870

1341
00:44:46,370 --> 00:44:47,840
0,690

1342
00:47:43,180 --> 00:47:45,790
0,660 660,900 900,1140 1140,1560 2070,2610
Jose, we're coming back.| Yeah,
Jose ，我们回来了。|好的，你什么时候。

1343
00:47:45,790 --> 00:47:48,670
0,420 420,1020 1200,1500 1500,1980 2310,2880
whenever you.| I'm ready.| Okay,
|我准备好了。|好的，我想我可以关闭到 Zoom 。

1344
00:47:48,700 --> 00:47:49,660
0,120 120,360 360,630 630,870 870,960
I mean I think I

1345
00:47:49,660 --> 00:47:51,700
0,240 240,720 720,810 810,1500
can close to Zoom.|
|

1346
00:47:51,700 --> 00:47:54,060
0,900

1347
00:48:09,460 --> 00:48:11,300
0,450

1348
00:48:29,740 --> 00:48:31,440
0,1230

1349
00:48:57,530 --> 00:48:59,800
0,330 900,1710
Alright, {we're,back}.|
好的，我们回来了。|

1350
00:49:07,090 --> 00:49:10,030
0,690 930,1710 1740,2250 2400,2640 2640,2940
Okay, {} so you know
好的，所以简单概括一下，

1351
00:49:10,030 --> 00:49:12,640
0,180 180,780 780,930 930,1680 1710,2610
just quickly to summarize,| why
|为什么这会打破线性一致性，

1352
00:49:13,090 --> 00:49:14,410
0,480 480,570 570,900 900,1080 1080,1320
you know that would break

1353
00:49:14,410 --> 00:49:16,060
0,60 60,420 420,960 990,1170 1170,1650
the {linearizability -},| {} so
|协议更改传播到，

1354
00:49:16,480 --> 00:49:18,190
0,450 450,1020 1050,1230 1230,1560 1560,1710
protocol change, {} change that

1355
00:49:18,190 --> 00:49:21,370
0,600 630,1290 1290,1680 2310,3090 3090,3180
was propagating was to| you
|继续传播到 S1 S2 S3 ，

1356
00:49:21,370 --> 00:49:22,930
0,90 90,390 390,930 930,1260 1260,1560
know {both,keep} propagating to {S1

1357
00:49:22,930 --> 00:49:23,710
0,180 180,300 300,390 390,630 630,780
-} and {S2 -} {S3

1358
00:49:23,710 --> 00:49:25,390
0,420 600,990 990,1380 1380,1500 1500,1680
-},| {} but you know
|但是一旦 S1 完成了，

1359
00:49:25,390 --> 00:49:26,650
0,180 180,420 420,630 630,930 930,1260
as soon as S1 actually

1360
00:49:26,650 --> 00:49:28,870
0,120 120,600 660,1080 1080,1590 1590,2220
has done,| {} which propagation
|消息传播，返回给客户端，

1361
00:49:28,870 --> 00:49:30,340
0,150 150,480 480,840 840,1110 1110,1470
as it responds back to

1362
00:49:30,340 --> 00:49:33,010
0,180 180,780 1380,1740 1740,2100 2100,2670
a client,| and clearly this
|显然，这将会打破线性一致性，

1363
00:49:33,220 --> 00:49:35,440
0,270 270,930 930,1050 1050,1710 1710,2220
will break the linearizability,| because,
|假设客户端 1 写入，

1364
00:49:35,830 --> 00:49:37,180
0,420 420,660 660,780 780,1140 1140,1350
{} let's say {the,client} 1

1365
00:49:37,180 --> 00:49:38,590
0,180 180,630 630,840 840,900 900,1410
did write,| got the acknowledgement
|从 S1 得到确认，

1366
00:49:38,590 --> 00:49:39,880
0,420 420,510 510,720 720,1170 1170,1290
back you know from {S1

1367
00:49:39,880 --> 00:49:41,170
0,540 600,810 810,990 990,1050 1050,1290
-},| {S1 -} of course
|当然写入会继续到 S2 S3 ，

1368
00:49:41,170 --> 00:49:42,430
0,540 570,660 660,870 870,1110 1110,1260
has the write also in

1369
00:49:42,430 --> 00:49:43,600
0,540 540,720 720,960 960,1050 1050,1170
progress {S2 -} and {S3

1370
00:49:43,600 --> 00:49:45,640
0,390 510,840 840,1110 1110,1890 1920,2040
-},| but maybe before you
|但也许在 S2 与 S3 相关之前，

1371
00:49:45,640 --> 00:49:47,080
0,180 180,450 450,690 690,960 960,1440
know {S2 -} actually context

1372
00:49:47,080 --> 00:49:49,030
0,150 150,540 540,1140 1140,1440 1440,1950
{S3 -},| {the,client} actually sends
|客户端向 S3 发送一个读操作，

1373
00:49:49,400 --> 00:49:50,750
0,150 150,360 360,1050 1110,1230 1230,1350
a read operation you know

1374
00:49:50,750 --> 00:49:52,790
0,630 630,1140 1140,1650 1800,1950 1950,2040
to {S3 -},| and of
|当然，现在它将返回写入完成之前的值，

1375
00:49:52,790 --> 00:49:54,140
0,240 240,420 420,540 540,690 690,1350
course, now it will return

1376
00:49:54,170 --> 00:49:56,270
0,570 600,1290 1290,1620 1620,2010 2010,2100
a value from before the

1377
00:49:56,270 --> 00:49:58,070
0,330 330,720 720,1080 1230,1470 1470,1800
write {is,done},| so the client
|客户端甚至不能观察到自己的写入，

1378
00:49:58,070 --> 00:49:59,300
0,240 240,480 480,900 900,1020 1020,1230
doesn't even observe its own

1379
00:49:59,300 --> 00:50:01,580
0,510 510,750 750,1140 1230,1980 1980,2280
write,| and so clearly {}
|所以很明显打破了线性一致性，

1380
00:50:01,580 --> 00:50:03,320
0,270 270,540 540,690 690,1080 1440,1740
break {linearizability - -},| and
|所以这非常重要，

1381
00:50:03,320 --> 00:50:04,790
0,120 120,240 240,420 420,990 1170,1470
so it's very important,| that
|正如我前面所说的，

1382
00:50:04,790 --> 00:50:05,540
0,60 60,300 300,480 480,540 540,750
you know as I said

1383
00:50:05,540 --> 00:50:08,240
0,420 420,630 630,810 810,1860 1920,2700
earlier,| {that's -} the tail
|是尾部发送确认给客户端，

1384
00:50:08,480 --> 00:50:10,790
0,720 720,1020 1020,1110 1110,1830 1830,2310
actually sends the acknowledgement back

1385
00:50:11,000 --> 00:50:13,580
0,270 270,870 1110,1650 1650,2100 2100,2580
to {the,client},| because really the
|因为一旦尾部处理了写操作，

1386
00:50:13,610 --> 00:50:15,620
0,330 330,840 840,1050 1050,1560 1560,2010
once {the,tail} has processed the

1387
00:50:15,920 --> 00:50:17,810
0,630 630,1200 1200,1440 1440,1560 1560,1890
write operation,| that is actually
|那就是提交点。

1388
00:50:17,810 --> 00:50:19,430
0,300 300,510 510,750 750,1290 1290,1620
really what the {commit,point} is.|
|

1389
00:50:20,630 --> 00:50:21,720
0,720

1390
00:50:22,200 --> 00:50:23,960
0,240 240,540 540,690 690,1170
Any questions about that?|
对于这个，有什么问题吗？|

1391
00:50:28,400 --> 00:50:29,750
0,390 390,390 900,1080 1080,1230 1230,1350
Okay, {} so this was
好的，所以这是正常的操作，

1392
00:50:29,750 --> 00:50:31,700
0,120 120,180 180,630 630,1290 1620,1950
sort of normal operations,| and
|让我来谈谈崩溃，

1393
00:50:31,700 --> 00:50:32,330
0,150 150,210 210,390 390,420 420,630
let me talk a little

1394
00:50:32,330 --> 00:50:36,170
0,180 180,690 720,1530 3540,3750 3750,3840
bit about crashes,| {since,it's,6.824 -
|因为它是 6.824 分布式系统，

1395
00:50:36,170 --> 00:50:38,150
0,480 510,870 870,1380 1380,1740 1740,1980
-} distributed systems,| so all
|所以所有都是当失败发生时。

1396
00:50:38,150 --> 00:50:39,350
0,90 90,390 390,690 690,990 990,1200
the actually is where when

1397
00:50:39,350 --> 00:50:40,880
0,60 60,420 420,870
the failures happen.|
|

1398
00:50:42,850 --> 00:50:44,320
0,390 390,1020 1080,1320 1320,1410 1410,1470
{} And one of the
链式复制最酷的一点是，

1399
00:50:44,320 --> 00:50:45,250
0,210 210,270 270,330 330,660 660,930
things that is cool about

1400
00:50:45,250 --> 00:50:47,410
0,240 240,510 510,1380 1380,2010 2040,2160
{} chain replication is,| you
|失败场景的数量是相当有限的。

1401
00:50:47,410 --> 00:50:48,550
0,420 420,570 570,780 780,840 840,1140
know the number of failure

1402
00:50:48,550 --> 00:50:50,140
0,540 540,630 630,840 840,1110 1110,1590
scenarios is actually quite limited.|
|

1403
00:50:50,810 --> 00:50:52,310
0,180 180,570 810,990 990,1170 1170,1500
And so, {} let me,
所以，让我来看三种情况，

1404
00:50:52,310 --> 00:50:54,590
0,480 540,1200 1200,1380 1380,1920 1920,2280
{} basically three cases,| namely
|头部故障，中间服务器之一故障或尾部故障。

1405
00:50:54,590 --> 00:50:55,850
0,90 90,300 300,780 780,1050 1050,1260
the head fails, the one

1406
00:50:55,850 --> 00:50:57,230
0,60 60,150 150,630 630,960 960,1380
of the intermediate server fails,

1407
00:50:57,230 --> 00:50:59,090
0,150 150,510 510,1020 1530,1710 1710,1860
or tail fails.| So let's
|所以让我们来看看这些情况中的每一个，

1408
00:50:59,090 --> 00:50:59,930
0,180 180,240 240,390 390,720 720,840
look at one of each

1409
00:50:59,930 --> 00:51:01,010
0,270 270,570 570,720 720,900 900,1080
one of each of those

1410
00:51:01,010 --> 00:51:03,440
0,570 570,1080 1350,1740 1740,2190 2220,2430
cases,| so here's are {you,know}
|这是一种情况，头部是 S1 ，

1411
00:51:03,440 --> 00:51:04,970
0,60 60,540 540,720 720,960 960,1530
the case we have {a,head}

1412
00:51:05,060 --> 00:51:07,220
0,510 510,1020 1260,1770 1770,2010 2010,2160
{S1 -},| let's say that
|假设它应用了 U1 U2 U3 三个更新，

1413
00:51:07,220 --> 00:51:09,100
0,210 210,660 660,840 840,1470
it applied {U1 -},

1414
00:51:09,100 --> 00:51:10,450
0,240 240,750 750,900 900,1020 1020,1350
{U2 -} and {U3 -}

1415
00:51:10,450 --> 00:51:12,000
0,180 180,360 360,1050
sort three updates,|
|

1416
00:51:12,330 --> 00:51:14,680
0,690 690,930 930,1170 1170,1770
talks to {S2 -},|
与 S2 交互，|

1417
00:51:15,050 --> 00:51:16,040
0,270 270,390 390,660 660,810 810,990
{maybe -} {S2 -} has
也许 S2 完成了 U2 和 U1 ，

1418
00:51:16,040 --> 00:51:18,620
0,240 240,1080 1110,1710 1740,2070 2070,2580
done U2 and {U1 -},|
|

1419
00:51:19,930 --> 00:51:21,700
0,690 720,810 810,1230 1260,1680 1680,1770
and you know here we
这里我们有 S3 ，也就是尾部，

1420
00:51:21,700 --> 00:51:22,630
0,240 240,420 420,630 630,840 840,930
have {S3 -} which is

1421
00:51:22,630 --> 00:51:23,880
0,690
{the,tail},|
|

1422
00:51:23,940 --> 00:51:25,170
0,360 360,510 510,780 780,930 930,1230
and it only has done
到目前为止，它只完成了 U1 ，

1423
00:51:25,170 --> 00:51:26,850
0,360 360,540 540,960 1140,1470 1470,1680
U1 so far,| and so
|所以，对于正在访问 S1 的客户端，

1424
00:51:26,850 --> 00:51:29,010
0,120 120,540 1050,1650 1650,1770 1770,2160
the client client was talking

1425
00:51:29,010 --> 00:51:31,200
0,450 600,900 900,1410
to {S1 -},|
|

1426
00:51:31,500 --> 00:51:33,660
0,720 900,1440 1680,1860 1860,2010 2010,2160
{} and {} we now
我们现在考虑会发生什么，

1427
00:51:33,660 --> 00:51:34,620
0,150 150,210 210,360 360,750 750,960
want to think about what

1428
00:51:34,620 --> 00:51:36,090
0,600 600,990 990,1170 1170,1380 1380,1470
happens,| and what needs to
|以及在其中一次崩溃中需要发生什么。

1429
00:51:36,090 --> 00:51:37,560
0,450 450,750 750,990 990,1110 1110,1470
happen in one of these

1430
00:51:37,560 --> 00:51:39,480
0,570 750,930 930,1290 1320,1800 1800,1920
crashes.| So let's start with
|所以让我们从头部崩溃的情况开始，

1431
00:51:39,480 --> 00:51:41,400
0,90 90,480 480,720 720,1080 1410,1920
the case that the head

1432
00:51:41,400 --> 00:51:42,640
0,780
crashes,|
|

1433
00:51:42,730 --> 00:51:44,230
0,360 360,750 750,900 900,1080 1080,1500
and so the head crashes,
所以头部崩溃时，需要做什么，

1434
00:51:44,230 --> 00:51:45,370
0,360 360,600 600,720 720,780 780,1140
what needs to be done,|
|

1435
00:51:47,530 --> 00:51:48,880
0,210 210,330 330,390 390,720 720,1350
this is an easy case
这是一件容易的事还是一件难事？

1436
00:51:49,030 --> 00:51:50,640
0,120 120,390 390,990
or hard case?|
|

1437
00:51:53,070 --> 00:51:55,320
0,780 990,1710 1710,1830 1830,2010 2010,2250
Easier.| {I,hope} in easy case,
简单的。|我希望是简单的情况，为什么？

1438
00:51:55,320 --> 00:51:56,600
0,660
why?|
|

1439
00:51:56,780 --> 00:51:58,580
0,330 330,540 540,900 930,1350 1350,1800
{} {You,can} just cut off
你可以删除头部，

1440
00:51:58,730 --> 00:52:01,070
0,510 540,780 780,1320 1740,2160 2160,2340
{} the head,| oh, {sorry
|哦，抱歉，是的，头部，

1441
00:52:01,070 --> 00:52:02,390
0,90 90,330 360,750 780,900 900,1320
-}, the yeah, the head,|
|

1442
00:52:02,390 --> 00:52:04,430
0,300 420,600 600,810 840,1410 1830,2040
and you know make {}
现在让 S2 成为头部。

1443
00:52:04,430 --> 00:52:06,830
0,270 270,690 780,1110 1110,1470 1740,2400
{S2 -} {the,head} now.| Yeah,
|是的，所以会发生的事情是，

1444
00:52:06,860 --> 00:52:09,260
0,1350 1350,1650 1650,1800 1800,2190 2190,2400
you know, so what's going

1445
00:52:09,260 --> 00:52:10,220
0,60 60,330 330,660 660,810 810,960
to happen correct is,| the
|配置服务发现 S1 不见了，

1446
00:52:10,220 --> 00:52:11,780
0,510 510,810 810,1320 1320,1410 1410,1560
configuration service discovers that {S1

1447
00:52:11,780 --> 00:52:13,080
0,240 240,330 330,810
-} is gone,|
|

1448
00:52:13,080 --> 00:52:14,010
0,180 180,540 540,600 600,750 750,930
when decides if {S1 -}
当确定 S1 不见了，

1449
00:52:14,010 --> 00:52:17,100
0,120 120,600 870,1860 1890,2550 2580,3090
is gone,| and {} then
|然后可以在后续操作中提升 S2 为头部，

1450
00:52:17,100 --> 00:52:18,990
0,0 0,960 960,1200 1200,1410 1410,1890
{} basically {} can promote

1451
00:52:18,990 --> 00:52:20,250
0,180 180,360 360,510 510,660 660,1260
{S2 -} to be the

1452
00:52:20,370 --> 00:52:22,740
0,570 870,1200 1200,1530 1530,1680 1680,2370
head {} in the subsequent

1453
00:52:22,740 --> 00:52:25,080
0,1140 1380,1710 1710,2100 2100,2220 2220,2340
operations,| and clients now in
|未来的客户端访问这个节点，

1454
00:52:25,080 --> 00:52:26,190
0,60 60,540 540,780 780,1050 1050,1110
the future and talk to

1455
00:52:26,190 --> 00:52:27,750
0,210 210,780 930,1230 1230,1440 1440,1560
this guy,| and why is
|为什么这是正确的,

1456
00:52:27,750 --> 00:52:28,840
0,120 120,690
this correct,|
|

1457
00:52:29,690 --> 00:52:30,890
0,300 300,510 510,900 900,1050 1050,1200
so what operation have we
那么我们丢掉了什么操作？

1458
00:52:30,890 --> 00:52:31,920
0,510
lost?|
|

1459
00:52:33,100 --> 00:52:35,230
0,150 150,600 600,900 900,1530 1620,2130
We lost {U3 -}.| Yeah,
我们失去了 U3 。|是的，这有什么问题吗？

1460
00:52:35,230 --> 00:52:36,720
0,120 120,240 240,330 330,900
is that a problem?|
|

1461
00:52:36,840 --> 00:52:40,620
0,420 420,900 1170,1560 1560,2310 2520,3780
That's valid {to,lose} operations.| Yeah,
丢失操作是合法的。|是的，丢失 U3 是合理的，

1462
00:52:40,770 --> 00:52:41,970
0,210 210,330 330,570 570,1110 1110,1200
yeah, it's fair game to

1463
00:52:41,970 --> 00:52:43,260
0,270 270,420 420,720 750,1110 1110,1290
lose {U3 -},| {U3 -}
|U3 尚未提交，

1464
00:52:43,260 --> 00:52:44,760
0,150 150,420 420,600 600,1110 1140,1500
has not been committed,| because
|因为只有尾部的操作才会提交，

1465
00:52:44,760 --> 00:52:46,020
0,300 300,750 750,840 840,930 930,1260
only operations at the tail

1466
00:52:46,020 --> 00:52:47,700
0,480 960,1140 1140,1350 1350,1560 1560,1680
committed,| and so just as
|所以，就像操作从未发生，

1467
00:52:47,700 --> 00:52:49,290
0,270 270,600 600,990 990,1170 1170,1590
if the operation never happens,|
|

1468
00:52:49,290 --> 00:52:49,950
0,120 120,180 180,270 270,570 570,660
you know the client could
客户端甚至不会注意到，

1469
00:52:49,950 --> 00:52:51,540
0,240 240,540 540,720 720,1470 1500,1590
not even have observed,| you
|这个 U2 或 U3 发生了，

1470
00:52:51,540 --> 00:52:52,920
0,150 150,360 360,720 720,1020 1020,1380
know that actually U {}

1471
00:52:52,920 --> 00:52:54,750
0,510 510,990 1050,1350 1350,1620 1620,1830
this {} {U2 -} or

1472
00:52:54,750 --> 00:52:55,890
0,180 180,360 360,600 600,720 720,1140
{U3 -} actually it happens,|
|

1473
00:52:55,890 --> 00:52:56,550
0,180 180,300 300,450 450,570 570,660
or {U3 -} it should
或者 U3 应该发生。

1474
00:52:56,550 --> 00:52:57,280
0,270
happen.|
|

1475
00:52:57,310 --> 00:52:58,840
0,480 510,660 660,750 750,1050 1050,1530
Okay?| So it's perfectly fine
好的？|所以这么做完全没问题，

1476
00:52:59,110 --> 00:53:01,360
0,360 360,480 480,900 1020,2130 2130,2250
to do this,| why is
|为什么配置服务涉及这里是重要的，

1477
00:53:01,360 --> 00:53:03,040
0,60 60,540 540,1080 1080,1440 1440,1680
it important configuration service actually

1478
00:53:03,040 --> 00:53:03,940
0,390 390,540 540,690 690,750 750,900
involved here,| could {} like
|S2 可以自己决定成为领导者吗，

1479
00:53:03,940 --> 00:53:05,410
0,630 630,900 900,1260 1260,1350 1350,1470
{S2 -} decide on its

1480
00:53:05,410 --> 00:53:06,610
0,210 210,300 300,630 630,870 870,1200
own to become the head,|
|

1481
00:53:07,380 --> 00:53:08,190
0,180 180,270 270,480 480,570 570,810
let's say yes, {U2 -}
我们假设可以， U2 告诉任何节点，

1482
00:53:08,190 --> 00:53:09,240
0,210 210,330 330,600 600,960 960,1050
talk to anyone anymore,| and
|决定无论如何，我要成为头部，

1483
00:53:09,240 --> 00:53:10,260
0,60 60,270 270,420 420,600 600,1020
{decides -} like {} whatever

1484
00:53:10,290 --> 00:53:11,160
0,150 150,300 300,360 360,570 570,870
I want to become head,|
|

1485
00:53:11,780 --> 00:53:13,260
0,120 120,300 300,420 420,900
would that be valid?|
这是合法的吗？|

1486
00:53:14,770 --> 00:53:16,450
0,240 240,390 390,690 720,1350 1350,1680
What is that, like maybe
那就像是创造分裂。

1487
00:53:16,450 --> 00:53:20,950
0,360 360,690 2130,2340 2490,4110 4200,4500
create a split.| Yeah, yeah,
|是的，那会造成脑裂，

1488
00:53:20,950 --> 00:53:21,790
0,150 150,300 300,540 540,570 570,840
that would create a {split-brain

1489
00:53:21,790 --> 00:53:22,870
0,270 270,480 480,720 720,810 810,1080
-}, right,| because it might,
|因为 S2 可能与 S1 分区，

1490
00:53:22,870 --> 00:53:23,890
0,210 210,330 330,450 450,810 810,1020
{} {S2 -} might just

1491
00:53:23,890 --> 00:53:25,750
0,120 120,750 870,1200 1200,1380 1380,1860
be partitioned from {S1 -},|
|

1492
00:53:26,140 --> 00:53:27,400
0,420 420,540 540,720 720,1110 1110,1260
and so now both are
所以现在两个都是头部，

1493
00:53:27,400 --> 00:53:29,530
0,540 810,1230 1230,1500 1500,1620 1620,2130
heads,| maybe both are processing
|也许两者都在处理命令，

1494
00:53:29,530 --> 00:53:30,850
0,570 570,720 720,1050 1050,1170 1170,1320
commands,| will be you know
|将会是违规行为，

1495
00:53:30,850 --> 00:53:34,030
0,600 600,1020 1320,2460 2670,2730 2730,3180
violate are,| {} you know
|全部[]都有整体顺序，

1496
00:53:34,060 --> 00:53:35,230
0,570 570,720 720,780 780,990 990,1170
basically the sort of the

1497
00:53:35,230 --> 00:53:36,580
0,210 210,660 660,1020 1020,1110 1110,1350
whole [] having the total

1498
00:53:36,580 --> 00:53:37,440
0,420
order,|
|

1499
00:53:38,190 --> 00:53:40,290
0,180 180,360 360,600 600,1020 1500,2100
{we,can} now.| {Also - -},
我们现在可以。|同时， S2 知道 S1 是头部吗，

1500
00:53:40,320 --> 00:53:41,970
0,420 420,720 720,960 960,1380 1380,1650
does {S2 -} even know

1501
00:53:41,970 --> 00:53:42,810
0,180 180,360 360,600 600,750 750,840
that {S1 -} is a

1502
00:53:42,810 --> 00:53:45,660
0,630 750,1290 1290,1500 1500,1950 1980,2850
head,| because it just receives.|
|因为它只是接受。|

1503
00:53:46,360 --> 00:53:47,710
0,510 540,870 870,1140 1140,1290 1290,1350
{} You probably got it
你可能是从以前的配置信息中得到，

1504
00:53:47,710 --> 00:53:49,120
0,120 120,210 210,750 750,1290 1290,1410
from the configuration information in

1505
00:53:49,120 --> 00:53:52,030
0,330 330,780 1230,1680 1680,2400 2400,2910
previous time,| like when configuration
|比如当配置服务决定新配置时，

1506
00:53:52,030 --> 00:53:53,620
0,330 330,690 690,750 750,1020 1020,1590
service decides a new configuration,|
|

1507
00:53:53,620 --> 00:53:54,310
0,90 90,210 210,450 450,630 630,690
they can tell all the
它们可以告诉所有的服务器

1508
00:53:54,310 --> 00:53:56,050
0,390 390,600 600,1080 1080,1290 1290,1740
servers| and whatever and {the,clients}
|和任何关心的客户端，

1509
00:53:56,050 --> 00:53:57,520
0,540 540,960 990,1080 1080,1230 1230,1470
actually care,| you know here's
|这是新的配置。

1510
00:53:57,520 --> 00:53:58,820
0,60 60,210 210,780
the new configuration.|
|

1511
00:54:00,090 --> 00:54:01,560
0,270 270,420 420,690 690,1080 1080,1470
Does this only happen when
这是否仅在 S1 到 S2 连接断开时发生，

1512
00:54:01,560 --> 00:54:02,700
0,210 210,570 570,660 660,930 930,1140
{S1 -} to {S2 -}

1513
00:54:02,700 --> 00:54:04,680
0,510 510,660 660,1170 1170,1590 1620,1980
connection is separate| or wait
|或者是什么导致了脑裂？

1514
00:54:04,680 --> 00:54:06,150
0,330 450,780 780,1080 1080,1170 1170,1470
what, what causes the {split-brain

1515
00:54:06,150 --> 00:54:07,460
0,270 270,720
-} again?|
|

1516
00:54:07,760 --> 00:54:08,900
0,360 360,570 570,690 690,990 990,1140
{Split-brain -} would happen,| if
脑裂发生在，|如果 S2 自己决定 S1 失败并成为头部，

1517
00:54:08,900 --> 00:54:09,860
0,210 210,420 420,570 570,720 720,960
{S2 -} on its own

1518
00:54:09,860 --> 00:54:11,480
0,660 690,1080 1080,1230 1230,1440 1440,1620
decided that {S1 -} has

1519
00:54:11,480 --> 00:54:12,650
0,300 300,420 420,750 750,810 810,1170
failed and became the head,|
|

1520
00:54:13,220 --> 00:54:14,510
0,360 360,690 690,870 870,1140 1140,1290
so we're not allowed to
所以我们不允许这样的事情发生，

1521
00:54:14,510 --> 00:54:15,470
0,180 180,300 300,780 780,870 870,960
have that happen,| and the
|在实践中，实现的方法是，

1522
00:54:15,470 --> 00:54:17,300
0,300 300,690 690,1290 1320,1620 1620,1830
way actually the {} work

1523
00:54:17,300 --> 00:54:18,440
0,180 180,270 270,720 720,930 930,1140
out in practice is that,|
|

1524
00:54:18,440 --> 00:54:19,790
0,120 120,210 210,270 270,810 810,1350
there is a configuration server,|
这里有一个配置服务器，|

1525
00:54:20,030 --> 00:54:21,380
0,180 180,450 450,990 990,1230 1230,1350
that actually decides what is
它决定了当前的配置是什么，

1526
00:54:21,380 --> 00:54:23,660
0,210 210,270 270,510 510,1230 1920,2280
actually the current configuration,| and
|如果它确定 S1 已经宕机，

1527
00:54:23,660 --> 00:54:25,670
0,660 750,1110 1110,1410 1410,1560 1560,2010
so {} if it decides

1528
00:54:25,670 --> 00:54:26,810
0,150 150,270 270,510 510,660 660,1140
that {S1 -} is dead,|
|

1529
00:54:27,170 --> 00:54:28,700
0,420 420,810 810,990 990,1110 1110,1530
{} then it can inform
然后它可以通知 S2 S3 ，

1530
00:54:28,700 --> 00:54:29,930
0,180 180,330 330,510 510,930 930,1230
{S2 -} {S3 -},| saying
|说你们现在是新的链了， S2 是头部，

1531
00:54:29,930 --> 00:54:31,190
0,180 180,570 630,930 930,1200 1200,1260
like hey you guys are

1532
00:54:31,190 --> 00:54:33,440
0,240 240,390 390,960 990,1560 1800,2250
now the new chain and

1533
00:54:33,440 --> 00:54:34,700
0,150 150,390 390,510 510,870
{S2 is} the head,|
|

1534
00:54:35,030 --> 00:54:36,590
0,450 450,690 690,900 900,1170 1170,1560
and when that change happens,|
当这种变化发生时，|

1535
00:54:36,590 --> 00:54:37,700
0,210 210,330 330,480 480,780 780,1110
so in this case, basically
所以在这种情况下，会丢弃 S1 ，

1536
00:54:37,700 --> 00:54:39,080
0,150 150,360 360,450 450,960 990,1380
{S1 -} is dropped,| nothing
|不会有其他事情发生，

1537
00:54:39,080 --> 00:54:40,850
0,300 300,510 510,600 600,1140 1290,1770
else has to happen, {}|
|

1538
00:54:40,850 --> 00:54:43,310
0,720 750,1140 1140,1350 1350,1710 1710,2460
because {S2 - -} has,|
因为 S2 有，|

1539
00:54:43,550 --> 00:54:44,690
0,180 180,540 540,870 870,1020 1020,1140
the only update that we
我们丢失的唯一更新，

1540
00:54:44,690 --> 00:54:45,860
0,480 480,540 540,750 750,1050 1050,1170
lost,| the one actually was
|并没有进行提交，

1541
00:54:45,860 --> 00:54:47,090
0,180 180,480 480,870 870,1050 1050,1230
not committed anyway,| so there's
|所以没有什么需要进一步修复的。

1542
00:54:47,090 --> 00:54:48,320
0,240 240,330 330,480 480,870 870,1230
nothing to be repaired further.|
|

1543
00:54:49,990 --> 00:54:51,550
0,300 300,750 780,1200 1200,1410 1410,1560
So making this go from
所以从这个三个复制的设置开始，

1544
00:54:51,550 --> 00:54:53,530
0,240 240,780 780,1170 1170,1470 1470,1980
this setting from three replica|
|

1545
00:54:53,560 --> 00:54:54,730
0,240 240,480 480,840 840,930 930,1170
with the dropping the head
丢弃头部是相当简单的操作。

1546
00:54:54,730 --> 00:54:56,620
0,150 150,630 630,870 870,1410 1410,1890
is basically pretty straightforward operation.|
|

1547
00:55:00,140 --> 00:55:01,420
0,810
Okay?|
好的?|

1548
00:55:01,450 --> 00:55:03,100
0,360 540,1140 1140,1500 1500,1590 1590,1650
{} Professor, I have a
教授，我有一个问题，

1549
00:55:03,100 --> 00:55:05,320
0,540 540,1080 1140,1950 1950,2130 2130,2220
question,| so there's there's an
|所以这里有一个假设，

1550
00:55:05,320 --> 00:55:07,540
0,630 630,1080 1080,1320 1320,1650
assumption here,| that {}
|就像命令一样，

1551
00:55:07,690 --> 00:55:10,720
0,420 630,1350 1620,1890 1890,2700 2790,3030
like the {} commands that,|
|

1552
00:55:10,720 --> 00:55:13,690
0,510 780,1140 1350,2100 2130,2370 2370,2970
like like leave {S1 -}
离开 S1 将按顺序到达 S2 ，

1553
00:55:13,750 --> 00:55:15,670
0,330 330,480 480,1020 1020,1230 1230,1920
like will arrive in order

1554
00:55:16,060 --> 00:55:18,340
0,660 750,1200 1200,1560 1890,2100 2100,2280
at {S2 -},| is that
|这是不是一个合理的假设，比如。

1555
00:55:18,340 --> 00:55:19,220
0,390
like,

1556
00:55:19,460 --> 00:55:20,870
0,120 120,240 240,330 330,750 750,1410
is that a reasonable assumption,

1557
00:55:20,900 --> 00:55:22,400
0,210 210,630 930,1140 1140,1230 1230,1500
for like.| Well, I think
|好的，我认为它们的方式，

1558
00:55:22,400 --> 00:55:23,780
0,90 90,240 240,1050 1080,1230 1230,1380
the way they,| so they
|所以他们说，

1559
00:55:23,780 --> 00:55:25,280
0,330 330,690 690,1110 1110,1380 1380,1500
basically say,| we need a
|我们需要在 S1 和 S2 之间一个可靠地先入先出，

1560
00:55:25,280 --> 00:55:26,840
0,450 450,960 960,1260 1260,1380 1380,1560
reliable FIFO between {S1 -}

1561
00:55:26,840 --> 00:55:28,220
0,120 120,270 270,540 690,1230 1230,1380
and {S2 -}, right,| {S2
|以及 S2 到 S3 ，

1562
00:55:28,220 --> 00:55:29,480
0,180 180,270 270,390 390,780 840,1260
-} to {S3 -},| and
|我想他们实现的方式很可能是使用 TCP 连接。

1563
00:55:29,480 --> 00:55:30,290
0,90 90,240 240,330 330,510 510,810
I think the way they

1564
00:55:30,290 --> 00:55:31,580
0,540 540,690 690,780 780,1050 1050,1290
implement, that is probably using

1565
00:55:31,580 --> 00:55:32,860
0,360 360,750
TCP connection.|
|

1566
00:55:36,470 --> 00:55:37,560
0,510
{Okay\,,thanks}.|
好的，谢谢。|

1567
00:55:37,620 --> 00:55:38,880
0,210 210,480 480,1020 1020,1200 1200,1260
Okay, so let's look at
好的，让我们来看第二种情况。

1568
00:55:38,880 --> 00:55:40,200
0,60 60,300 300,810
the second case.|
|

1569
00:55:40,200 --> 00:55:41,790
0,450 450,690 690,1020 1020,1380 1410,1590
{} So we're have you
所以我们有 S1 S2 S3 ，

1570
00:55:41,790 --> 00:55:43,050
0,240 240,510 510,660 660,780 780,1260
know { -} {S1 -},

1571
00:55:43,940 --> 00:55:45,800
0,390 390,540 540,1200
{you,know,S2 - -},

1572
00:55:46,700 --> 00:55:48,110
0,270 270,810 960,1140 1140,1200 1200,1410
{S3 -},| and of course
|当然，链中可能会有更多的服务器，

1573
00:55:48,110 --> 00:55:49,040
0,90 90,240 240,330 330,840 840,930
there could be more you

1574
00:55:49,040 --> 00:55:50,180
0,120 120,480 480,660 660,1020 1020,1140
know servers into chain,| but
|但是三个足够我们考虑所有的情况，

1575
00:55:50,180 --> 00:55:52,100
0,750 780,1170 1200,1440 1440,1740 1740,1920
like {you,know} three enough for

1576
00:55:52,100 --> 00:55:52,820
0,150 150,240 240,570 570,660 660,720
us to consider all the

1577
00:55:52,820 --> 00:55:55,610
0,660 1200,1560 1560,2130 2160,2520 2520,2790
cases,| and so now what
|所以现在我们想要做的是，中间的一个崩溃了，

1578
00:55:55,610 --> 00:55:56,390
0,90 90,240 240,300 300,570 570,780
we want to do take

1579
00:55:56,390 --> 00:55:57,110
0,60 60,270 270,420 420,480 480,720
the case, where a middle

1580
00:55:57,110 --> 00:55:58,400
0,210 210,840
one crashes,|
|

1581
00:55:58,790 --> 00:56:00,420
0,180 180,360 360,930
this one crashes.|
这个崩溃了。|

1582
00:56:00,780 --> 00:56:03,120
0,900 930,1680 1680,1800 1800,1890 1890,2340
And {} so the configuration
所以，配置服务在某一时刻决定 S2 崩溃，

1583
00:56:03,120 --> 00:56:04,500
0,330 330,390 390,540 540,930 930,1380
service at some point decides

1584
00:56:04,500 --> 00:56:06,060
0,510 510,720 720,1260 1260,1380 1380,1560
{S2 -} crash,| you know
|通知 S1 S3 ，它们形成新的链，

1585
00:56:06,060 --> 00:56:07,860
0,630 630,930 930,1140 1140,1470 1470,1800
informs S1 {S3 -}, that

1586
00:56:07,860 --> 00:56:09,510
0,510 510,720 720,1200 1200,1440 1440,1650
basically they form the new

1587
00:56:09,510 --> 00:56:10,640
0,540
chain,|
|

1588
00:56:10,730 --> 00:56:12,920
0,540 540,1020 1020,1440 1440,1860 1860,2190
{} and we're wondering about
我们想知道，还有什么事情需要发生？

1589
00:56:12,920 --> 00:56:14,300
0,420 600,810 810,1080 1080,1290 1290,1380
like what else needs to

1590
00:56:14,300 --> 00:56:15,240
0,360
happen?|
|

1591
00:56:16,010 --> 00:56:16,730
0,120 120,300 300,390 390,480 480,720
We saw in the first
我们在第一种情况中看到，

1592
00:56:16,730 --> 00:56:18,710
0,450 450,540 540,750 750,1380 1410,1980
case,| the head drops, then
|丢弃头部，就没什么好做的了，

1593
00:56:18,710 --> 00:56:19,700
0,300 300,540 540,810 810,900 900,990
nothing really has to be

1594
00:56:19,700 --> 00:56:20,840
0,300 300,540 540,690 690,1050 1050,1140
done,| other than updating the
|除了更新链之外，

1595
00:56:20,840 --> 00:56:22,010
0,420 420,630 630,870 870,1080 1080,1170
chain,| now we're updating the
|现在我们更新链，

1596
00:56:22,010 --> 00:56:23,780
0,390 390,450 450,780 780,1230 1650,1770
chain,| the question is, is
|问题是，有什么事情需要发生？

1597
00:56:23,780 --> 00:56:25,320
0,300 300,540 540,630 630,960
anything needs to happen?|
|

1598
00:56:26,850 --> 00:56:28,740
0,870 990,1230 1230,1470 1470,1740 1740,1890
The {S1 -} needs to
S1 需要发送给 S3 ，

1599
00:56:28,740 --> 00:56:30,180
0,480 480,630 630,900 900,1140 1140,1440
send to {S3 -},| the
|发送给 S2 的请求，

1600
00:56:30,180 --> 00:56:31,260
0,420 420,600 600,720 720,990 990,1080
request that it sent to

1601
00:56:31,260 --> 00:56:32,340
0,210 210,390 390,570 570,840 840,1080
{S2 -},| but didn't make
|但没发给 S3 。

1602
00:56:32,340 --> 00:56:37,080
0,120 120,300 1830,3540 3540,3930 3930,4740
it to {S3 - -

1603
00:56:37,080 --> 00:56:39,630
0,150 150,690 1140,1710 1710,2130 2220,2550
- -}.| Yes, we {have
|是的，我们有 U1 U2 U3 ，

1604
00:56:39,630 --> 00:56:40,650
0,270 270,420 420,660 660,750 750,1020
-} you know {U1 -}

1605
00:56:40,650 --> 00:56:41,760
0,90 90,210 210,750 750,900 900,1110
U2 {U3 -},| this guy
|这个看到 U1 和 U2 ，

1606
00:56:41,760 --> 00:56:43,410
0,390 420,630 630,900 900,1080 1080,1650
had {} see {U1,and,U2 -},|
|

1607
00:56:43,920 --> 00:56:46,200
0,1230 1260,1380 1380,1710 1710,1920 1920,2280
and {this,guy,see,U1 -},| {and,the} U2
这个看到 U1 ，|U2 正在进行，

1608
00:56:46,200 --> 00:56:47,370
0,240 240,480 480,570 570,1080 1080,1170
that's actually in progress,| you
|我丢失了 S2 ，

1609
00:56:47,370 --> 00:56:51,960
0,1050 1440,2160 2490,3150 3750,4350 4350,4590
know { -} {the,I,got} lost

1610
00:56:51,960 --> 00:56:53,130
0,210 210,480 480,840 840,960 960,1170
{S2 -},| basically {S1 -}
|S1 必须使 S3 保持最新，

1611
00:56:53,130 --> 00:56:54,180
0,180 180,270 270,690 690,870 870,1050
has to {bring,S3 - -}

1612
00:56:54,180 --> 00:56:55,500
0,120 120,240 240,330 330,720 750,1320
{} up to date,| basically
|向前推进 U2 和 U3 。

1613
00:56:55,500 --> 00:56:57,030
0,570 570,990 990,1110 1110,1230 1230,1530
forward U2 and {U3 -}.|
|

1614
00:56:58,120 --> 00:56:59,470
0,630 690,840 840,1080 1080,1140 1140,1350
Okay, so that's a little
好的，这需要做一些工作，

1615
00:56:59,470 --> 00:57:01,210
0,120 120,180 180,420 420,960 1230,1740
bit of work involved,| let's
|让我们来考虑最后一种情况，尾部。

1616
00:57:01,210 --> 00:57:02,980
0,360 360,450 450,750 750,1290
consider the final case,

1617
00:57:03,180 --> 00:57:04,560
0,720
{the,tail}.|
|

1618
00:57:04,820 --> 00:57:06,440
0,690 720,1140 1140,1380 1380,1470 1470,1620
So {} here we go
所以我们又来了，

1619
00:57:06,440 --> 00:57:08,090
0,450 480,630 630,750 750,900 900,1650
again,| we have three cases,|
|我们有三种情况，|

1620
00:57:09,200 --> 00:57:11,390
0,750 900,1080 1080,1320 1320,1980 1980,2190
S1, {} three servers {S2
三个服务器 S1 S2 S3 。

1621
00:57:11,390 --> 00:57:14,540
0,600 1830,2160 2160,2430 2430,2580 2580,3150
-}, {the,third} one {S3 -}.|
|

1622
00:57:16,240 --> 00:57:19,180
0,720 750,1470 2190,2670 2670,2880 2880,2940
And, {} let's see, {}
让我们看看，尾部崩溃了。

1623
00:57:19,180 --> 00:57:22,480
0,480 480,870 1140,1860 1890,2640
so the tail crashes.|
|

1624
00:57:22,990 --> 00:57:24,610
0,240 240,810 1050,1230 1230,1350 1350,1620
And so at some point
所以，在某个时间点，

1625
00:57:24,610 --> 00:57:27,160
0,60 60,690 690,1530 1830,2310 2310,2550
in time,| the configuration service
|配置服务通知决定新的链将是 S1 和 S2 ，

1626
00:57:27,160 --> 00:57:29,170
0,780 1020,1530 1530,1680 1680,1740 1740,2010
notices decides that the new

1627
00:57:29,170 --> 00:57:29,830
0,270 270,330 330,450 450,510 510,660
chain is going to be

1628
00:57:29,830 --> 00:57:30,730
0,120 120,300 300,390 390,540 540,900
{S1 -} and {S2 -},|
|

1629
00:57:30,730 --> 00:57:31,750
0,270 270,390 390,570 570,750 750,1020
tells {S1 -} and S2
告诉 S1 和 S2 它们是新链的一部分，

1630
00:57:31,750 --> 00:57:32,500
0,180 180,270 270,540 540,690 690,750
that they are part of

1631
00:57:32,500 --> 00:57:35,320
0,60 60,210 210,720 1170,2250 2280,2820
the new chain,| and {}
|还有其他需要发生的事情吗？

1632
00:57:35,320 --> 00:57:36,370
0,270 270,450 450,630 630,690 690,1050
what else needs to happen?|
|

1633
00:57:38,240 --> 00:57:40,340
0,540 540,750 750,960 960,1530 1920,2100
Well, let's write down,| we
好的，让我们写下来，|我们知道，这个看到 U1 U2 U3 ，

1634
00:57:40,340 --> 00:57:41,480
0,600
know,

1635
00:57:41,770 --> 00:57:42,790
0,270 270,540 540,630 630,930 930,1020
this guy have seen {U1

1636
00:57:42,790 --> 00:57:44,710
0,510 510,1050 1050,1230 1230,1410 1410,1920
-} U2 and {U3 -},|
|

1637
00:57:44,710 --> 00:57:45,730
0,300 300,540 540,630 630,840 840,1020
this guy have seen {U1
这个看过 U1 U2 ，

1638
00:57:45,730 --> 00:57:47,220
0,330 330,1020
-} U2,|
|

1639
00:57:48,040 --> 00:57:48,940
0,150 150,300 300,570 570,660 660,900
so who becomes the new
那么，在这种情况下，谁将成为新的尾部？

1640
00:57:48,940 --> 00:57:51,260
0,480 510,660 660,870 870,1770
tail in this scenario?|
|

1641
00:57:51,990 --> 00:57:53,670
0,270 270,600 870,1230 1230,1470 1470,1680
{S2 -}.| Yes, S2 becomes
S2 。|是的， S2 成为新的尾部，

1642
00:57:53,670 --> 00:57:55,590
0,180 180,810 1020,1440 1440,1710 1710,1920
new tail,| and anything else
|还有其他需要发生的事情吗？

1643
00:57:55,590 --> 00:57:56,920
0,90 90,240 240,300 300,750
that needs to happen?|
|

1644
00:57:57,380 --> 00:57:59,480
0,450 840,1260 1260,1410 1410,1860 1860,2100
I guess the client needs
我想客户端需要被告知 S2 是。

1645
00:57:59,480 --> 00:58:00,920
0,120 120,270 270,1050 1050,1260 1260,1440
to be informed that {S2

1646
00:58:00,920 --> 00:58:02,930
0,210 210,420 420,930 1380,1620 1620,2010
-} is the.| Yeah, {that's,the,client}
|是的，客户端可以从配置服务获取。

1647
00:58:02,930 --> 00:58:04,130
0,150 150,480 480,630 630,690 690,1200
might learn from the configuration

1648
00:58:04,130 --> 00:58:05,460
0,390 390,840
service, correct.|
|

1649
00:58:05,750 --> 00:58:06,950
0,540 540,720 720,870 870,1080 1080,1200
{} And so yeah, but
所以是的，但没有其他事情要发生，

1650
00:58:06,950 --> 00:58:07,850
0,210 210,390 390,540 540,600 600,900
nothing else has to happen,

1651
00:58:07,880 --> 00:58:11,450
0,240 240,690 1080,1950 2340,3060 3360,3570
right,| because {} the, all
|因为，所有提交的，

1652
00:58:11,450 --> 00:58:13,040
0,90 90,600 600,720 720,870 870,1590
the committed,| you know the
|没有提交的操作会丢失，

1653
00:58:13,160 --> 00:58:14,900
0,300 300,600 600,1080 1080,1170 1170,1740
no committed operations are lost,|
|

1654
00:58:15,080 --> 00:58:18,170
0,780 780,1500 1770,2610 2610,2730 2730,3090
{} and {} you know,
由于我们仍然，

1655
00:58:18,380 --> 00:58:19,850
0,660 660,1020 1020,1170 1170,1230 1230,1470
and as we are still

1656
00:58:19,850 --> 00:58:21,140
0,300 300,570 600,930 930,1020 1020,1290
in| {} needs to still
|仍然需要传播到 S2 会发生。

1657
00:58:21,140 --> 00:58:22,310
0,360 360,600 600,1080 1080,1170 1170,1170
be actually propagated to {S2

1658
00:58:22,310 --> 00:58:23,810
0,510 510,690 690,990 990,1140 1140,1500
-} will be just happening.|
|

1659
00:58:24,740 --> 00:58:25,850
0,300 300,450 450,780 780,870 870,1110
Okay, so dropping the tail
好的，所以丢弃尾部也是直截了当的。

1660
00:58:25,850 --> 00:58:26,960
0,60 60,300 300,600 600,900 900,1110
is also reasonable straightforward.| So
|所以丢弃尾部，头部是很直截了当的，

1661
00:58:26,960 --> 00:58:27,890
0,360 360,420 420,660 660,750 750,930
dropping the tail, the head

1662
00:58:27,890 --> 00:58:29,300
0,270 270,420 420,720 720,930 930,1410
is a reasonable {straightforward -},|
|

1663
00:58:29,510 --> 00:58:30,470
0,450 450,510 510,690 690,870 870,960
dropping the middle one is
丢弃中间那个更复杂一些，

1664
00:58:30,470 --> 00:58:31,910
0,120 120,240 240,360 360,990 1200,1440
a bit more complicated,| but
|但并不是很复杂。

1665
00:58:31,910 --> 00:58:33,710
0,150 150,330 330,480 480,1140 1410,1800
not much more complicated.| And
|我在这里想强调的关键是，

1666
00:58:33,710 --> 00:58:34,580
0,210 210,420 420,570 570,780 780,870
the key thing go I

1667
00:58:34,580 --> 00:58:35,500
0,150 150,390
want to

1668
00:58:35,650 --> 00:58:37,270
0,210 210,270 270,750 750,1110 1110,1620
sort of emphasize here is,|
|

1669
00:58:37,420 --> 00:58:38,350
0,180 180,300 300,420 420,810 810,930
how does this compare to
这与 Raft 论文上的图 7 和图 8 相比如何？

1670
00:58:38,350 --> 00:58:39,790
0,210 210,480 480,630 630,960 1050,1440
figure 7 and 8 in

1671
00:58:39,790 --> 00:58:41,140
0,120 120,420 420,810
the Raft paper?|
|

1672
00:58:49,080 --> 00:58:51,180
0,360 360,690 1470,1740 1740,1830 1830,2100
Maybe to.| Yeah, go ahead.|
也许是为了。|好的，继续。|

1673
00:58:52,620 --> 00:58:55,200
0,540 540,1140 1350,1590 1620,2340 2340,2580
Question, {so ... - -
问题，所以，

1674
00:58:55,200 --> 00:58:56,850
0,270 270,570 570,1050 1110,1500 1500,1650
- - - - -

1675
00:58:56,850 --> 00:58:58,920
0,660 750,990 990,1230 1230,1350 1740,2070
- - - - -

1676
00:58:59,070 --> 00:59:01,140
0,300 300,690 1020,1710 1710,1800 1800,2070
- - - - -

1677
00:59:01,140 --> 00:59:02,310
0,480 480,690 690,780 780,870 870,1170
- - - - -

1678
00:59:02,310 --> 00:59:04,140
0,390 390,930 930,1110 1110,1290 1290,1830
-},| that these new operations
|这些新的操作都是自动的。

1679
00:59:04,140 --> 00:59:06,870
0,120 120,270 270,1140 2070,2640 2640,2730
have been automatically.| Um, {}
|抱歉，我没有听到你说的话，

1680
00:59:06,870 --> 00:59:08,100
0,300 300,360 360,600 600,900 900,1230
sorry, I didn't hear you,|
|

1681
00:59:08,130 --> 00:59:10,530
0,510 510,1110 1200,1650 1650,1860 1860,2400
{you,were} pretty {} pretty noisy
你那里的连接相当嘈杂。

1682
00:59:10,680 --> 00:59:12,560
0,510 510,840
connection there.|
|

1683
00:59:12,890 --> 00:59:14,630
0,360 480,840 840,930 930,1230 1230,1740
Yeah, like I'm just saying,
好的，我刚才说， S2 变成了新的尾部，

1684
00:59:14,630 --> 00:59:16,970
0,420 420,810 960,1620 1620,1890 1890,2340
that {S2,becomes} new {} tail,|
|

1685
00:59:17,360 --> 00:59:18,980
0,240 240,450 450,630 630,990 1020,1620
don't have to send acknowledgment
不必向客户端发回确认吗，

1686
00:59:18,980 --> 00:59:20,030
0,210 210,300 300,390 390,930 930,1050
back to the client,| and
|还有一些条目是自动提交的。

1687
00:59:20,030 --> 00:59:20,960
0,120 120,210 210,420 420,780 780,930
there are some entries that

1688
00:59:20,960 --> 00:59:22,960
0,150 150,360 360,930 930,1350
have been automatically committed.|
|

1689
00:59:23,810 --> 00:59:25,100
0,270 270,600 600,1020 1020,1200 1200,1290
{} Yeah, that might be
是的，可能是这样的，

1690
00:59:25,100 --> 00:59:27,380
0,60 60,330 330,570 570,1530 1590,2280
the case,| that {} what
|客户端可能发生的事情是重试，

1691
00:59:27,380 --> 00:59:28,160
0,270 270,360 360,420 420,690 690,780
happens is the client is

1692
00:59:28,160 --> 00:59:29,390
0,210 210,330 330,390 390,870 900,1230
probably going to retry, right,|
|

1693
00:59:29,870 --> 00:59:31,790
0,870 900,1470 1470,1680 1680,1860 1860,1920
and {} we have to
我们必须有一个像实验 3 中的独立的重复检测方案，

1694
00:59:31,790 --> 00:59:33,380
0,180 180,270 270,540 540,1260 1260,1590
have a separate duplication scheme

1695
00:59:33,380 --> 00:59:35,240
0,270 270,420 420,780 780,1350 1350,1860
like in {} {lab,3} anyway,|
|

1696
00:59:36,470 --> 00:59:37,130
0,240 240,330 330,480 480,600 600,660
and so there's kind of
有几种不同的方法可以做到这一点，

1697
00:59:37,130 --> 00:59:39,200
0,690 1050,1320 1320,1560 1560,1740 1740,2070
a couple different ways about

1698
00:59:39,200 --> 00:59:39,920
0,150 150,240 240,390 390,600 600,720
how to do it, {}|
|

1699
00:59:39,920 --> 00:59:40,910
0,180 180,480 480,510 510,660 660,990
the paper are not particularly
论文并没有说明它使用哪一个。

1700
00:59:40,910 --> 00:59:41,780
0,270 270,450 450,660 660,720 720,870
clear which one it will

1701
00:59:41,780 --> 00:59:42,680
0,390
take.|
|

1702
00:59:43,610 --> 00:59:45,200
0,330 330,570 570,870 870,1050
Okay, {I,see}, thank you.|
好的，我明白了，谢谢。|

1703
00:59:45,660 --> 00:59:47,370
0,420 900,1350 1350,1440 1440,1620 1620,1710
Yeah, like in that in
是的，就像这种情况，

1704
00:59:47,370 --> 00:59:48,390
0,180 180,480 480,750 750,930 930,1020
that case,| {} didn't the
|论文不是说了，

1705
00:59:48,390 --> 00:59:50,120
0,330 330,510 510,720 720,1080
paper just say like,|
|

1706
00:59:50,120 --> 00:59:51,590
0,90 90,420 450,630 630,1080 1140,1470
you know it might like,|
它可能会，|

1707
00:59:52,160 --> 00:59:53,330
0,270 270,390 390,480 480,720 720,1170
even if it doesn't respond
即使它没有回应，

1708
00:59:53,330 --> 00:59:54,590
0,150 150,480 480,570 570,780 780,1260
it,| could or could not
|可能成功，也可能不成功。

1709
00:59:54,590 --> 00:59:57,360
0,210 210,870
have succeeded.|
|

1710
00:59:57,950 --> 00:59:59,000
0,270 270,390 390,780 780,870 870,1050
Okay, so back to my
好的，回到我原来的问题，

1711
00:59:59,000 --> 01:00:00,260
0,300 300,630 630,930 930,1140 1140,1260
actual original question,| which is
|这个对比如何，

1712
01:00:00,260 --> 01:00:01,130
0,210 210,300 300,540 540,720 720,870
like, you know how does

1713
01:00:01,130 --> 01:00:02,930
0,240 360,960 960,1170 1170,1530 1530,1800
this contrast,| this picture of
|我在这个白板上画的图，

1714
01:00:02,930 --> 01:00:04,970
0,360 540,1020 1020,1440 1440,1740 1740,2040
my my drawn picture here

1715
01:00:04,970 --> 01:00:05,840
0,120 120,270 270,510 510,750 750,870
on this white board,| how
|对比图 7 和图 8 ，有什么不同？

1716
01:00:05,840 --> 01:00:06,830
0,150 150,270 270,660 660,720 720,990
does that contrast to figure

1717
01:00:06,830 --> 01:00:07,980
0,270 270,390 390,660
7 and 8?|
|

1718
01:00:08,610 --> 01:00:11,550
0,630 1170,2070 2190,2250 2400,2790 2790,2940
Simpler.| Yeah, I mean that's
更简单。|是的，这就是我想要表达的重点，

1719
01:00:11,550 --> 01:00:12,360
0,90 90,270 270,540 540,570 570,810
the key point I wanted

1720
01:00:12,360 --> 01:00:13,320
0,60 60,180 180,630 630,840 840,960
to get across, right,| you
|这里要考虑的情况并不多，

1721
01:00:13,320 --> 01:00:14,730
0,540 540,750 750,990 990,1170 1170,1410
know there's not that many

1722
01:00:14,730 --> 01:00:16,140
0,300 300,390 390,780 780,1080 1080,1410
cases to consider here,| basically
|只有三种情况，

1723
01:00:16,140 --> 01:00:18,000
0,180 180,780 1140,1500 1500,1740 1740,1860
three cases,| {} which is
|比 Raft 论文的情况要简单得多，

1724
01:00:18,000 --> 01:00:19,800
0,180 180,720 720,810 810,1500 1500,1800
like slightly you know quite

1725
01:00:19,800 --> 01:00:21,450
0,30 30,180 180,600 600,990 1050,1650
a bit simpler than {}

1726
01:00:21,450 --> 01:00:23,100
0,510 990,1290 1290,1350 1350,1410 1410,1650
the case of the Raft

1727
01:00:23,100 --> 01:00:24,630
0,300 300,720 720,810 810,1080 1080,1530
paper,| where the many {}
|要考虑的情况很多，场景很复杂，

1728
01:00:24,630 --> 01:00:26,100
0,90 90,780 780,990 990,1410 1410,1470
to consider, the scenarios are

1729
01:00:26,100 --> 01:00:27,870
0,240 240,810 960,1440 1470,1680 1680,1770
quite complicated,| now part of
|部分原因是这是一条链，

1730
01:00:27,870 --> 01:00:29,250
0,240 240,330 330,810 1020,1200 1200,1380
that is because you know

1731
01:00:29,250 --> 01:00:30,510
0,270 270,330 330,750 780,1110 1110,1260
it's a chain, right, {}|
|

1732
01:00:30,510 --> 01:00:31,500
0,150 150,330 330,570 570,720 720,990
you know things are pushed
事情以一种非常直截了当的方式推下来，

1733
01:00:31,500 --> 01:00:34,260
0,600 810,1980 1980,2400 2400,2460 2460,2760
down {} in a very

1734
01:00:34,260 --> 01:00:36,720
0,210 210,750 750,1530 1530,2160 2160,2460
sort of straightforward manner,| down
|向复制链的下方，

1735
01:00:36,720 --> 01:00:38,580
0,60 60,540 540,990 1350,1500 1500,1860
the replication chain,| and part
|当然，部分原因是，

1736
01:00:38,580 --> 01:00:39,540
0,60 60,300 300,390 390,480 480,960
of that is, of course,|
|

1737
01:00:39,540 --> 01:00:41,010
0,90 90,660 660,1080 1200,1350 1350,1470
the configuration part is sort
配置部分外包给配置管理器。

1738
01:00:41,010 --> 01:00:43,290
0,120 120,840 870,1230 1230,1770 1770,2280
of outsource to configuration manager

1739
01:00:43,320 --> 01:00:44,160
0,480
manager.|
|

1740
01:00:44,540 --> 01:00:45,500
0,300 300,480 480,600 600,690 690,960
{} But for the primary
但是对于主备部分的恢复方案，

1741
01:00:45,500 --> 01:00:47,390
0,540 810,1200 1230,1620 1620,1800 1800,1890
backup {} part of the

1742
01:00:47,390 --> 01:00:48,860
0,420 420,870 930,1140 1140,1200 1200,1470
recovery plan,| that's a reasonable
|这是直截了当的，

1743
01:00:48,860 --> 01:00:50,270
0,630 660,900 900,1050 1050,1230 1230,1410
straightforward,| there are only three
|只有三种配置需要考虑。

1744
01:00:50,270 --> 01:00:52,320
0,630 630,900 900,1530
configurations to consider.|
|

1745
01:00:54,920 --> 01:00:56,480
0,150 150,330 330,900 1080,1500 1500,1560
{} One more point {I,want,to}
我还想提出一个点，

1746
01:00:56,480 --> 01:00:57,620
0,210 210,390 390,540 540,780 780,1140
make,| which is like how
|就是如何添加复制，

1747
01:00:57,620 --> 01:00:58,820
0,120 120,300 300,360 360,780 900,1200
to add a replica,| because
|因为这里的任何系统都会实时运行，

1748
01:00:58,820 --> 01:01:00,110
0,270 270,750 750,870 870,1020 1020,1290
any system you know that

1749
01:01:00,230 --> 01:01:01,400
0,540 570,780 780,840 840,1050 1050,1170
here going to run for

1750
01:01:01,400 --> 01:01:02,750
0,420 420,810 810,900 900,1050 1050,1350
{real,time},| really at some point
|在某些时候，你需要添加一个新的，

1751
01:01:02,750 --> 01:01:03,900
0,90 90,540
you gotta

1752
01:01:04,180 --> 01:01:05,410
0,300 300,330 330,480 480,840 840,1230
add a new one in,|
|

1753
01:01:05,680 --> 01:01:07,930
0,420 420,1200 1200,1740 1740,1890 1890,2250
because otherwise you're gonna lose,|
因为否则你会丢失，|

1754
01:01:07,930 --> 01:01:08,980
0,180 180,450 450,510 510,870 870,1050
you start the three,| then
你开始有三个，|然后你有两个，然后有一个，然后就没有了，

1755
01:01:08,980 --> 01:01:09,790
0,120 120,270 270,510 510,690 690,810
you have two, then get

1756
01:01:09,790 --> 01:01:10,360
0,240 240,330 330,420 420,480 480,570
one and then you have

1757
01:01:10,360 --> 01:01:11,290
0,360 360,510 510,630 630,840 840,930
zero,| and then you're on
|然后你就[]。

1758
01:01:11,290 --> 01:01:12,820
0,60 60,390 420,840 1080,1410 1410,1530
the [].| So, {you,know} you
|所以，你必须添加新的复制，

1759
01:01:12,820 --> 01:01:15,070
0,240 240,540 540,1380 1410,1770 1770,2250
have to {} add new

1760
01:01:15,100 --> 01:01:16,600
0,420 420,870 870,1080 1080,1410 1410,1500
replica,| {so,let's} to consider the
|所以让我们来考虑一下这个情况，

1761
01:01:16,600 --> 01:01:19,480
0,570 1020,1500 1500,1860 1860,2370 2670,2880
case,| {so,here's} {S1 -}, it
|这是 S1 ，它是头部，

1762
01:01:19,480 --> 01:01:21,160
0,150 150,240 240,720
is the head,|
|

1763
01:01:21,820 --> 01:01:22,660
0,270 270,480 480,720 720,810 810,840
let's say we're in a
假设我们在一种情景中，

1764
01:01:22,660 --> 01:01:24,160
0,510 510,1080 1110,1230 1230,1380 1380,1500
scenario,| where you know we
|我们有 S1 S2 ， S2 是尾部，

1765
01:01:24,160 --> 01:01:25,540
0,180 180,540 540,660 660,810 810,1380
have S1 and {S2 -}

1766
01:01:25,870 --> 01:01:27,970
0,270 270,330 330,840 840,1320 1320,2100
{who's} the tail,| and basically
|我们想要添加 S3 ，

1767
01:01:28,030 --> 01:01:29,110
0,270 270,390 390,450 450,660 660,1080
we want to bring {up,S3

1768
01:01:29,140 --> 01:01:30,340
0,270 270,660
- -},|
|

1769
01:01:32,190 --> 01:01:33,150
0,180 180,300 300,570 570,870 870,960
and it turns out you
事实证明，正如论文所描述的那样，

1770
01:01:33,150 --> 01:01:34,200
0,90 90,210 210,270 270,480 480,1050
know as the paper described,|
|

1771
01:01:34,200 --> 01:01:35,280
0,90 90,210 210,450 450,960 960,1080
it was most convenient to
在它的尾部做这件事是最方便的，

1772
01:01:35,280 --> 01:01:37,470
0,240 240,390 390,870 1260,1920 1920,2190
actually do this {} at

1773
01:01:37,470 --> 01:01:40,080
0,1830 1830,2100 2100,2250 2250,2370 2370,2610
the tail end of it,|
|

1774
01:01:40,260 --> 01:01:41,220
0,150 150,450 450,630 630,720 720,960
so basically make the new
所以创建新的服务器，新的尾部。

1775
01:01:41,220 --> 01:01:44,960
0,750 870,1740 1980,2730 2730,3270
server, the new tail.|
|

1776
01:01:45,170 --> 01:01:46,130
0,360 360,480 480,570 570,750 750,960
And so the way that
所以，我们继续进行的方式是，

1777
01:01:46,130 --> 01:01:47,390
0,180 180,630 630,840 840,1200 1200,1260
we proceed is,| like the
|比如客户端在这里，

1778
01:01:47,390 --> 01:01:49,820
0,360 360,480 480,990 1350,1800 1800,2430
client is here,| talking to
|访问 S2 ，

1779
01:01:49,850 --> 01:01:51,590
0,540 540,900 900,1260 1260,1650 1650,1740
{S2 -},| because that's the
|因为这是当前的尾部，

1780
01:01:51,590 --> 01:01:53,300
0,300 300,840 960,1410 1410,1530 1530,1710
current tail,| {} {S3 -}
|S3 出现，

1781
01:01:53,300 --> 01:01:54,890
0,180 180,720 840,1140 1140,1500 1500,1590
comes up,| and basically the
|它做的第一件事是

1782
01:01:54,890 --> 01:01:55,610
0,210 210,360 360,420 420,660 660,720
first thing it does is,|
|

1783
01:01:55,610 --> 01:01:57,050
0,60 60,360 360,1050 1050,1170 1170,1440
it actually copies {you,know} old
将 S3 中的旧状态复制到，

1784
01:01:57,050 --> 01:01:59,090
0,540 540,870 870,1080 1080,1470 1470,2040
state from {S3 -} to,|
|

1785
01:01:59,180 --> 01:02:00,080
0,240 240,390 390,510 510,660 660,900
{from,S2 -} to {S3 -}.|
从 S2 到 S3 。|

1786
01:02:01,040 --> 01:02:01,910
0,180 180,270 270,420 420,540 540,870
And so this may take
所以这可能需要几个小时，

1787
01:02:01,910 --> 01:02:04,040
0,540 930,1260 1260,1590 1590,1710 1710,2130
hours, right,| where you know
|几十分钟，甚至几个小时，

1788
01:02:04,460 --> 01:02:05,780
0,450 450,510 510,900 900,1080 1080,1320
tens of minutes or maybe

1789
01:02:05,780 --> 01:02:06,980
0,300 300,630 630,900 900,990 990,1200
indeed multiple hours,| you're going
|你将从 S2 向 S3 复制数 GB 或数 TB 的数据，

1790
01:02:06,980 --> 01:02:09,140
0,210 210,810 1050,1800 1800,1890 1890,2160
to copying gigabytes of data

1791
01:02:09,140 --> 01:02:10,400
0,120 120,630 630,720 720,1080 1080,1260
or terabytes of data from

1792
01:02:10,400 --> 01:02:11,360
0,180 180,330 330,420 420,570 570,960
{S2 -} to {S3 -},|
|

1793
01:02:11,630 --> 01:02:12,920
0,210 210,570 570,750 750,1200 1200,1290
but while that's happening,| you
但当这一切发生的时候，|S2 S3 能服务于请求，

1794
01:02:12,920 --> 01:02:14,450
0,210 210,390 390,570 570,660 660,1530
know {S2 -} and {S3

1795
01:02:14,450 --> 01:02:16,220
0,270 270,420 420,810 810,1080 1080,1770
-} can just serve request,|
|

1796
01:02:16,880 --> 01:02:18,350
0,90 90,600 870,1110 1110,1320 1320,1470
of course it does have
当然，它必须记住哪些是在 S3 开始复制之后进入的，

1797
01:02:18,350 --> 01:02:20,690
0,90 90,450 450,720 720,1440 1620,2340
to remember which ones {}

1798
01:02:20,690 --> 01:02:22,670
0,450 450,720 720,930 930,1560 1560,1980
are came in after {S3

1799
01:02:22,670 --> 01:02:24,170
0,180 180,630 630,1020 1050,1320 1320,1500
-} start copy,| so keep
|所以保持一份所有发生更新的列表，

1800
01:02:24,170 --> 01:02:25,100
0,60 60,360 360,690 690,870 870,930
a list of all the

1801
01:02:25,100 --> 01:02:26,240
0,480 480,630 630,720 720,900 900,1140
updates that are sort of

1802
01:02:26,810 --> 01:02:28,310
0,690 690,990 990,1200 1200,1320 1320,1500
happened,| but there have not
|但还没有传播到 S3 ，

1803
01:02:28,310 --> 01:02:29,780
0,120 120,660 660,750 750,1080 1080,1470
been propagated to S3 yet,|
|

1804
01:02:29,900 --> 01:02:31,160
0,420 420,600 600,840 840,990 990,1260
at some point {S3 -}
在某个时刻， S3 完成了所有复制，

1805
01:02:31,160 --> 01:02:32,900
0,660 660,840 840,990 990,1050 1050,1740
done with all the copying,|
|

1806
01:02:33,080 --> 01:02:34,460
0,240 240,540 540,960 960,1110 1110,1380
and basically tells {S2 -},|
告诉 S2 ，|

1807
01:02:34,460 --> 01:02:36,320
0,210 210,360 360,780 1140,1440 1440,1860
{} okay, man, I'm ready
好的，伙计，我准备好了，成为尾部，

1808
01:02:36,320 --> 01:02:37,310
0,90 90,210 210,300 300,570 570,990
you know to become {the,tail},|
|

1809
01:02:37,310 --> 01:02:38,330
0,90 90,300 300,450 450,510 510,1020
I got all the state,|
我得到了所有状态，|

1810
01:02:38,660 --> 01:02:40,610
0,480 480,780 780,1110 1140,1830 1830,1950
{S2 -}, {so,sends -} an
|S2 ，发送邮件，发送消息给 S2 ，

1811
01:02:40,610 --> 01:02:43,130
0,480 480,840 1080,1500 1830,2280 2280,2520
email, sends email, {sends,message} {to,S2


1812
01:02:43,130 --> 01:02:44,720
0,180 180,660 660,1020 1020,1440 1440,1590
-},| saying, okay, I want
|说，好的，我想成为尾部，

1813
01:02:44,720 --> 01:02:46,820
0,60 60,390 450,930 1110,1860 1890,2100
to be {} {the,tail},| {S2
|S2 回应，比如，是的，可以，

1814
01:02:46,820 --> 01:02:48,230
0,150 150,870 870,1020 1020,1230 1230,1410
-} responses, like yeah that's

1815
01:02:48,230 --> 01:02:50,420
0,630 750,1170 1170,1350 1350,1680 1680,2190
okay,| {} but once your
|但是一旦你应用了所有的更新。

1816
01:02:50,450 --> 01:02:52,380
0,780 780,930 930,1050 1050,1680
applied all the updates.|
|

1817
01:02:54,030 --> 01:02:55,110
0,240 240,420 420,780 780,930 930,1080
And so basically {S2 -}
所以， S2 发送更新响应这个，

1818
01:02:55,110 --> 01:02:56,610
0,270 270,360 360,810 810,1050 1050,1500
sends the updates in response

1819
01:02:56,610 --> 01:02:58,800
0,390 390,930 960,1320 1320,1980 1980,2190
to {} this,| I want
|我想继续一个尾部请求，

1820
01:02:58,800 --> 01:02:59,580
0,120 120,360 360,540 540,600 600,780
to go on to come

1821
01:02:59,580 --> 01:03:00,920
0,270 270,270
to {}

1822
01:03:01,010 --> 01:03:03,200
0,150 150,870 870,1320 1320,1830 1830,2190
a tail request,| in response
|作为对 S3 响应，

1823
01:03:03,200 --> 01:03:05,330
0,870 900,1200 1200,1350 1350,1800 1890,2130
that to {S3 -},| S3
|S3 回复更新，

1824
01:03:05,330 --> 01:03:07,040
0,480 480,570 570,1200 1380,1560 1560,1710
replies the updates,| and then
|然后变成尾部，

1825
01:03:07,040 --> 01:03:10,370
0,600 600,690 1410,2100 2610,3270 3270,3330
becomes {you,know,the} tail,| and you
|正在与 S2 交互的客户端，

1826
01:03:10,370 --> 01:03:11,690
0,390 390,810 810,930 930,1050 1050,1320
know clients that we're talking

1827
01:03:11,690 --> 01:03:12,800
0,300 300,510 510,780 840,960 960,1110
to S2,| and S2 can
|S2 可以告诉客户端，

1828
01:03:12,800 --> 01:03:13,880
0,210 210,480 480,870 870,930 930,1080
tell the client,| you know
|从现在开始，我不再是尾部了，

1829
01:03:13,880 --> 01:03:14,660
0,90 90,330 330,510 510,600 600,780
from now on, I'm not

1830
01:03:14,660 --> 01:03:15,740
0,270 270,660 660,780 780,900 900,1080
tail anymore,| you should talk
|你应该访问 S3 ，

1831
01:03:15,740 --> 01:03:16,610
0,60 60,150 150,480 570,750 750,870
to {S3 -},| and so
|所以它们可以切换方向。

1832
01:03:16,610 --> 01:03:17,900
0,150 150,270 270,840
they can swap

1833
01:03:17,960 --> 01:03:19,440
0,120 120,240 240,390 390,900
you know that direction.|
|

1834
01:03:19,470 --> 01:03:21,300
0,150 150,270 270,570 570,1140 1230,1830
And so that's the way
所以，这就是将复制添加到链中的方法。

1835
01:03:21,300 --> 01:03:23,280
0,180 180,510 510,780 780,1350 1350,1980
to add a replica into

1836
01:03:23,280 --> 01:03:24,440
0,150 150,540
a chain.|
|

1837
01:03:26,160 --> 01:03:28,020
0,390 450,930 930,1110 1110,1410 1440,1860
So question on this, {}|
所以关于这个的问题，|

1838
01:03:28,140 --> 01:03:29,190
0,210 210,480 480,660 660,840 840,1050
don't you run into this
你不会遇到这样的无限循环问题吗，

1839
01:03:29,190 --> 01:03:30,780
0,150 150,600 600,810 810,1110 1110,1590
like infinite loop problem,| {where,S2
|S2 将更新发送到 S3 ，

1840
01:03:30,780 --> 01:03:32,040
0,180 180,480 480,900 900,1020 1020,1260
-} sends updates to {S3

1841
01:03:32,040 --> 01:03:33,060
0,300 300,420 420,630 630,810 810,1020
-},| and when {S3 -}
|当 S3 更新时，它也服务于更多的请求，

1842
01:03:33,060 --> 01:03:34,920
0,120 120,390 630,1380 1380,1590 1590,1860
is like updating, its also

1843
01:03:34,920 --> 01:03:36,660
0,510 510,750 750,1440 1440,1560 1560,1740
serving more requests,| so as
|由于更多的更新，

1844
01:03:36,660 --> 01:03:38,250
0,210 210,960 990,1290 1290,1500 1500,1590
more updates,| that needs to
|它需要来回发送？

1845
01:03:38,250 --> 01:03:39,180
0,240 240,390 390,600 600,810 810,930
send and goes back and

1846
01:03:39,180 --> 01:03:40,060
0,480
forth?|
|

1847
01:03:40,280 --> 01:03:42,470
0,540 540,1230 1230,1500 1500,1740 1740,2190
No, no, once {S2 -}
不，一旦 S2 发送了更新，

1848
01:03:42,470 --> 01:03:44,150
0,210 210,690 690,930 930,1470 1470,1680
have sent the updates,| {S3
|S3 还没有见过，到 S3 ，

1849
01:03:44,180 --> 01:03:45,200
0,120 120,300 300,510 510,750 750,1020
-} have not seen yet,

1850
01:03:45,200 --> 01:03:46,640
0,150 150,300 300,480 480,960 1170,1440
{you,know} to {S2 -} to

1851
01:03:46,640 --> 01:03:48,140
0,480 600,930 930,1050 1050,1230 1230,1500
S3,| then from then on
|然后从那时起，正常的链式复制，

1852
01:03:48,140 --> 01:03:50,120
0,300 300,780 780,1020 1020,1590 1590,1980
the normal chain replication,| whenever
|每当 S2 收到请求时，

1853
01:03:50,120 --> 01:03:51,620
0,150 150,360 360,600 600,1020 1020,1500
{S2 -} gets a request,|
|

1854
01:03:51,620 --> 01:03:52,910
0,180 180,540 540,660 660,810 810,1290
{you,know} update from {S1 -},|
来自 S1 的更新，|

1855
01:03:53,090 --> 01:03:54,230
0,360 360,780 780,870 870,990 990,1140
it forwards it to {S3
它将它推给 S3 。

1856
01:03:54,230 --> 01:03:55,060
0,360
-}.|
|

1857
01:03:57,400 --> 01:03:58,600
0,330 330,480 480,690 690,900 900,1200
Right, but {S3 -} can
是的，但是 S3 可以成为尾部

1858
01:03:58,600 --> 01:03:59,860
0,300 300,390 390,780 780,1170 1170,1260
become the tail| until it
|直到它成功处理了所有更新。

1859
01:03:59,860 --> 01:04:01,660
0,90 90,750 750,1380 1410,1680 1680,1800
is successfully processed all the

1860
01:04:01,660 --> 01:04:03,550
0,450 450,690 690,930 930,1290 1290,1890
updates.| Oh, yeah so, {}
|哦，是的，所以，一旦它建立了 TCP 通道，

1861
01:04:03,580 --> 01:04:05,140
0,690 690,1170 1170,1260 1260,1440 1440,1560
yeah, once it sets up

1862
01:04:05,140 --> 01:04:06,610
0,60 60,480 480,840 840,1290 1290,1470
the TCP channel,| basically {S2
|S2 可以说，

1863
01:04:06,610 --> 01:04:07,810
0,210 210,420 420,570 570,750 750,1200
-} can just say like

1864
01:04:07,810 --> 01:04:09,370
0,330 510,780 780,960 960,1350 1350,1560
for,| once you've processed these
|一旦你处理完这些，

1865
01:04:09,370 --> 01:04:10,930
0,540 570,780 780,900 900,1140 1140,1560
guys,| you can become {the,tail},|
|你可以成为尾部，|

1866
01:04:10,930 --> 01:04:12,430
0,210 210,390 390,600 600,1020 1380,1500
because you've seen everything.| I
因为你看过所有东西。|我是说。

1867
01:04:12,430 --> 01:04:13,780
0,420 420,630 630,870 870,1230 1230,1350
mean.| And everything else you
|后面的所有东西都可以按顺序排序，

1868
01:04:13,780 --> 01:04:15,190
0,180 180,510 540,840 840,1080 1080,1410
can be {pipelined -} after

1869
01:04:15,190 --> 01:04:16,300
0,270 300,570 570,660 660,750 750,1110
that, right,| in the same
|在同一个 TCP 通道中。

1870
01:04:16,300 --> 01:04:17,580
0,390 390,870
TCP channel.|
|

1871
01:04:19,040 --> 01:04:20,720
0,510 510,720 720,1080 1080,1200 1200,1680
It could become the tail,
它可以变成尾部，

1872
01:04:20,720 --> 01:04:22,460
0,450 480,840 840,1290 1320,1500 1500,1740
right, right after,| like even
|甚至在处理更新之前，

1873
01:04:22,460 --> 01:04:23,870
0,330 330,450 450,810 810,930 930,1410
before it processes the update,|
|

1874
01:04:23,870 --> 01:04:24,770
0,360 360,540 540,720 720,840 840,900
{} as long as it
只要它不服务于请求。

1875
01:04:24,770 --> 01:04:26,990
0,270 270,600 600,1410 1890,2100 2100,2220
doesn't serve requests.| As long
|只要它不服务请求，是的，

1876
01:04:26,990 --> 01:04:27,950
0,60 60,120 120,330 330,540 540,960
as it doesn't serve requests

1877
01:04:27,950 --> 01:04:29,030
0,450 450,720 720,780 780,930 930,1080
exactly, right,| it just has
|它只需要处理所有更新，

1878
01:04:29,030 --> 01:04:30,110
0,90 90,420 420,570 570,660 660,1080
to process all the updates,|
|

1879
01:04:30,110 --> 01:04:31,220
0,180 180,300 300,450 450,600 600,1110
that {S2 -} is received
S2 收到的 S3 没有，

1880
01:04:31,220 --> 01:04:32,930
0,150 150,300 300,780 1170,1590 1590,1710
{S3 -} not,| once we
|一旦我们更新了这些，

1881
01:04:32,930 --> 01:04:35,690
0,360 360,750 750,990 990,1050 1050,2760
updated those,| then it becomes
|然后它变成尾部，并开始处理请求。

1882
01:04:35,690 --> 01:04:37,640
0,210 210,480 480,900 900,1590
{tail,and} start processing request.|
|

1883
01:04:38,780 --> 01:04:40,280
0,150 150,390 390,600 600,1200 1230,1500
I see, so blocks like
我明白了，所以暂时阻塞请求，

1884
01:04:40,280 --> 01:04:41,990
0,600 600,870 870,960 960,1320 1320,1710
requests for a moment,| while
|当它处理新的更新时。

1885
01:04:41,990 --> 01:04:45,300
0,180 180,630 660,1080 1080,1560
it processes new update.|
|

1886
01:04:48,820 --> 01:04:49,960
0,600
Okay?|
好的?|

1887
01:04:52,900 --> 01:04:54,940
0,420 420,540 540,1170 1200,1800 1800,2040
Okay, so now I wanna
好了，现在我想回来了，

1888
01:04:54,940 --> 01:04:56,050
0,90 90,540 540,630 630,870 870,1110
come back,| you know to
|你知道，基本上，很多人会问，

1889
01:04:56,050 --> 01:04:57,760
0,660 660,990 990,1410 1410,1470 1470,1710
basically questions, lots of people

1890
01:04:57,760 --> 01:04:59,590
0,330 330,630 630,810 810,1320 1320,1830
ask,| how this contrast to
|与此形成对比的是，

1891
01:04:59,710 --> 01:05:01,990
0,300 300,630 1560,1860 1860,2070 2070,2280
sort of,| how our {CR
|我们的CR属性如何链接复制属性、

1892
01:05:01,990 --> 01:05:04,660
0,240 240,960 1320,1740 1740,2190 2190,2670
-} properties chain replication properties,|
|

1893
01:05:04,810 --> 01:05:05,680
0,240 240,510 510,660 660,810 810,870
how do how does it
它是如何比较的，

1894
01:05:05,680 --> 01:05:07,040
0,690
compare,|
|

1895
01:05:07,700 --> 01:05:08,450
0,180 180,420 420,480 480,570 570,750
and one of the good
其中一个好的，一个好的属性

1896
01:05:08,450 --> 01:05:09,200
0,240 240,420 420,480 480,570 570,750
{}, one of the good

1897
01:05:09,200 --> 01:05:11,720
0,570 570,960 1020,1770 1770,2010 2010,2520
properties| and mostly with respectful
|与木筏相比，更多的是带着敬意。

1898
01:05:11,720 --> 01:05:14,780
0,90 90,660 660,840 840,1710
in comparison to raft.|
|

1899
01:05:15,320 --> 01:05:16,580
0,120 120,180 180,510 510,990 1020,1260
And of course I got
当然，我得说，

1900
01:05:16,580 --> 01:05:17,510
0,60 60,330 330,420 420,690 690,930
to say,| of course like
|当然，就像链复制只影响主备份方案一样，

1901
01:05:17,510 --> 01:05:20,780
0,390 930,1920 1920,2160 2160,2940 2940,3270
{} the chain replication just

1902
01:05:20,780 --> 01:05:22,520
0,480 480,810 840,1170 1170,1500 1500,1740
influence the primary backup scheme,|
|

1903
01:05:22,520 --> 01:05:24,350
0,120 120,570 660,720 720,1230 1230,1830
but not the configuration servers,|
而不是配置服务器，|

1904
01:05:24,470 --> 01:05:25,250
0,210 210,330 330,450 450,690 690,780
so we'll come back to
所以我们会更详细地谈到这一点，

1905
01:05:25,250 --> 01:05:25,880
0,180 180,240 240,390 390,510 510,630
that a little bit more

1906
01:05:25,880 --> 01:05:26,690
0,60 60,390 390,510 510,570 570,810
in detail,| but a couple
|但有几件事我们可以知道，

1907
01:05:26,690 --> 01:05:27,470
0,210 210,330 330,420 420,540 540,780
things that we can know,|
|

1908
01:05:27,470 --> 01:05:29,900
0,60 1110,1500 1500,1680 1680,2070 2070,2430
if we just compare sort
如果我们只比较RAFT协议和链复制协议的工作方式。

1909
01:05:30,260 --> 01:05:32,390
0,630 660,1350 1350,1470 1470,1740 1740,2130
of {the,way} the raft protocol

1910
01:05:32,390 --> 01:05:34,400
0,330 330,720 720,1140 1140,1500 1500,2010
works with the chain replication

1911
01:05:34,400 --> 01:05:35,260
0,510
protocol.|
|

1912
01:05:35,480 --> 01:05:36,530
0,450 450,630 630,690 690,960 960,1050
And first of all you
首先，你知道我们可以实现积极的一面，

1913
01:05:36,530 --> 01:05:37,430
0,180 180,240 240,360 360,570 570,900
know we can achieve a

1914
01:05:37,430 --> 01:05:38,960
0,420 420,870 870,1110 1110,1320 1320,1530
positive aspect,| that's gonna chain
|这将链式复制，即客户端RPC在头部和尾部之间拆分。

1915
01:05:38,960 --> 01:05:42,380
0,540 540,690 690,1050 1140,1950
replication is that {the,client}

1916
01:05:42,410 --> 01:05:44,120
0,180 180,960
{RPCs -}

1917
01:05:46,820 --> 01:05:48,680
0,420 420,540 540,900 900,1260 1260,1860
are in {} split between

1918
01:05:51,520 --> 01:05:52,150
0,210 210,300 300,450 450,540 540,630
to the head and the

1919
01:05:52,150 --> 01:05:54,040
0,660
tail.|
|

1920
01:05:56,600 --> 01:05:58,040
0,210 210,330 330,780 780,930 930,1440
That's a load of actually
这实际上是为任何客户端操作提供服务的负担

1921
01:05:58,040 --> 01:05:59,720
0,480 480,900 900,1290 1290,1380 1380,1680
{} serving any {} client

1922
01:05:59,720 --> 01:06:00,920
0,480 480,660 660,810 810,900 900,1200
operation| that can be split
|实际上可以在其中两个人之间平分，

1923
01:06:00,920 --> 01:06:02,120
0,240 240,600 600,720 720,810 810,1200
actually between two of them,|
|

1924
01:06:02,210 --> 01:06:03,380
0,240 240,480 480,600 600,720 750,1170
they don't have to run
他们不必像在木筏上那样穿过领头羊。

1925
01:06:03,380 --> 01:06:04,490
0,180 180,270 270,690 690,840 840,1110
through the leader as in

1926
01:06:04,490 --> 01:06:05,900
0,240 240,390 390,930
{} in raft.|
|

1927
01:06:06,410 --> 01:06:07,720
0,570
Furthermore,
此外，头部发送更新一次，

1928
01:06:07,750 --> 01:06:09,910
0,210 210,480 480,1140 1440,1560 1560,2160
the head sends the update

1929
01:06:11,400 --> 01:06:14,070
0,660 1200,1410 1410,1830 1830,2010 2010,2670
once,| so unlike in raft,
|所以不同于RAFT，在RAFT中，负责人或领导者基本上会发送更新，

1930
01:06:14,460 --> 01:06:16,710
0,300 300,1050 1140,1440 1440,1890 1920,2250
{} where the head or

1931
01:06:16,710 --> 01:06:18,510
0,210 210,660 660,1020 1020,1260 1260,1800
the leader basically sends updates,|
|

1932
01:06:18,510 --> 01:06:20,550
0,420 450,870 870,1170 1170,1530 1530,2040
{} {the,log} entry to every
向每个出现的日志条目，

1933
01:06:20,550 --> 01:06:22,230
0,690 780,1110 1110,1200 1200,1350 1350,1680
appear,| {} in this particular
|在这个特定的方案中，实际上只是头部总是发送一个基本上是RPC的。

1934
01:06:22,230 --> 01:06:23,790
0,450 450,810 810,900 900,1110 1110,1560
scheme actually it's only happened

1935
01:06:23,790 --> 01:06:25,860
0,540 630,1170 1170,1440 1440,1620 1620,2070
the head always sends one

1936
01:06:26,040 --> 01:06:28,320
0,720 750,1200 1200,1350 1350,1830
{} basically {RPC -}.|
|

1937
01:06:28,580 --> 01:06:29,510
0,180 180,300 300,420 420,630 630,930
And so there are fewer
因此涉及的信息更少，

1938
01:06:29,510 --> 01:06:34,040
0,390 390,960 1710,2370 2880,3750 3780,4530
messages involved,| {} reads or
|读取或创建操作只涉及，只涉及尾部，

1939
01:06:34,070 --> 01:06:35,820
0,390 390,1140
create operations

1940
01:06:36,630 --> 01:06:38,680
0,510 510,1200
involve only,

1941
01:06:40,780 --> 01:06:42,920
0,360 360,870 900,1380
only the tail,|
|

1942
01:06:43,160 --> 01:06:44,510
0,120 120,540 540,720 720,810 810,1350
{unlike -} in the raft,|
与木筏不同的是，|

1943
01:06:44,510 --> 01:06:46,160
0,90 90,240 240,990 1260,1410 1410,1650
you know the if you
你知道，如果你实现了只读优化，

1944
01:06:46,160 --> 01:06:47,480
0,270 270,390 390,480 480,960 960,1320
even if you implement the

1945
01:06:47,480 --> 01:06:50,000
0,210 210,540 540,1470 1650,2340 2370,2520
read only optimization,| the read
|只读优化避免了读操作遍历日志

1946
01:06:50,000 --> 01:06:53,180
0,240 240,870 1410,2490 2520,2910 2910,3180
only optimization avoid having read

1947
01:06:53,180 --> 01:06:55,070
0,480 480,690 690,1020 1020,1230 1230,1890
operation go through the log|
|

1948
01:06:55,220 --> 01:06:56,870
0,810 810,990 990,1410 1410,1530 1530,1650
and being appended to all
并被附加到所有日志中，

1949
01:06:56,870 --> 01:06:58,130
0,60 60,270 270,390 390,870 1050,1260
the logs {} appears,| but
|但这仍然需要领导者真正与大多数同行联系

1950
01:06:58,130 --> 01:06:59,660
0,60 60,330 330,900 900,1080 1080,1530
it still requires that the

1951
01:06:59,810 --> 01:07:01,670
0,750 750,1110 1110,1320 1320,1800 1800,1860
leader actually {} contact the

1952
01:07:01,670 --> 01:07:03,200
0,600 600,690 690,780 780,1290 1350,1530
majority of the peers| to
|来决定什么时候才是真正的手术。

1953
01:07:03,200 --> 01:07:05,960
0,630 750,1020 1020,1140 1140,1680 1680,2760
decide when it's actually a

1954
01:07:05,960 --> 01:07:08,500
0,1050 1050,1200 1200,1620 1650,2220
operation can be served.|
|

1955
01:07:09,820 --> 01:07:12,910
0,630 1140,1470 1470,1980 1980,2520 2520,3090
{} So, another positive aspect
因此，这方面的另一个积极方面是我们所说的简单的崩溃恢复，

1956
01:07:12,910 --> 01:07:13,780
0,60 60,180 180,540 540,690 690,870
of this [] is a

1957
01:07:13,780 --> 01:07:15,070
0,300 300,570 570,1050 1050,1170 1170,1290
simple crash recovery as we

1958
01:07:15,070 --> 01:07:17,880
0,210 210,660
talked about,|
|

1959
01:07:23,620 --> 01:07:25,090
0,600 630,900 900,1020 1020,1170 1170,1470
{} but you know a
但你知道，与筏子计划相比，它的一个主要缺点是

1960
01:07:25,090 --> 01:07:27,220
0,270 270,900 1050,1620 1620,1950 1950,2130
major downside compared to sort

1961
01:07:27,220 --> 01:07:28,510
0,60 60,150 150,390 390,930 960,1290
of the raft scheme| is
|你有一次故障需要重新配置。

1962
01:07:28,510 --> 01:07:31,090
0,480 480,630 630,750 750,1290 1830,2580
that you have one failure

1963
01:07:34,450 --> 01:07:36,380
0,540 540,660 660,1440
requires {reconfiguration -}.|
|

1964
01:07:44,720 --> 01:07:46,190
0,330 330,390 390,930 960,1290 1290,1470
And the reason now that
现在需要重新配置的原因是

1965
01:07:46,190 --> 01:07:48,230
0,210 210,1110 1110,1470 1470,1920 1920,2040
the reconfiguration are required is|
|

1966
01:07:48,230 --> 01:07:50,540
0,330 330,630 660,1440 1710,2070 2070,2310
because like write actually have
因为就像写一样，实际上必须贯穿整个链条，

1967
01:07:50,540 --> 01:07:51,320
0,90 90,300 300,480 480,570 570,780
to go through the whole

1968
01:07:51,320 --> 01:07:52,280
0,420
chain,|
|

1969
01:07:52,340 --> 01:07:53,720
0,240 240,780 870,1110 1110,1260 1260,1380
and so, {} and the
因此，在链中的每台服务器实际都有进程之前，写操作无法确认。

1970
01:07:53,720 --> 01:07:55,220
0,210 210,540 540,1020 1020,1350 1350,1500
write cannot acknowledge until that

1971
01:07:55,220 --> 01:07:57,170
0,570 780,1290 1290,1470 1470,1620 1620,1950
every server in the chain

1972
01:07:57,170 --> 01:07:58,760
0,240 240,420 420,1080
actually has processes.|
|

1973
01:07:58,880 --> 01:07:59,810
0,120 120,240 240,360 360,570 570,930
And that is actually slightly
这实际上略有不同，对吧，

1974
01:07:59,810 --> 01:08:01,010
0,330 330,630 630,990 990,1080 1080,1200
different, correct,| raft as you
|如你所知，木筏，

1975
01:08:01,010 --> 01:08:02,870
0,180 180,630 780,1260 1260,1740 1740,1860
well know,| because assume it's
|因为假设基本上是多数，对等体实际上独立于它们的日志接受特定的写操作，

1976
01:08:02,870 --> 01:08:05,210
0,570 570,900 900,1740 1740,2010 2010,2340
basically {} majority, the peers

1977
01:08:05,210 --> 01:08:06,890
0,300 300,900 900,990 990,1440 1440,1680
actually accepted the particular write

1978
01:08:06,890 --> 01:08:08,750
0,450 450,900 900,990 990,1230 1230,1860
operation independent to their logs,|
|

1979
01:08:08,750 --> 01:08:10,040
0,120 120,420 420,540 540,720 720,1290
the system can just proceed,|
系统就可以继续运行，|

1980
01:08:10,640 --> 01:08:11,990
0,150 150,270 270,480 480,750 750,1350
and so there's actually no
所以实际上根本没有中断，

1981
01:08:11,990 --> 01:08:13,700
0,540 540,660 660,1020 1020,1290 1290,1710
interruption at all,| if one
|如果一台服务器出现故障，

1982
01:08:13,700 --> 01:08:15,640
0,330 330,750 750,900 900,1350
server fails,| for example,
|例如，如果剩余的服务器仍然构成多数，

1983
01:08:16,120 --> 01:08:17,380
0,180 180,480 480,780 780,1050 1050,1260
if the remaining servers still

1984
01:08:17,380 --> 01:08:19,480
0,240 240,300 300,840 1200,1860 1860,2100
form a majority,| while {in,chain}
|而在链复制中，

1985
01:08:19,480 --> 01:08:21,580
0,690 780,1200 1200,1530 1530,1920 1920,2100
replication,| if one server would
|如果一台服务器发生故障，

1986
01:08:21,580 --> 01:08:23,170
0,570 630,1020 1020,1110 1110,1260 1260,1590
fail,| then you know somebody's
|那么你就知道某人的重新配置实际上是必须发生的

1987
01:08:23,170 --> 01:08:24,490
0,510 510,750 750,960 960,1020 1020,1320
reconfiguration actually has to happen|
|

1988
01:08:24,490 --> 01:08:25,840
0,210 210,570 570,1050 1050,1200 1200,1350
which means there's gonna be
这意味着可能会有一段很短的停机时间，对吧。

1989
01:08:25,840 --> 01:08:27,910
0,60 60,390 390,870 930,1500 1500,2070
a short period probably downtime,

1990
01:08:28,490 --> 01:08:29,540
0,510
right.|
|

1991
01:08:29,540 --> 01:08:30,900
0,90 90,180 180,330 330,720
Does that make sense?|
这说得通吗？|

1992
01:08:35,010 --> 01:08:36,150
0,600 720,870 870,990 990,1050 1050,1140
Now I want to make
现在我想再提出一点

1993
01:08:36,150 --> 01:08:37,920
0,240 240,450 450,900 900,1230 1230,1770
one more point| {sort,of} in
|相比之下，你知道的木筏复制方案是这样的，

1994
01:08:37,950 --> 01:08:39,210
0,720 720,780 780,900 900,1080 1080,1260
contrast you know to sort

1995
01:08:39,210 --> 01:08:41,160
0,90 90,660 690,1050 1050,1500 1500,1950
of the raft replication scheme

1996
01:08:41,370 --> 01:08:43,260
0,390 390,930 1230,1620 1620,1710 1710,1890
is this,| because the read
|因为读取操作仅涉及一个服务器，

1997
01:08:43,260 --> 01:08:45,150
0,510 510,1020 1020,1260 1260,1410 1410,1890
operations involve only one server,|
|

1998
01:08:45,150 --> 01:08:47,800
0,270 270,420 420,1140 1170,2040
there's a cool {}
有一个很酷的扩展，

1999
01:08:47,800 --> 01:08:49,180
0,600 600,720 720,840 840,1200 1200,1380
extension,| if you will that
|如果您愿意，它实际上会获得非常高的读取性能，

2000
01:08:49,180 --> 01:08:50,260
0,210 210,450 450,660 660,870 870,1080
actually gets really high read

2001
01:08:50,260 --> 01:08:52,360
0,720 900,1230 1230,1650 1710,1860 1860,2100
performance,| and so the basic
|所以基本思想是这样的，

2002
01:08:52,360 --> 01:08:53,920
0,270 270,360 360,450 450,1110
idea is as follows,|
|

2003
01:08:55,710 --> 01:08:56,940
0,660

2004
01:09:10,550 --> 01:09:12,320
0,480 480,600 600,870 870,1410 1410,1770
{} the basic {idea,is} basically
基本的想法基本上是将

2005
01:09:12,320 --> 01:09:13,970
0,90 90,720 750,900 900,1080 1080,1650
to split| you know the
|你知道分裂的物体，或者他们在纸上叫体积，

2006
01:09:14,560 --> 01:09:16,180
0,300 300,810 810,1170 1200,1320 1320,1620
split objects or they call

2007
01:09:16,180 --> 01:09:17,950
0,480 480,600 600,780 780,1290 1320,1770
volumes in the paper,| split
|将对象拆分到多个链中。

2008
01:09:17,950 --> 01:09:19,500
0,180 180,780
the objects

2009
01:09:19,500 --> 01:09:21,520
0,510 510,900 900,1500
across multiple chains.|
|

2010
01:09:27,360 --> 01:09:28,350
0,180 180,450 450,510 510,780 780,990
So instead of having one
因此，不是像我在以前的板上做的那样只有一个链条，

2011
01:09:28,350 --> 01:09:29,490
0,300 300,450 450,840 840,1080 1080,1140
chain that I've done in

2012
01:09:29,490 --> 01:09:31,140
0,90 90,660 660,1290 1290,1530 1530,1650
the previous boards,| we're going
|我们将有多条连锁店

2013
01:09:31,140 --> 01:09:32,640
0,60 60,210 210,600 600,1110 1290,1500
to have multiple chains| and
|例如，我们可能在链1中有CH1，

2014
01:09:32,640 --> 01:09:33,630
0,120 120,180 180,660 660,780 780,990
so for example we might

2015
01:09:33,630 --> 01:09:35,340
0,180 180,690 720,990 990,1170 1170,1710
have {} {CH1 - -}

2016
01:09:36,180 --> 01:09:38,130
0,420 420,570 570,870 870,1380 1560,1950
{} in chain one,| {S1
|S1是头部，S2是中间人，S3是尾巴。

2017
01:09:38,130 --> 01:09:40,320
0,600 1080,1260 1260,1710 1710,1890 1890,2190
-} is {the,head}, {S2,is -}

2018
01:09:40,320 --> 01:09:41,880
0,390 420,690 690,1080 1080,1410 1410,1560
the middle guy {and,S3 -

2019
01:09:41,880 --> 01:09:43,200
0,270 270,360 360,720
-} {is,the} tail.|
|

2020
01:09:43,260 --> 01:09:45,560
0,240 240,600 600,1140
And chain two,
第二个链条，你知道我们要旋转物体，

2021
01:09:45,830 --> 01:09:47,060
0,210 210,390 390,510 510,780 780,1230
{you,know} we're going to rotate

2022
01:09:47,060 --> 01:09:48,440
0,180 180,660 720,990 990,1260 1260,1380
things around,| {S2 -} as
|S2是头部，S3是中间人，

2023
01:09:48,440 --> 01:09:49,970
0,90 90,480 540,900 900,1350 1350,1530
the head, {S3 -} is

2024
01:09:49,970 --> 01:09:53,060
0,1230 1230,1470 1470,1950 1980,2370 2910,3090
the middle guy,| oops, {S3,is
|哎呀，S3是中间人，S1是尾巴。

2025
01:09:53,060 --> 01:09:55,220
0,240 240,300 300,480 480,1020 1200,2160
-} the middle guy and

2026
01:09:55,400 --> 01:09:57,420
0,240 240,810 840,990 990,1560
{S1 -} is {the,tail}.|
|

2027
01:09:57,630 --> 01:10:00,300
0,300 300,720 720,1200 2370,2550 2550,2670
And chain 3, we're going
而第三链，我们基本上会安排S3作为领头羊，

2028
01:10:00,300 --> 01:10:01,530
0,60 60,390 390,660 660,1080 1080,1230
to arrange {} basically {S3

2029
01:10:01,530 --> 01:10:02,550
0,210 210,330 330,390 390,600 600,1020
-} as the head guy,|
|

2030
01:10:02,550 --> 01:10:05,430
0,270 270,570 570,1020 1470,2310 2430,2880
{S2 -} as, {} oops
S2作为，哎呀，S1是中间人，S2是尾巴。

2031
01:10:05,460 --> 01:10:06,870
0,210 210,720 720,780 780,990 990,1410
{S1 -} the middle guy

2032
01:10:06,870 --> 01:10:08,280
0,120 120,270 270,750 1140,1320 1320,1410
and {S2 -} is the

2033
01:10:08,280 --> 01:10:09,220
0,480
tail.|
|

2034
01:10:09,710 --> 01:10:10,730
0,450 450,630 630,750 750,900 900,1020
Basically we're gonna do is|
基本上我们要做的是|

2035
01:10:10,730 --> 01:10:12,560
0,90 90,210 210,270 270,750 960,1830
we're going to split objects
我们将把物体分成多个链条，

2036
01:10:12,560 --> 01:10:13,910
0,330 330,480 480,810 810,1170 1170,1350
across these multiple chains,| so
|所以配置服务器基本上有一个地图，

2037
01:10:13,910 --> 01:10:15,380
0,90 90,660 660,1050 1050,1350 1350,1470
the configuration server basically has

2038
01:10:15,380 --> 01:10:16,490
0,60 60,600 600,720 720,840 840,1110
a map,| you know saying
|你知道，说放下碎片一，你知道碎片一中的物体去链一，

2039
01:10:16,490 --> 01:10:18,200
0,240 240,600 660,1200 1200,1650 1650,1710
let go shard one you

2040
01:10:18,200 --> 01:10:19,550
0,120 120,570 570,690 690,1050 1050,1350
know objects {in,shard} one {go,to}

2041
01:10:19,550 --> 01:10:22,790
0,270 270,750 990,2640 2640,2910 2910,3240
chain one,| object shard two
|对象碎片2转到链2，

2042
01:10:22,790 --> 01:10:24,260
0,150 150,270 270,570 570,1020 1020,1470
go to chain two,| objects
|碎片三的对象现在转到链三。

2043
01:10:24,260 --> 01:10:25,400
0,270 270,600 600,780 780,960 960,1140
shard three now go to

2044
01:10:25,400 --> 01:10:26,380
0,240 240,510
chain three.|
|

2045
01:10:27,140 --> 01:10:28,100
0,300 300,510 510,750 750,870 870,960
{} And what is the
它最酷的地方是，

2046
01:10:28,100 --> 01:10:29,180
0,210 210,450 450,720 720,840 840,1080
cool part about it is

2047
01:10:29,180 --> 01:10:31,310
0,420 690,1380 1380,1560 1560,1950 1980,2130
that,| {} you know, we
|你知道，我们有很多条尾巴

2048
01:10:31,310 --> 01:10:33,470
0,210 210,570 570,1230 1620,1980 1980,2160
have multiple tails| and as
|以及一些链条的三条尾巴，

2049
01:10:33,470 --> 01:10:35,030
0,180 180,390 390,1110 1140,1320 1320,1560
well as {three,tail} for some

2050
01:10:35,030 --> 01:10:36,290
0,570 600,750 750,990 990,1110 1110,1260
chain,| {S1 -} is it's
|S1是不是对某些链条来说是个故事

2051
01:10:36,290 --> 01:10:38,600
0,870 870,1140 1140,1260 1260,1830 1830,2310
a tale for some chain,|
|

2052
01:10:38,690 --> 01:10:39,740
0,330 330,570 570,690 690,750 750,1050
{S2 -} is a tail
S2是某条链的尾巴

2053
01:10:39,740 --> 01:10:41,600
0,180 180,420 420,780 1290,1470 1470,1860
for some chain| and basically
|基本上，读取操作会产生不同的链

2054
01:10:41,600 --> 01:10:43,670
0,240 240,810 810,1110 1110,1440 1440,2070
read operations produce different chain|
|

2055
01:10:43,790 --> 01:10:45,680
0,720 720,840 840,960 960,1380 1380,1890
can now be completely executed
现在可以完全并行执行，

2056
01:10:45,680 --> 01:10:47,480
0,90 90,660 720,1170 1260,1680 1680,1800
in parallel,| so if the
|因此，如果读取操作命中所有不同的碎片，

2057
01:10:47,480 --> 01:10:48,920
0,210 210,810 810,1140 1140,1350 1350,1440
read operations hit all the

2058
01:10:48,920 --> 01:10:50,840
0,300 300,990 1200,1500 1500,1710 1710,1920
different shards,| {} sort of
|一种均匀的铺展，

2059
01:10:50,840 --> 01:10:52,610
0,450 450,900 900,1350 1350,1410 1410,1770
uniform spread,| basically you know
|基本上，您知道我们的读取吞吐量将随着我们拥有的尾部数量线性增加

2060
01:10:52,610 --> 01:10:53,900
0,150 150,780 780,1020 1020,1200 1200,1290
our {read,throughput} is going to

2061
01:10:53,900 --> 01:10:55,820
0,630 630,1290 1290,1440 1440,1530 1530,1920
increase linearly with the number

2062
01:10:55,820 --> 01:10:56,990
0,210 210,570 570,900 900,1050 1050,1170
of {} tails that we

2063
01:10:56,990 --> 01:10:57,860
0,240 270,450 450,510 510,660 660,870
have| and in this case,
|在这种情况下，我们有三条尾巴，

2064
01:10:57,860 --> 01:10:58,790
0,120 120,270 270,720 720,810 810,930
we have {three,tails},| so we
|所以我们有三次阅读表演的机会。

2065
01:10:58,790 --> 01:10:59,570
0,150 150,300 300,540 540,630 630,780
get three times to read

2066
01:10:59,570 --> 01:11:00,420
0,660
performance.|
|

2067
01:11:01,260 --> 01:11:02,010
0,150 150,240 240,360 360,690 690,750
So we did basically the
所以我们基本上做了同样的事情，

2068
01:11:02,010 --> 01:11:03,420
0,570 570,840 840,1230 1230,1350 1350,1410
same,| so we get a
|所以我们得到了动物园饲养员拥有的一些相同的属性，

2069
01:11:03,420 --> 01:11:04,110
0,150 150,270 270,360 360,450 450,690
little bit of the same

2070
01:11:04,110 --> 01:11:05,460
0,450 450,570 570,750 750,1050 1050,1350
properties the {zookeeper -} had,|
|

2071
01:11:05,730 --> 01:11:07,140
0,630 630,720 720,930 930,1290 1290,1410
where the read performance can
在读取性能可以是优秀的情况下，

2072
01:11:07,140 --> 01:11:08,760
0,90 90,540 930,1410 1410,1530 1530,1620
be excellent,| scale with the
|随着服务器数量的增加而扩展，

2073
01:11:08,760 --> 01:11:10,770
0,210 210,270 270,870 1230,1890 1890,2010
number of servers,| but we
|但我们得到的不仅是这些，

2074
01:11:10,770 --> 01:11:12,090
0,300 300,540 540,750 750,960 960,1320
also get not only that,|
|

2075
01:11:12,090 --> 01:11:13,470
0,90 90,300 300,420 420,780 780,1380
we get the scale part,|
我们得到了比例部分，|

2076
01:11:13,980 --> 01:11:15,360
0,210 210,330 330,1050 1050,1140 1140,1380
but we maintain the {linearizability
但我们保持了线性化，

2077
01:11:15,360 --> 01:11:18,750
0,150 150,630 2520,2730 2730,2880 2880,3390
- -},| in this scheme,
|在这个方案中，我们实际上不必放弃线性化。

2078
01:11:18,750 --> 01:11:19,500
0,150 150,330 330,450 450,540 540,750
we don't have to actually

2079
01:11:19,500 --> 01:11:20,790
0,180 180,420 420,570 570,810 810,1290
give up on {linearizability -}.|
|

2080
01:11:22,580 --> 01:11:24,500
0,570 600,810 810,870 870,990 990,1920
So when we get to
所以当我们找到两处不错的房子时，

2081
01:11:24,680 --> 01:11:26,840
0,390 390,690 690,1350 1350,1860 1860,2160
two nice properties,| namely good
|即良好的读取性能和随服务器数量的有效扩展，

2082
01:11:26,840 --> 01:11:28,310
0,150 150,720 720,840 840,1140 1140,1470
read performance and effective scaling

2083
01:11:28,310 --> 01:11:29,330
0,120 120,210 210,390 390,450 450,1020
with the number of servers,|
|

2084
01:11:29,720 --> 01:11:30,710
0,360 360,570 570,750 750,900 900,990
at least for each of
至少对于两个不同链中的每一个，

2085
01:11:30,710 --> 01:11:32,660
0,120 120,540 540,690 690,1380 1440,1950
two different {} chains, {}|
|

2086
01:11:32,660 --> 01:11:34,280
0,510 510,690 690,900 900,1080 1080,1620
and {} we got actually
我们实际上得到了，并且我们保持了线性化。

2087
01:11:34,280 --> 01:11:35,600
0,480 480,600 600,960 960,1200 1200,1320
and we maintain {linearizability -

2088
01:11:35,600 --> 01:11:36,480
0,390
-}.|
|

2089
01:11:43,420 --> 01:11:44,960
0,180 180,480 480,630 630,1020
Any questions about this?|
对此有什么问题吗？|

2090
01:11:49,540 --> 01:11:50,410
0,300 300,390 390,510 510,810 810,870
Sorry, in this case,| the
抱歉，在这种情况下，|客户端在决定从哪个链进行读取时，

2091
01:11:50,410 --> 01:11:52,870
0,720 750,1050 1050,1320 1320,1680 1680,2460
client when they are deciding

2092
01:11:53,080 --> 01:11:55,840
0,870 1380,1920 1920,2040 2040,2280 2280,2760
which chain to read from,|
|

2093
01:11:56,260 --> 01:11:57,850
0,480 480,630 630,750 750,960 960,1590
would they be able to,
他们能够，愿意自己决定吗？

2094
01:11:58,900 --> 01:12:00,040
0,150 150,420 420,630 630,750 750,1140
to do like to decide

2095
01:12:00,040 --> 01:12:01,210
0,540 540,630 630,810 810,930 930,1170
themselves| or do they need
|或者他们是否需要联系配置服务器来决定。

2096
01:12:01,210 --> 01:12:04,030
0,180 180,750 750,1110 1620,2430 2430,2820
to contact the configuration server

2097
01:12:04,030 --> 01:12:06,100
0,120 120,780 1110,1440 1440,1620 1620,2070
to decide.| Yeah, so {this,is}
|是的，所以这是一个很好的问题，

2098
01:12:06,100 --> 01:12:07,240
0,30 30,210 210,660 660,990 990,1140
a great question,| {} so
|所以通常情况下，这篇论文并没有真正明确地说明这一点，

2099
01:12:07,240 --> 01:12:08,920
0,720 720,1020 1020,1110 1110,1350 1350,1680
typically and the paper actually

2100
01:12:08,920 --> 01:12:10,480
0,270 270,600 600,1110 1110,1380 1380,1560
doesn't really explicit about it,|
|

2101
01:12:10,480 --> 01:12:11,650
0,90 90,150 150,540 570,930 930,1170
you know they talk about
你知道，他们谈到也许可以通过代理与服务器交谈，

2102
01:12:11,650 --> 01:12:13,840
0,270 270,630 630,900 900,1470 1650,2190
maybe talking through proxy to

2103
01:12:13,870 --> 01:12:15,580
0,450 450,870 870,1020 1290,1530 1530,1710
{} {servers -},| {} what
|您在实验4中要做的基本上是下载配置，

2104
01:12:15,580 --> 01:12:16,240
0,90 90,180 180,300 300,390 390,660
you will do in lab

2105
01:12:16,240 --> 01:12:17,440
0,480 480,570 570,990 990,1080 1080,1200
4 is basically you will

2106
01:12:17,440 --> 01:12:19,570
0,420 420,510 510,1170 1410,1560 1560,2130
download the configuration,| the configuration
|该配置将包括碎片分配，

2107
01:12:19,570 --> 01:12:21,430
0,120 120,810 810,870 870,1230 1230,1860
will include the shard assignment,|
|

2108
01:12:21,880 --> 01:12:23,650
0,150 150,810 840,1200 1200,1380 1380,1770
{} and {} you download
然后从配置服务器下载。

2109
01:12:23,650 --> 01:12:24,880
0,150 150,270 270,360 360,840 840,1230
that from the configuration server.|
|

2110
01:12:28,820 --> 01:12:29,690
0,180 180,360 360,420 420,510 510,870
You need to be careful
您需要注意如何对每个链中的服务器进行排序，

2111
01:12:29,690 --> 01:12:30,740
0,270 270,450 450,600 600,930 930,1050
about how you order the

2112
01:12:30,740 --> 01:12:31,760
0,570 570,690 690,810 810,900 900,1020
servers in each of the

2113
01:12:31,760 --> 01:12:33,560
0,480 480,810 810,1140 1200,1350 1350,1800
chains,| prevent like a particular
|防止某一特定链条过饱和

2114
01:12:33,560 --> 01:12:35,420
0,270 270,420 420,600 600,1560 1740,1860
chain from being oversaturated| or
|或类似两个服务器之间的特定链路。

2115
01:12:35,420 --> 01:12:36,710
0,60 60,510 510,900 900,1200 1200,1290
{} particular link between like

2116
01:12:36,710 --> 01:12:38,020
0,210 210,840
two servers.|
|

2117
01:12:38,140 --> 01:12:39,910
0,450 450,1080 1080,1320 1320,1530 1530,1770
{} Yeah, this, this, this,
对，这个，这个方案没有真正考虑到这一点，

2118
01:12:39,910 --> 01:12:41,350
0,150 150,750 750,1110 1110,1260 1260,1440
this scheme doesn't really take

2119
01:12:41,350 --> 01:12:42,820
0,210 210,540 540,1140 1140,1290 1290,1470
that into account,| {} you
|您可以想象配置计划或配置管理器拥有网络实际布局的复杂模型

2120
01:12:42,820 --> 01:12:44,440
0,90 90,570 570,990 990,1080 1080,1620
can imagine like the configuration

2121
01:12:44,440 --> 01:12:46,150
0,300 300,810 810,900 900,1380 1380,1710
plan or the configuration manager

2122
01:12:46,150 --> 01:12:47,530
0,150 150,240 240,900 900,1290 1290,1380
has a sophisticated model of

2123
01:12:47,530 --> 01:12:48,970
0,300 300,450 450,540 540,1020 1020,1440
actually how the network is

2124
01:12:48,970 --> 01:12:49,990
0,210 210,540 540,780 780,870 870,1020
laid out| and you know
|你知道的，你可以非常小心地注意链条是如何做的。

2125
01:12:49,990 --> 01:12:50,920
0,120 120,210 210,450 450,750 750,930
can be very careful about

2126
01:12:50,920 --> 01:12:51,970
0,180 180,270 270,630 630,690 690,1050
how the chains are done.|
|

2127
01:12:53,810 --> 01:12:55,340
0,390 390,570 570,900 900,1200 1200,1530
Maybe even shard more shards
甚至可能将更多的碎片分割到一条链上，而将更少的碎片分割到另一条链上，

2128
01:12:55,340 --> 01:12:56,390
0,90 90,300 300,720 720,780 780,1050
to one chain of fewer

2129
01:12:56,390 --> 01:12:58,250
0,390 390,480 480,780 780,1350 1350,1860
shards to another chain,| all
|所有的事情原则上都是可能的，

2130
01:12:58,250 --> 01:12:59,090
0,90 90,300 300,390 390,450 450,840
the stuff is in principle

2131
01:12:59,090 --> 01:13:01,100
0,450 540,930 930,1020 1020,1740 1830,2010
possible,| because the configuration can
|因为配置可以只计算它喜欢的任何东西，

2132
01:13:01,100 --> 01:13:02,600
0,210 210,450 450,600 600,930 1110,1500
just manage to just compute

2133
01:13:02,600 --> 01:13:04,160
0,330 330,420 420,780 780,1140 1170,1560
anything it likes,| in basically
|基本上就是说用作业。

2134
01:13:04,160 --> 01:13:06,000
0,300 360,660 660,750 750,1350
says use the assignment.|
|

2135
01:13:08,220 --> 01:13:09,540
0,210 210,450 810,990 990,1110 1110,1320
Thank you.| {} Can even
谢谢。|如果它想的话，它甚至可以读取天平。

2136
01:13:09,540 --> 01:13:10,620
0,180 180,600 600,750 750,810 810,1080
read balance if it wants

2137
01:13:10,620 --> 01:13:11,420
0,240
to.|
|

2138
01:13:18,560 --> 01:13:19,430
0,120 120,210 210,300 300,630 630,870
{Answer -} the question, could
回答问题，你能再解释一下线性化是如何在这个扩展下保持的吗，

2139
01:13:19,430 --> 01:13:20,690
0,60 60,330 330,570 570,720 720,1260
you explain again how linearizability

2140
01:13:20,690 --> 01:13:22,010
0,120 120,420 420,570 570,870 870,1320
is kept under this {}

2141
01:13:22,010 --> 01:13:23,990
0,540 540,990 1110,1620 1620,1770 1770,1980
extension,| well, nothing has really
|好吧，什么都没有真正改变，

2142
01:13:23,990 --> 01:13:25,850
0,630 660,1230 1230,1410 1410,1650 1650,1860
changed,| {} we're still doing
|我们仍在使用链条进行主要备份，

2143
01:13:25,850 --> 01:13:27,800
0,360 360,1080 1080,1350 1350,1440 1440,1950
primary backup using a chain,|
|

2144
01:13:28,070 --> 01:13:30,890
0,570 570,1380 1410,2310 2310,2550 2550,2820
{} in {} and so
所以你知道，我们基本上是从单链延续了线性化

2145
01:13:30,890 --> 01:13:33,050
0,300 300,900 1110,1440 1440,1770 1770,2160
you know we basically carry

2146
01:13:33,050 --> 01:13:34,850
0,510 510,660 660,1050 1050,1500 1500,1800
over the {linearizability -} from

2147
01:13:34,850 --> 01:13:36,140
0,60 60,390 390,840 870,1110 1110,1290
the single chain| and that's
|就是这样。

2148
01:13:36,140 --> 01:13:36,860
0,300
it.|
|

2149
01:13:42,470 --> 01:13:44,180
0,210 210,480 480,780 780,1020 1020,1710
This might be like speculative,|
这可能像是投机，|

2150
01:13:44,180 --> 01:13:45,830
0,150 150,360 360,690 690,1200 1200,1650
but how this compared to,|
但与此相比，|

2151
01:13:47,020 --> 01:13:48,250
0,150 150,390 390,600 600,750 750,1230
I guess maybe it's equivalent
我想这可能相当于每个Like链接都有一组服务器，

2152
01:13:48,250 --> 01:13:49,420
0,90 90,360 360,780 780,1080 1080,1170
of just having groups of

2153
01:13:49,420 --> 01:13:52,060
0,480 480,630 630,1200 1230,2010 2370,2640
servers for each {like,link},| instead
|而不是重复使用相同的东西，

2154
01:13:52,060 --> 01:13:53,170
0,60 60,330 330,750 750,840 840,1110
of having reusing the same

2155
01:13:53,170 --> 01:13:54,610
0,330 360,780 780,1140 1140,1260 1260,1440
ones,| or not for each
|或者不是针对每个环节，而是针对链中的每一步，

2156
01:13:54,610 --> 01:13:56,440
0,210 210,330 330,450 450,720 720,1830
link, but for each {}

2157
01:13:57,340 --> 01:13:58,450
0,390 390,480 480,600 600,990 990,1110
step in the chain,| so
|因此，就像S1就像三台服务器一样，

2158
01:13:58,450 --> 01:13:59,950
0,180 180,630 630,780 780,1200 1200,1500
like S1 is like three

2159
01:13:59,950 --> 01:14:01,180
0,450 450,630 630,840 840,1020 1020,1230
servers,| {S2 -} as three
|S2作为三台服务器，

2160
01:14:01,180 --> 01:14:03,280
0,570 870,1170 1170,1410 1440,2010 2010,2100
servers,| instead of reusing the
|而不是重复使用相同的

2161
01:14:03,280 --> 01:14:04,840
0,240 240,630 900,1050 1050,1440 1440,1560
same one| and entering from
|从不同的角度进入。

2162
01:14:04,840 --> 01:14:06,160
0,300 300,810
different points.|
|

2163
01:14:06,190 --> 01:14:09,010
0,210 210,1260 1290,2340 2340,2700 2700,2820
{} Yeah yeah, what would
是啊，是啊，你想象的那个计划有什么好处。

2164
01:14:09,010 --> 01:14:10,030
0,120 120,180 180,510 510,600 600,1020
be the advantage of that

2165
01:14:10,090 --> 01:14:11,350
0,480 480,600 600,690 690,1170 1170,1260
scheme that you imagine.| I
|我的意思是，仅仅为了可伸缩性，

2166
01:14:11,350 --> 01:14:14,360
0,150 150,420 420,540 540,1500
mean just for scalability,|
|

2167
01:14:14,860 --> 01:14:16,750
0,240 240,510 510,900 900,1260 1440,1890
while also maintain {} {linearizability
同时还保持了线性化。

2168
01:14:16,750 --> 01:14:18,910
0,570 780,1350 1350,1800 1800,1890 1890,2160
-}.| Well, the the reason
|那么，这个方案之所以有吸引力，是因为，

2169
01:14:18,910 --> 01:14:20,350
0,300 300,390 390,660 660,750 750,1440
that this scheme is attractive

2170
01:14:20,350 --> 01:14:21,640
0,150 150,330 330,720 720,960 960,1290
is that,| {because,we} have {the,tail}
|因为我们的尾巴可能有相当多的负荷，

2171
01:14:21,640 --> 01:14:22,360
0,180 180,330 330,540 540,600 600,720
might have quite a bit

2172
01:14:22,360 --> 01:14:23,050
0,90 90,270 270,390 390,450 450,690
of load,| but the middle
|但中间的那个人不会

2173
01:14:23,050 --> 01:14:25,000
0,210 210,720 750,1440 1440,1650 1650,1950
guy doesn't| {and,you,know} by having
|你知道，通过这样的安排，

2174
01:14:25,000 --> 01:14:26,740
0,210 210,390 390,1110 1230,1470 1470,1740
{sort,of} this arrangement,| we spread
|我们将负载分散到所有服务器上。

2175
01:14:26,740 --> 01:14:28,150
0,90 90,330 330,630 630,780 780,1410
the load across all servers.|
|

2176
01:14:30,910 --> 01:14:32,500
0,210 210,540 540,900
I see, okay.|
我明白了，好的。|

2177
01:14:40,090 --> 01:14:41,300
0,270 270,660
Okay, good.|
好的，很好。|

2178
01:14:41,450 --> 01:14:42,740
0,360 390,810 810,1020 1020,1170 1170,1290
So maybe I want to
所以也许我想在这里总结一下，

2179
01:14:42,740 --> 01:14:45,220
0,540 540,1050
summarize here,|
|

2180
01:14:47,850 --> 01:14:49,650
0,420 420,660 660,900 1320,1770 1770,1800
and sort of talk a
然后稍微谈一谈，

2181
01:14:49,650 --> 01:14:50,550
0,180 180,330 330,570 570,810 810,900
little bit about,| so we
|所以我们看到了这一种方法，

2182
01:14:50,550 --> 01:14:53,250
0,180 180,330 330,660 660,1170 2280,2700
saw this approach one,| which
|这是我们在实验室里做的，

2183
01:14:53,250 --> 01:14:55,340
0,180 180,390 390,1230
we're {do,in} lab,|
|

2184
01:14:55,610 --> 01:14:57,050
0,330 330,450 450,630 630,1200 1200,1440
which we do {in,lab,3},| which
就像我们在实验室3做的那样，|所有的作业都是通过救生筏进行的

2185
01:14:57,050 --> 01:14:59,270
0,510 870,1410 1410,1590 1590,1710 1710,2220
is run all the operations

2186
01:14:59,270 --> 01:15:02,420
0,210 210,720 720,840 840,2220 2250,3150
through raft| and {or,the} replication,
|或者复制，您知道配置和复制都是使用RAFT构建的

2187
01:15:02,420 --> 01:15:03,920
0,90 90,360 360,780 780,1350 1350,1500
you know the configuration and

2188
01:15:03,920 --> 01:15:05,570
0,540 540,630 630,840 840,1290 1290,1650
replication is all built using

2189
01:15:05,570 --> 01:15:07,580
0,480 750,1470 1470,1560 1560,1800 1800,2010
{} raft| and nothing else
|而且没有其他事情牵涉其中

2190
01:15:07,580 --> 01:15:09,260
0,120 120,780 1080,1230 1230,1500 1500,1680
is involved| and then sort
|然后是第二种方法，

2191
01:15:09,260 --> 01:15:10,640
0,60 60,180 180,600 600,1170 1200,1380
of this approach two,| you
|你知道这篇论文的主题是什么，

2192
01:15:10,640 --> 01:15:12,050
0,90 90,300 300,420 420,840 1020,1410
know which is the topic

2193
01:15:12,050 --> 01:15:13,970
0,60 60,300 300,660 660,1230 1440,1920
of this particular paper, {}|
|

2194
01:15:13,970 --> 01:15:16,340
0,750 810,1170 1170,1230 1230,1770 1770,2370
where there's a configuration server,|
有配置服务器的地方，|

2195
01:15:16,400 --> 01:15:20,150
0,390 390,690 690,930 930,1920 3210,3750
perhaps built using raft or
可能使用RAFT或PAXO或在主备份复制方案中使用新的构建，

2196
01:15:20,180 --> 01:15:20,990
0,150 150,450 450,570 570,630 630,810
{} paxos or a new

2197
01:15:20,990 --> 01:15:23,510
0,390 630,1230 1260,1560 1560,2010 2010,2520
one in a primary backup

2198
01:15:23,540 --> 01:15:25,660
0,720 720,1170
replication scheme,|
|

2199
01:15:26,010 --> 01:15:31,120
0,1500 1500,2190 2700,3510
{and,primary} backup using
以及使用链复制的主备份。

2200
01:15:31,120 --> 01:15:34,600
0,660 660,1290
chain replication.|
|

2201
01:15:39,690 --> 01:15:41,130
0,480 480,630 630,720 720,1200 1200,1440
And you can see, you
你可以看到，你知道，希望有一点清楚，

2202
01:15:41,130 --> 01:15:42,840
0,90 90,540 540,1020 1020,1140 1140,1710
know hopefully there's a little

2203
01:15:42,840 --> 01:15:44,790
0,330 330,930 930,1050 1050,1470 1470,1950
clear,| there's some attractive properties
|有一些吸引人的性质可以接近2，

2204
01:15:44,790 --> 01:15:46,770
0,120 120,510 510,870 1200,1800 1800,1980
to approach 2,| {} in
|从某种意义上说，

2205
01:15:46,770 --> 01:15:48,540
0,90 90,420 420,840 1170,1560 1560,1770
the sense that,| {} you
|您可以获得可扩展的重新性能

2206
01:15:48,540 --> 01:15:50,250
0,210 210,420 420,840 840,990 990,1710
can get scalable {re-performance -}|
|

2207
01:15:50,370 --> 01:15:52,530
0,690 690,1050 1050,1230 1230,1530 1530,2160
{} on the primary backups,|
在主备份上，|

2208
01:15:52,830 --> 01:15:54,150
0,360 360,570 570,690 690,870 870,1320
of course {not,on} the configuration
当然不在配置服务器上，

2209
01:15:54,150 --> 01:15:56,850
0,360 360,690 1440,1950 1950,2220 2220,2700
server,| because {it,runs} {} raft,|
|因为它开的是木筏，|

2210
01:15:56,850 --> 01:15:57,930
0,300 300,390 390,600 600,810 810,1080
like you know you're doing
就像你知道你在做方法1，

2211
01:15:57,930 --> 01:15:59,580
0,270 270,690 1020,1440 1440,1530 1530,1650
approach 1,| but you can
|但您至少可以知道，可能会针对复制副本上的实际操作重新执行Scale

2212
01:15:59,580 --> 01:16:00,840
0,120 120,450 450,510 510,720 720,1260
at least you know, {maybe

2213
01:16:00,840 --> 01:16:02,130
0,270 270,480 480,870 870,990 990,1290
-} scale re-performs for actual

2214
01:16:02,130 --> 01:16:03,990
0,720 720,1050 1050,1320 1320,1620 1620,1860
operations on the {replicas -}|
|

2215
01:16:03,990 --> 01:16:05,880
0,240 240,960 990,1320 1320,1560 1560,1890
or on the primary backup
或者在主备份方案上，

2216
01:16:05,880 --> 01:16:07,820
0,360 390,690 690,900 900,1590
scheme,| {put,in} get operations.|
|进行GET操作。|

2217
01:16:08,270 --> 01:16:10,730
0,570 900,1290 1290,1770 1770,2310 2310,2460
{} The other {} thing
这件事的另一个好处是

2218
01:16:10,730 --> 01:16:11,990
0,150 150,390 390,870 870,1080 1080,1260
that is nice about this

2219
01:16:11,990 --> 01:16:13,970
0,60 60,300 780,1620 1650,1830 1830,1980
is that,| the if you
|如果你有非常非常大的数据，

2220
01:16:13,970 --> 01:16:15,110
0,270 300,690 690,750 750,960 960,1140
have data is very very

2221
01:16:15,110 --> 01:16:16,160
0,600 630,690 690,810 810,960 960,1050
large,| you know you can
|您知道，您可以拥有更专业的同步

2222
01:16:16,160 --> 01:16:18,650
0,240 240,600 600,1410 1410,2010 2160,2490
have more specialized { -

2223
01:16:18,650 --> 01:16:22,580
0,570 780,1140 1170,1950 1950,3150 3450,3930
- -} synchronization| or {}
|或者基本上将状态从一台机器复制到另一台机器的方案。

2224
01:16:22,580 --> 01:16:23,840
0,330 330,510 510,840 840,1200 1200,1260
scheme to basically copy the

2225
01:16:23,840 --> 01:16:24,860
0,270 270,390 390,570 570,900 900,1020
state from one machine to

2226
01:16:24,860 --> 01:16:26,000
0,300 300,720
another machine.|
|

2227
01:16:26,180 --> 01:16:27,740
0,510 510,900 900,960 960,1110 1110,1560
{} And you know the
您知道链式复制或任何类型的主备份方案

2228
01:16:27,920 --> 01:16:29,570
0,510 510,990 990,1170 1170,1440 1440,1650
chain replication or when any

2229
01:16:29,570 --> 01:16:30,650
0,120 120,180 180,450 450,720 720,1080
sort of primary backup schemes|
|

2230
01:16:30,650 --> 01:16:32,360
0,180 180,660 660,810 810,1050 1050,1710
are separated from the relationship|
从关系中分离出来|

2231
01:16:32,390 --> 01:16:33,350
0,450 450,510 510,600 600,720 720,960
allows you to do that
使您可以轻松地做到这一点。

2232
01:16:33,350 --> 01:16:34,240
0,360
easily.|
|

2233
01:16:34,500 --> 01:16:36,000
0,180 180,300 300,510 660,1140 1140,1500
And so it's quite common
因此，你知道这种做法是很常见的，

2234
01:16:36,000 --> 01:16:37,710
0,240 240,420 420,630 630,1140 1170,1710
that you know the practice,|
|

2235
01:16:37,710 --> 01:16:38,910
0,90 90,180 180,420 420,720 720,1200
you know people will approach
你知道人们会接近2岁，

2236
01:16:38,910 --> 01:16:40,800
0,450 690,1200 1200,1410 1410,1590 1590,1890
2,| although it is also
|尽管对复制状态机实际使用方法1也不是不可能的

2237
01:16:40,800 --> 01:16:42,960
0,330 330,960 960,1200 1200,1770 1770,2160
not impossible to actually {}

2238
01:16:42,960 --> 01:16:44,880
0,240 240,540 540,900 900,1380 1650,1920
use approach 1 for {}

2239
01:16:44,880 --> 01:16:47,250
0,150 150,840 1050,1380 1380,1830 1830,2370
your replicated state machine| including
|包括像PUT GET操作这样的服务操作

2240
01:16:47,250 --> 01:16:50,460
0,840 840,1470 1770,2610 2610,3000 3000,3210
serving {} operations like put

2241
01:16:50,460 --> 01:16:52,020
0,210 210,870 870,1080 1080,1170 1170,1560
get operations| and in fact,
|事实上，三号实验室可以做到这一点，

2242
01:16:52,020 --> 01:16:53,640
0,300 300,480 480,780 780,1200 1200,1620
{the,lab,3} would do it,| we
|我们将在本学期晚些时候看到论文

2243
01:16:53,640 --> 01:16:55,260
0,120 120,300 300,630 630,1050 1050,1620
will see later paper in

2244
01:16:55,620 --> 01:16:57,540
0,420 420,780 780,1470 1530,1770 1770,1920
this semester Spanner| and that
|而这实际上也是使用[Access]来执行操作。

2245
01:16:57,540 --> 01:16:59,730
0,300 300,720 750,1290 1290,1710 1710,2190
actually uses [access] {to,actually} also

2246
01:16:59,730 --> 01:17:01,080
0,150 150,270 270,1050
do the operations.|
|

2247
01:17:03,780 --> 01:17:05,560
0,300 300,510 510,870 870,1230
Any further questions here?|
这里还有什么问题吗？|

2248
01:17:14,710 --> 01:17:15,880
0,180 180,510 510,810 810,930 930,1170
If not, then I wish
如果没有，那么我祝大家在周四的期中考试中好运，

2249
01:17:15,880 --> 01:17:16,810
0,180 180,390 390,570 570,780 780,930
you all good luck on

2250
01:17:16,810 --> 01:17:19,330
0,210 210,780 780,900 900,1530 1800,2520
the Mid-term on Thursday,| and
|我会亲自去见你，下周我会亲自去见你。

2251
01:17:19,330 --> 01:17:20,470
0,300 300,450 450,600 600,690 690,1140
I'll see you in person,

2252
01:17:20,470 --> 01:17:22,900
0,330 330,750 750,840 840,1350 1740,2430
while virtually in person next

2253
01:17:22,900 --> 01:17:23,840
0,360
week.|
|

2254
01:17:28,780 --> 01:17:29,470
0,210 210,270 270,450 450,540 540,690
And if you have any
如果你有任何问题，

2255
01:17:29,470 --> 01:17:31,120
0,480 630,1050 1050,1380 1380,1560 1560,1650
questions,| please feel free to
|请随时留在这里

2256
01:17:31,120 --> 01:17:34,660
0,180 180,990 1440,1680 3090,3420 3420,3540
hang around| and {I'll,do} my
|我会尽我最大的努力回答他们。

2257
01:17:34,660 --> 01:17:36,280
0,240 240,420 420,660 660,840
best to answer them.|
|

2258
01:17:36,520 --> 01:17:39,610
0,270 270,360 360,1620 2130,2820 2820,3090
I have a question about
我有一个关于你提到的关于木筏的问题，

2259
01:17:39,610 --> 01:17:41,320
0,330 330,630 810,1050 1050,1410 1410,1710
something that you mentioned about

2260
01:17:41,320 --> 01:17:42,670
0,420 420,600 600,840 840,1170 1170,1350
raft,| so you mentioned that
|所以你提到，所有的读取都必须通过大多数服务器，

2261
01:17:42,670 --> 01:17:43,960
0,300 300,630 630,990 990,1170 1170,1290
all the reads have to

2262
01:17:43,960 --> 01:17:45,070
0,270 270,540 540,600 600,1050 1050,1110
go through the majority of

2263
01:17:45,070 --> 01:17:46,570
0,660 810,930 930,1020 1020,1260 1260,1500
servers,| but I'm not quite
|但我不太明白为什么，

2264
01:17:46,570 --> 01:17:48,220
0,210 210,210 210,690 690,1140 1140,1650
sure I understand why,| because
|因为领队有所有提交的条目，对吧。

2265
01:17:48,400 --> 01:17:51,100
0,180 180,780 1080,1920 1950,2340 2340,2700
the leader has {all,of,the} committed

2266
01:17:51,100 --> 01:17:52,990
0,540 540,840 840,1350 1350,1590 1590,1890
entries, right.| Yeah, there's two
|是的，有两个两个计划，如果领导者，

2267
01:17:52,990 --> 01:17:55,690
0,150 150,600 630,1410 2340,2580 2580,2700
two schemes, {} if the

2268
01:17:55,690 --> 01:17:57,760
0,660 780,1500 1530,1800 1800,1890 1890,2070
leader,| so either you run
|所以要么你遇到这样一种情况，所有最近的写入都由领导者提供服务，对吧，

2269
01:17:57,760 --> 01:17:58,660
0,150 150,180 180,600 600,720 720,900
into a situation where all

2270
01:17:58,660 --> 01:18:00,250
0,270 270,780 780,1200 1200,1500 1500,1590
recent writes are served by

2271
01:18:00,250 --> 01:18:01,320
0,180 180,720
the leader,

2272
01:18:01,410 --> 01:18:02,440
0,450
right,|
|

2273
01:18:02,440 --> 01:18:03,490
0,600 630,720 720,840 840,1020 1020,1050
or you know there's a
或者你知道，从原则上讲，

2274
01:18:03,490 --> 01:18:05,200
0,540 540,660 660,930 930,1020 1020,1710
possibility to serve from principle|
|

2275
01:18:05,200 --> 01:18:06,700
0,150 240,480 480,900 900,1170 1170,1500
and read operation from another
和来自另一个对等体的读操作，

2276
01:18:06,700 --> 01:18:07,900
0,360 360,570 570,900 900,1050 1050,1200
peer,| but then you have
|但之后你必须首先联系大多数服务器

2277
01:18:07,900 --> 01:18:10,480
0,90 90,690 690,990 990,1740 2160,2580
to contact first majority {}

2278
01:18:10,480 --> 01:18:11,260
0,120 120,210 210,480 480,570 570,780
of the servers| to make
|以确保您进行了最后一次手术。

2279
01:18:11,260 --> 01:18:12,250
0,390 390,600 600,720 720,840 840,990
absolute sure that you have

2280
01:18:12,250 --> 01:18:13,720
0,90 90,390 390,930
the last operation.|
|

2281
01:18:14,990 --> 01:18:16,400
0,270 270,420 420,840 840,1200 1200,1410
Got it,| so that that
明白了,|因此，如果我们想要将所有读取分布在每个对等点上，就需要满足这个要求。

2282
01:18:16,430 --> 01:18:17,840
0,690 690,840 840,1020 1020,1110 1110,1410
requirement is if we want

2283
01:18:17,840 --> 01:18:19,370
0,270 300,810 810,1020 1020,1170 1170,1530
to spread all the reads

2284
01:18:19,370 --> 01:18:21,890
0,690 720,1230 1320,1860 1860,2400 2400,2520
across every peer.| We have
|我们必须更老练一些

2285
01:18:21,890 --> 01:18:23,600
0,90 90,210 210,450 450,1110 1350,1710
to be more sophisticated| and
|我们不能靠自己做到这一点，

2286
01:18:23,900 --> 01:18:24,890
0,240 240,630 630,750 750,870 870,990
we cannot do it on

2287
01:18:24,890 --> 01:18:25,790
0,120 120,330 330,570 570,720 720,900
our own,| because that would
|因为这肯定会破坏线性化。

2288
01:18:25,790 --> 01:18:27,260
0,390 390,600 600,720 720,1020 1020,1470
definitely break {linearizability - -}.|
|

2289
01:18:28,450 --> 01:18:29,710
0,480 480,660 660,750 750,1050 1050,1260
Right, but if everything goes
对，但如果一切都归领袖所有。

2290
01:18:29,710 --> 01:18:31,390
0,90 90,210 210,690 930,1350 1440,1680
to the leader.| Then when
|然后当你在那里做的时候，对吗，

2291
01:18:31,390 --> 01:18:32,560
0,210 210,390 390,540 540,900 900,1170
you're doing {there -}, correct,|
|

2292
01:18:32,560 --> 01:18:33,610
0,540 540,660 660,840 840,930 930,1050
except you have to do
只是你必须要做这个把戏，

2293
01:18:33,610 --> 01:18:35,020
0,300 330,690 690,1020 1020,1140 1140,1410
this trick,| where you ask
|当你要求一份空洞的协议时，

2294
01:18:35,020 --> 01:18:37,210
0,90 90,180 180,570 570,1260 1770,2190
for an empty agreement, {}|
|

2295
01:18:37,210 --> 01:18:38,320
0,150 150,210 210,540 540,660 660,1110
at the beginning of every
在每个新学期开始的时候。

2296
01:18:38,320 --> 01:18:39,820
0,510 540,1020
new term.|
|

2297
01:18:41,120 --> 01:18:41,900
0,240 240,300 300,450 450,630 630,780
Just to make sure that
只是为了确保您确实是最新的。

2298
01:18:41,900 --> 01:18:42,650
0,150 150,420 420,540 540,690 690,750
you actually are up to

2299
01:18:42,650 --> 01:18:43,580
0,390
date.|
|

2300
01:18:45,710 --> 01:18:47,300
0,510 540,810 810,1050
Okay, thank you.|
好的谢谢。|

2301
01:18:48,130 --> 01:18:50,050
0,180 180,540 540,990 1350,1770 1770,1920
Could you, {} quickly go
你能不能，快速地再翻一遍，

2302
01:18:50,050 --> 01:18:51,850
0,270 270,840 960,1260 1260,1590 1590,1800
over again,| {} when you're
|在尾部添加新服务器时，

2303
01:18:51,850 --> 01:18:52,900
0,270 270,330 330,480 480,930 930,1050
adding a new server at

2304
01:18:52,900 --> 01:18:54,100
0,90 90,720
the tail,|
|

2305
01:18:54,360 --> 01:18:55,560
0,450 480,690 690,960 960,1020 1020,1200
{} so just to make
所以为了确保我明白，

2306
01:18:55,560 --> 01:18:57,540
0,390 390,450 450,1050 1050,1170 1170,1980
sure I understand,| so essentially
|因此，它实质上启动了将所有数据从S2复制到S3的过程

2307
01:18:57,990 --> 01:18:59,670
0,360 360,750 750,930 930,1410 1410,1680
it starts this process for

2308
01:18:59,670 --> 01:19:00,780
0,390 390,510 510,630 630,930 930,1110
copying all the data from

2309
01:19:00,780 --> 01:19:01,860
0,180 180,360 360,420 420,660 660,1080
{S2 -} to {S3 -}|
|

2310
01:19:02,430 --> 01:19:03,450
0,180 180,330 330,480 480,570 570,1020
and then if it receives
然后，如果它接收到对任何数据的请求，

2311
01:19:03,450 --> 01:19:05,010
0,900 930,1110 1110,1260 1260,1350 1350,1560
requests for any of that

2312
01:19:05,010 --> 01:19:06,440
0,330 330,990
data,| while
|在这种情况仍在发生的时候，

2313
01:19:06,440 --> 01:19:08,180
0,420 630,780 780,1050 1050,1590 1590,1740
that is still happening,| then
|然后，S3将直接向S2索要其仍有的任何东西

2314
01:19:08,180 --> 01:19:09,290
0,180 180,360 360,480 480,690 690,1110
{S3 -} is going to

2315
01:19:09,770 --> 01:19:11,360
0,480 480,750 750,1050 1050,1230 1230,1590
ask {S2 -} for anything

2316
01:19:11,360 --> 01:19:12,710
0,150 150,240 240,510 510,870 870,1350
that it still has directly|
|

2317
01:19:12,710 --> 01:19:13,430
0,90 90,240 240,450 450,540 540,720
and it's going to get
它会得到它，然后做出反应。

2318
01:19:13,430 --> 01:19:15,080
0,60 60,150 150,270 270,900 1170,1650
it and then respond.| Yep.|
|是啊。|

2319
01:19:15,600 --> 01:19:16,410
0,210 210,330 330,420 420,630 630,810
And then it keeps doing
然后它继续这样做，直到它获得数据

2320
01:19:16,410 --> 01:19:18,120
0,210 210,690 690,810 810,1320 1320,1710
that until it gets data|
|

2321
01:19:18,120 --> 01:19:19,320
0,420 420,600 600,750 750,870 870,1200
that as to no longer
就像不再有

2322
01:19:19,320 --> 01:19:20,040
0,270 270,360 360,450 450,540 540,720
has| and then it just
|然后它就直接上线了。

2323
01:19:20,040 --> 01:19:22,140
0,240 240,570 600,1170 1500,1950 1950,2100
goes live essentially.| Yeah, or
|是啊，或者你可以稍微改变一下，

2324
01:19:22,140 --> 01:19:23,310
0,120 120,210 210,300 300,630 630,1170
you could do slightly differently,|
|

2325
01:19:23,310 --> 01:19:24,330
0,90 90,210 210,360 360,540 540,1020
you know you could actually
你知道，实际上你可以让S3基本上告诉S2，

2326
01:19:24,330 --> 01:19:26,730
0,360 360,540 540,840 840,1260 1650,2400
have {S3 -} could {}

2327
01:19:26,730 --> 01:19:29,610
0,510 510,1050 1050,1170 1170,1770 2070,2880
basically tell {S2 -} {},|
|

2328
01:19:31,820 --> 01:19:33,560
0,210 210,390 390,630 630,1170 1200,1740
{S3 -} can become the
S3可以成为领导者或某种尾巴

2329
01:19:33,590 --> 01:19:35,630
0,600 630,1050 1050,1320 1320,1380 1380,2040
leader or sort of {the,tail}|
|

2330
01:19:35,660 --> 01:19:37,520
0,660 660,1020 1020,1320 1320,1710 1710,1860
and basically don't process any
并且基本上还不处理来自客户端的任何常见操作，

2331
01:19:37,520 --> 01:19:40,070
0,1470 1530,2040 2040,2160 2160,2220 2220,2550
common operations from the client

2332
01:19:40,070 --> 01:19:41,510
0,240 240,510 510,720 720,1020 1020,1440
yet,| until it actually has
|直到它实际收到了来自S2的剩余操作。

2333
01:19:41,540 --> 01:19:43,550
0,420 420,780 780,870 870,1260 1260,2010
has received the remaining operations

2334
01:19:43,610 --> 01:19:44,960
0,300 300,480 480,840
from {S2 -}.|
|

2335
01:19:47,140 --> 01:19:48,160
0,180 180,360 360,510 510,780 780,1020
Oh, so {in,that} case {S2
哦，那么在这种情况下，S2仍然是尾巴。

2336
01:19:48,160 --> 01:19:49,690
0,240 240,390 390,750 750,840 840,1530
-} is still the tail.|
|

2337
01:19:50,970 --> 01:19:53,490
0,900 900,1140 1140,1680 1680,1980 1980,2520
Yeah.| {So,S3 -} gets everything.|
嗯。|因此，S3得到了一切。|

2338
01:19:53,730 --> 01:19:54,740
0,450
Yeah.|
嗯。|

2339
01:19:56,910 --> 01:19:59,130
0,660 930,1260 1260,1620 1620,2070 2070,2220
Basically, the paper describes one
基本上，这篇论文描述了一种特殊的方法，

2340
01:19:59,130 --> 01:20:00,180
0,330 330,480 480,570 570,780 780,1050
particular way of doing it,|
|

2341
01:20:00,180 --> 01:20:00,960
0,90 90,270 270,450 450,510 510,780
you know there's a couple
你知道有几种方法可以做到这一点。

2342
01:20:00,960 --> 01:20:02,240
0,180 180,240 240,480 480,660
ways of doing it.|
|

2343
01:20:04,000 --> 01:20:05,290
0,420 420,540 540,720 720,870 870,1290
But if you do that
但如果你当时这么做了，

2344
01:20:05,290 --> 01:20:06,280
0,420
then,|
|

2345
01:20:06,430 --> 01:20:08,440
0,510 510,990 1230,1590 1590,1890 1890,2010
{} like how long do
比如你要等多久才能拿到所有东西，

2346
01:20:08,440 --> 01:20:11,260
0,180 180,660 660,1200 1560,1980 1980,2820
you wait to get everything,|
|

2347
01:20:11,440 --> 01:20:13,140
0,750

2348
01:20:13,140 --> 01:20:14,070
0,120 120,330 330,330 330,780 780,930
I think I also had
我想我和其他人一样也有同样的困惑。

2349
01:20:14,070 --> 01:20:15,180
0,90 90,270 270,690 690,810 810,1110
the same confusion as someone

2350
01:20:15,180 --> 01:20:16,500
0,390 390,510 510,720 720,1080 1080,1320
else.| You know, you know
|你知道，你知道转换是以什么顺序发生的，对吧，

2351
01:20:16,500 --> 01:20:17,700
0,90 90,330 330,720 720,900 900,1200
in what order the switch

2352
01:20:17,700 --> 01:20:19,590
0,60 60,450 480,990 990,1320 1320,1890
is happening, correct,| so example
|举个例子，比如S3，假设S2有上百次的大运算，

2353
01:20:19,590 --> 01:20:21,720
0,210 210,1020 1050,1740 1740,1950 1950,2130
like {S3,so -} S2 let's

2354
01:20:21,720 --> 01:20:22,950
0,210 210,630 630,930 930,1230 1230,1230
say maybe has a {}

2355
01:20:22,950 --> 01:20:25,340
0,630 630,1170 1170,1380 1380,1890
big operations through hundreds,|
|

2356
01:20:25,460 --> 01:20:26,870
0,150 150,390 390,450 450,780 780,1410
you start to copy operations,|
你开始复制操作，|

2357
01:20:26,870 --> 01:20:28,700
0,330 330,990 990,1170 1170,1260 1260,1830
likely snapshots with a raft,|
可能是用木筏拍的快照，|

2358
01:20:28,970 --> 01:20:30,320
0,150 150,420 420,510 510,810 810,1350
you start the copy operation,|
你开始复制操作，|

2359
01:20:30,320 --> 01:20:31,430
0,150 150,300 300,360 360,660 660,1110
so when the copy operation
因此，当复制操作完成时，

2360
01:20:31,430 --> 01:20:32,510
0,120 120,450 450,630 630,930 930,1080
is done,| {S3,is -} up
|S3一直到一百个数据，对吧。

2361
01:20:32,510 --> 01:20:34,160
0,360 360,660 660,1080
{to,data} until hundred,

2362
01:20:34,390 --> 01:20:35,920
0,510
right.|
|

2363
01:20:36,390 --> 01:20:37,710
0,570 570,630 630,750 750,1140 1140,1320
Then you know maybe {S2
那么你就知道，也许S2已经有了十个以上的操作，

2364
01:20:37,710 --> 01:20:39,240
0,150 150,480 480,900 930,1230 1230,1530
-} already has ten more

2365
01:20:39,240 --> 01:20:40,860
0,660 690,870 870,1020 1020,1290 1290,1620
operations,| so it has {101
|所以它有101,102和103，对吧，

2366
01:20:40,860 --> 01:20:42,660
0,450 450,750 750,1080 1080,1440 1440,1800
-} {102 -} and 103,

2367
01:20:42,900 --> 01:20:44,220
0,630
right,|
|

2368
01:20:44,220 --> 01:20:46,800
0,450 450,1260 1260,1860 1860,2190 2190,2580
and basically {} {S3 -}
基本上，S3你能联系到S2吗，

2369
01:20:46,800 --> 01:20:48,240
0,390 390,480 480,990 990,1200 1200,1440
can you contact {S2 -},|
|

2370
01:20:48,240 --> 01:20:49,830
0,540 540,720 720,1050 1050,1230 1230,1590
say give me your remaining
说把你剩下的手术交给我，

2371
01:20:49,830 --> 01:20:51,210
0,690 690,840 840,990 990,1230 1230,1380
operations,| {and,S2 -} says, like
|而S2说，就像剩下的101到10号作业一样，

2372
01:20:51,210 --> 01:20:52,920
0,330 330,630 630,1050 1050,1290 1290,1710
well remaining operations {101 -}

2373
01:20:52,920 --> 01:20:54,380
0,240 240,450 450,600 600,930
through one to ten,|
|

2374
01:20:55,000 --> 01:20:56,770
0,900 900,1110 1110,1140 1140,1410 1410,1770
and as a side effect,|
作为一个副作用，|

2375
01:20:56,770 --> 01:20:58,390
0,60 60,1020 1050,1290 1290,1440 1440,1620
you know as we also
你知道，我们还告诉S2不要再做尾巴了，

2376
01:20:58,390 --> 01:20:59,740
0,390 390,540 540,780 780,1020 1020,1350
tells {S2 -} like stop

2377
01:20:59,740 --> 01:21:01,020
0,240 240,330 330,720
being the tail,|
|

2378
01:21:01,540 --> 01:21:03,670
0,900 900,1200 1200,1470 1470,1710 1710,2130
and, {} {S2 -} response
以及，S2对这些操作做出响应，

2379
01:21:03,670 --> 01:21:05,740
0,120 120,330 330,1230 1470,1860 1860,2070
with those operations,| {} {S3
|S3适用，

2380
01:21:05,740 --> 01:21:07,330
0,210 210,870 870,1110 1110,1230 1230,1590
-} applies,| there's {} operation
|从101号手术到1点到10点，

2381
01:21:07,330 --> 01:21:08,740
0,210 210,540 540,690 690,870 870,1410
{101 -} through one {to,ten},|
|

2382
01:21:08,890 --> 01:21:11,290
0,180 180,690 720,1200 1200,1650 1650,2400
and then tells client it
然后告诉客户这意味着它是尾巴

2383
01:21:11,290 --> 01:21:12,310
0,210 210,450 450,600 600,900 900,1020
means it is tail,| but
|但它还不处理来自客户端的任何命令

2384
01:21:12,310 --> 01:21:13,660
0,60 60,300 300,810 810,1020 1020,1350
it doesn't process any commands

2385
01:21:13,660 --> 01:21:15,190
0,150 150,510 510,840 1110,1320 1320,1530
from clients yet| or read
|或来自客户端的读操作，

2386
01:21:15,190 --> 01:21:16,210
0,270 270,390 390,690 690,870 870,1020
operation from client yet,| until
|直到它实际处理101到110。

2387
01:21:16,210 --> 01:21:17,770
0,330 330,600 720,1080 1080,1290 1290,1560
it actually process {101 -}

2388
01:21:17,770 --> 01:21:18,860
0,120 120,300 300,630
to {110 -}.|
|

2389
01:21:21,380 --> 01:21:23,540
0,600 750,1050 1050,1170 1170,1590 1830,2160
Okay, okay I see, {}
好的，好的，我明白了，明白了。

2390
01:21:23,540 --> 01:21:25,020
0,210 210,510
I see.|
|

2391
01:21:25,170 --> 01:21:26,480
0,450

2392
01:21:26,850 --> 01:21:27,780
0,270 270,450 450,660 660,780 780,930
Okay, I have {another -}
好吧，我还有一个问题，

2393
01:21:27,780 --> 01:21:32,220
0,630 1500,1680 1680,2190 3780,4170 4170,4440
question,| oh sorry.| No, go
|哦，对不起。|不，去吧，去吧。

2394
01:21:32,220 --> 01:21:34,200
0,180 180,510 780,1410 1530,1800 1800,1980
ahead, {go,ahead}.| Okay, {} my
|好的，我的问题和分机有点相似

2395
01:21:34,200 --> 01:21:35,880
0,330 330,510 510,660 660,1110 1140,1680
question was a little similar

2396
01:21:35,880 --> 01:21:38,070
0,180 180,600 960,1320 1320,2040 2040,2190
to the {} extension| that
|就是他谈到的。

2397
01:21:38,070 --> 01:21:40,360
0,90 90,420 420,960 1200,1830
he talked about {}.|
|

2398
01:21:40,660 --> 01:21:42,640
0,210 210,840 1110,1260 1260,1470 1470,1980
I thought I thought about,|
我以为我在想，|

2399
01:21:42,790 --> 01:21:43,660
0,210 210,420 420,570 570,690 690,870
could you could you do
你能不能做一棵树而不是链子，所以。

2400
01:21:43,660 --> 01:21:45,400
0,210 210,840 1020,1500 1500,1650 1650,1740
a tree instead of a

2401
01:21:45,400 --> 01:21:47,540
0,780 900,1590
chain, so.|
|

2402
01:21:47,630 --> 01:21:49,820
0,510 1110,1650 1650,1830 1830,2040 2040,2190
{ -} I think there's
我认为有一种，

2403
01:21:49,820 --> 01:21:52,100
0,1680
the,|
|

2404
01:21:52,100 --> 01:21:53,390
0,510 630,930 930,1020 1020,1110 1110,1290
{} there {other -} data
还有其他可能的数据结构，

2405
01:21:53,390 --> 01:21:55,250
0,330 330,900 930,1620 1620,1740 1740,1860
structures possible,| {} like {for
|例如，您知道有多少人在电子邮件中建议

2406
01:21:55,250 --> 01:21:56,570
0,60 60,750 750,900 900,1020 1020,1320
-} example, you know number

2407
01:21:56,570 --> 01:21:58,340
0,60 60,540 540,840 840,1170 1170,1770
of people in email proposed|
|

2408
01:21:58,520 --> 01:21:59,510
0,210 210,300 300,390 390,810 810,990
that you could have {S1
你可以拥有S1，

2409
01:21:59,510 --> 01:22:00,680
0,510 630,840 840,930 930,1020 1020,1170
-},| then you could have
|然后你可以像S345一样，所有中间的，

2410
01:22:00,680 --> 01:22:02,960
0,960 990,1230 1230,1680 1680,1890 1890,2280
like {S3 -} 4 5

2411
01:22:02,960 --> 01:22:04,070
0,120 120,240 240,690 690,1050 1050,1110
all the intermediate ones,| you
|你知道，S1与它们的对话与所有中间的对话是平行的

2412
01:22:04,070 --> 01:22:05,330
0,210 210,390 390,630 630,990 990,1260
know {S1 -} {talks,to} {them,in}

2413
01:22:05,330 --> 01:22:07,160
0,630 630,780 780,1170 1170,1350 1350,1830
parallel to all the intermediate

2414
01:22:07,160 --> 01:22:08,480
0,270 270,360 360,540 540,1020 1020,1320
ones| and the intermediate ones
|中间的都是尾巴，

2415
01:22:08,480 --> 01:22:10,520
0,390 390,630 630,960 960,1620 1650,2040
{} all to {} the

2416
01:22:10,790 --> 01:22:13,190
0,480 480,1020 1530,1890 1890,2250 2250,2400
{} tail,| {} is that
|你说的树就是这个意思吗？

2417
01:22:13,190 --> 01:22:14,270
0,120 120,210 210,420 420,600 600,1080
what you mean with a

2418
01:22:14,270 --> 01:22:18,530
0,540 810,1530 1530,1740 3300,3570 3570,4260
tree?| { -} I meant
|如果有的话，我的意思是更多，

2419
01:22:18,560 --> 01:22:20,210
0,360 360,630 630,990 990,1170 1170,1650
more if there would be,|
|

2420
01:22:20,780 --> 01:22:21,940
0,600
like
就像许多树叶一样，它们的高度大致相同，

2421
01:22:21,940 --> 01:22:23,470
0,60 60,450 450,660 660,1290 1290,1530
a number of leaves there

2422
01:22:23,470 --> 01:22:25,120
0,150 150,660 810,1050 1050,1290 1290,1650
would be at all roughly

2423
01:22:25,120 --> 01:22:26,710
0,120 120,540 540,1110 1140,1380 1380,1590
the same height,| so {like,a}
|所以就像一棵平衡的树，

2424
01:22:26,710 --> 01:22:29,200
0,480 480,870 1080,1290 1290,1830 2250,2490
balanced tree,| and then the
|然后树叶就会像一条链子穿过它们，

2425
01:22:29,200 --> 01:22:30,520
0,300 300,420 420,660 660,1080 1200,1320
leaves will have like a

2426
01:22:30,520 --> 01:22:33,400
0,420 420,750 750,960 960,1320
chain going through them,|
|

2427
01:22:33,400 --> 01:22:35,860
0,660 750,1290 1350,1500 1500,2100 2100,2460
{} and I think the
我认为线性化在这里可以被打破，

2428
01:22:36,130 --> 01:22:38,650
0,390 390,1080 1080,1380 1380,1770 1800,2520
{linearizability -} can be broken

2429
01:22:38,650 --> 01:22:40,720
0,720 780,1020 1020,1140 1140,1530
here,| if you like,
|如果你愿意，哦，如果你再仔细考虑一下，

2430
01:22:40,930 --> 01:22:42,940
0,450 690,930 930,1410 1410,1680 1680,2010
oh, if you'd think harder

2431
01:22:42,940 --> 01:22:45,100
0,270 270,420 420,810 1470,1590 1590,2160
about it,| but it would
|但它将拥有你不会拥有的美好财产，

2432
01:22:45,100 --> 01:22:46,240
0,150 150,210 210,420 420,810 810,1140
have the nice property that

2433
01:22:46,270 --> 01:22:48,000
0,270 270,690 720,1170
you wouldn't,| like,
|就像，他们现在的传播可以延迟就像[对数]

2434
01:22:48,090 --> 01:22:49,950
0,240 240,480 480,720 720,1470 1470,1860
they now the propagation {can,delay}

2435
01:22:49,950 --> 01:22:52,380
0,210 210,300 300,690 960,2010 2040,2430
would be like [logarithmic]| instead
|而不是这里的线性

2436
01:22:52,380 --> 01:22:54,030
0,240 240,810 810,960 960,1470 1470,1650
of linear as here| and
|你可以从所有的树叶上阅读。

2437
01:22:54,030 --> 01:22:54,840
0,120 120,300 300,480 480,660 660,810
you could read from all

2438
01:22:54,840 --> 01:22:56,880
0,90 90,540 540,870 1350,1800 1800,2040
the leaves.| Yeah, okay, reading
|好吧，好吧，读所有的叶子是危险的，对吧，

2439
01:22:56,880 --> 01:22:58,020
0,150 150,270 270,330 330,600 600,1140
from all the leaves {is,dangerous},

2440
01:22:58,020 --> 01:22:59,940
0,270 270,720 870,1500 1500,1650 1650,1920
right,| because {} they might
|因为他们可能这么做了，

2441
01:22:59,940 --> 01:23:01,110
0,300 330,450 450,540 540,780 780,1170
have,| you know one client
|你知道，一个客户可能早些时候和另一个休假的客户谈过了

2442
01:23:01,110 --> 01:23:02,760
0,120 120,210 210,510 510,780 780,1650
might have talked to a

2443
01:23:02,760 --> 01:23:04,800
0,360 360,690 690,1290 1320,1740 1740,2040
another leave earlier| and leaves
|树叶可能不同步，

2444
01:23:04,800 --> 01:23:05,490
0,60 60,270 270,480 480,600 600,690
{} might not be in

2445
01:23:05,490 --> 01:23:06,340
0,420
sync,|
|

2446
01:23:06,770 --> 01:23:10,580
0,720 720,1380 1800,3060 3060,3300 3300,3810
{} so that sounds dangerous
所以我觉得这听起来很危险，

2447
01:23:10,580 --> 01:23:12,110
0,120 120,660 660,1050 1050,1410 1410,1530
to me,| maybe your your
|也许你的计划比我想的要复杂一点，

2448
01:23:12,110 --> 01:23:12,680
0,240 240,300 300,330 330,480 480,570
scheme is a little bit

2449
01:23:12,680 --> 01:23:14,870
0,120 120,690 690,840 840,1830 1830,2190
more sophisticated than I'm thinking,|
|

2450
01:23:15,470 --> 01:23:17,540
0,570 840,1320 1320,1410 1410,1500 1500,2070
the depth of the tree
树的深度或者链条的深度实际上是由失败之间的时间决定的，对吧，

2451
01:23:17,540 --> 01:23:18,500
0,180 180,270 270,510 510,600 600,960
or the depth of the

2452
01:23:18,500 --> 01:23:20,930
0,420 420,840 840,1440 1470,1980 1980,2430
chain really {} governed by

2453
01:23:20,930 --> 01:23:23,270
0,450 450,1110 1110,1410 1410,1920 1950,2340
the meantime between failure, right,|
|

2454
01:23:23,890 --> 01:23:25,780
0,420 420,900 900,1020 1020,1290 1290,1890
{} {if,you're} on the {},|
如果你在电视上，|

2455
01:23:26,020 --> 01:23:27,160
0,150 150,360 360,750 750,990 990,1140
if you typically run with
如果您通常使用3台服务器、3到5台服务器运行，

2456
01:23:27,160 --> 01:23:28,600
0,180 180,600 600,750 750,1140 1140,1440
3 server, {3,to,5 -} serves,|
|

2457
01:23:28,600 --> 01:23:29,740
0,210 210,390 390,540 540,840 840,1140
because that's good enough for
因为这对您的高可用性来说已经足够好了，

2458
01:23:29,740 --> 01:23:33,100
0,480 690,1350 1350,2340 2460,3120 3120,3360
your high availability,| then because
|然后，因为您可以从4台服务器恢复，

2459
01:23:33,100 --> 01:23:35,080
0,90 90,540 870,1410 1410,1530 1530,1980
you can recover from 4

2460
01:23:35,080 --> 01:23:36,730
0,660 660,1200 1200,1290 1290,1500 1500,1650
servers,| before the whole thing
|在整件事落下之前，

2461
01:23:36,730 --> 01:23:40,210
0,120 120,660 1050,1740 1890,2730 2730,3480
is down,| {} then, {}
|然后，这就真正覆盖了链条的深度，

2462
01:23:40,240 --> 01:23:41,830
0,270 270,450 450,750 750,1080 1110,1590
that really covers the depth

2463
01:23:41,830 --> 01:23:43,080
0,150 150,270 270,810
of the chain,|
|

2464
01:23:43,260 --> 01:23:45,360
0,810 990,1290 1290,1530 1530,1770 1770,2100
{} and yeah we'll introduce
是的，我们会引入一些延迟。

2465
01:23:45,360 --> 01:23:46,800
0,180 180,900
some latency.|
|

2466
01:23:49,770 --> 01:23:51,630
0,300 300,540 540,1200 1290,1650 1650,1860
Okay, {that,make,sence -}, thank you.|
好的，这说得通，谢谢。|

2467
01:23:51,630 --> 01:23:53,280
0,510 510,720 720,1050 1050,1170 1170,1650
Chain will generally be short.|
链条一般都是短的。|

2468
01:23:53,930 --> 01:23:55,850
0,840 840,1080 1080,1200 1200,1410 1410,1920
Okay okay, that makes sense,
好的，好的，有道理，谢谢。

2469
01:23:56,030 --> 01:23:57,260
0,750
thanks.|
|

2470
01:23:57,260 --> 01:23:58,280
0,150 150,480
You're welcome.|
不用谢。|

2471
01:23:59,030 --> 01:24:00,080
0,180 180,330 330,480 480,720 720,1050
Is this the only case
这是唯一一起整列火车都会坠落的情况吗，

2472
01:24:00,080 --> 01:24:01,310
0,270 270,360 360,750 750,1080 1080,1230
where the entire train would

2473
01:24:01,310 --> 01:24:02,580
0,180 180,720
go down,|
|

2474
01:24:02,580 --> 01:24:03,990
0,390 420,810 810,900 900,1350 1350,1410
if all the servers in
如果链中的所有服务器都宕机了。

2475
01:24:03,990 --> 01:24:05,610
0,120 120,330 330,480 480,930 1200,1620
the chain went down.| Yeah.|
|嗯。|

2476
01:24:07,370 --> 01:24:08,380
0,210 210,450
Thank you.|
谢谢。|

2477
01:24:09,640 --> 01:24:12,340
0,540 930,1500 1500,1650 1650,2100 2100,2700
I also was curious how
我也很好奇你是如何保持强烈的一致性的，

2478
01:24:12,340 --> 01:24:14,050
0,270 270,660 660,750 750,1050 1050,1710
you maintain the strong consistency,|
|

2479
01:24:14,050 --> 01:24:16,510
0,480 1020,2040 2040,2220 2220,2370 2370,2460
{when,like} S1 {S2 -} and
与S1一样，S2和S3都可以在本幻灯片中进行阅读。

2480
01:24:16,510 --> 01:24:18,250
0,120 120,330 330,480 480,1170 1440,1740
{S3 -} can all do

2481
01:24:18,250 --> 01:24:19,750
0,120 120,360 360,780 780,930 930,1500
the read in this slide.|
|

2482
01:24:21,340 --> 01:24:23,470
0,270 270,540 540,870 870,1230 1230,2130
You get strong consistency per
每个碎片或每个对象都具有很强的一致性，

2483
01:24:23,470 --> 01:24:25,990
0,660 660,1470 1500,1770 1770,2040 2040,2520
{} {per,shard} or per object,|
|

2484
01:24:25,990 --> 01:24:26,860
0,90 90,180 180,360 360,600 600,870
you know that's assigned to
你知道这是分配给连锁店的，对吧。

2485
01:24:26,860 --> 01:24:28,220
0,450 450,810
{the,chain}, right.|
|

2486
01:24:28,520 --> 01:24:31,010
0,300 300,390 390,660 660,1200 1260,2490
So if you read {}
所以如果你读到你写了一个对象，

2487
01:24:31,010 --> 01:24:32,990
0,240 240,480 480,870 870,1560 1770,1980
you write one object,| you
|你写对象一，你读对象一，

2488
01:24:32,990 --> 01:24:34,250
0,210 210,510 510,930 930,1080 1080,1260
write object one, you read

2489
01:24:34,250 --> 01:24:35,960
0,330 330,810 960,1110 1110,1290 1290,1710
object one,| all those operations
|所有这些行动都将经过相同的链条

2490
01:24:35,960 --> 01:24:36,500
0,60 60,180 180,240 240,360 360,540
are going to go through

2491
01:24:36,500 --> 01:24:37,520
0,90 90,330 330,780 780,930 930,1020
the same chain| and so
|因此，对于那个特定的物体，你会得到很强的一致性。

2492
01:24:37,520 --> 01:24:38,870
0,120 120,210 210,450 450,1020 1020,1350
you get strong consistency for

2493
01:24:38,870 --> 01:24:40,520
0,300 300,720 720,1200
that particular object.|
|

2494
01:24:40,610 --> 01:24:42,140
0,630 630,900 900,1200 1290,1470 1470,1530
Oh, got it.| But it
哦，知道了。|但情况可能并非如此，

2495
01:24:42,140 --> 01:24:42,860
0,90 90,240 240,330 330,420 420,720
may not be the case,|
|

2496
01:24:43,280 --> 01:24:44,420
0,420 420,570 570,660 660,1050 1050,1140
across all the objects we
在所有的物体上，我们都有很强的一致性。

2497
01:24:44,420 --> 01:24:46,850
0,150 150,390 390,1140 1350,2220 2220,2430
have strong consistency.| No, I
|不，我不会，我会的，让我犹豫一下。

2498
01:24:46,850 --> 01:24:49,130
0,570 570,1020 1020,1620 1620,2190 2190,2280
don't, I will, let me

2499
01:24:49,130 --> 01:24:52,820
0,480 480,660 2220,3210
hesitate {that -}.|
|

2500
01:24:57,270 --> 01:24:58,200
0,210 210,360 360,630 630,690 690,930
Let me hesitate, I think
让我犹豫一下，我想你知道这可能需要更多的机器。

2501
01:24:58,200 --> 01:24:59,850
0,90 90,270 270,690 750,1410 1410,1650
you know that requires maybe

2502
01:24:59,850 --> 01:25:01,710
0,210 210,780 1140,1530 1530,1740 1740,1860
more machinery.| Well, what does
|那么，这是什么意思，就像所有的物体变得更强一样。

2503
01:25:01,710 --> 01:25:03,090
0,240 240,600 630,870 870,1260 1260,1380
that mean like across all

2504
01:25:03,090 --> 01:25:04,500
0,150 150,930
the objects

2505
01:25:04,500 --> 01:25:07,230
0,240 240,630 720,1890 2130,2430 2430,2730
getting stronger.| {I,think,the} you read
|我认为你读写对象一，你读或写对象二，

2506
01:25:07,230 --> 01:25:09,300
0,420 420,720 720,1230 1680,1890 1890,2070
write object one, you read

2507
01:25:09,300 --> 01:25:11,120
0,90 90,360 360,720 720,1290
or write object two,|
|

2508
01:25:11,150 --> 01:25:13,640
0,210 210,870 870,1740 1770,2160 2160,2490
{} and then some client
然后一些客户端读取对象一，

2509
01:25:13,640 --> 01:25:15,380
0,570 570,1170
{read,object} one,|
|

2510
01:25:15,620 --> 01:25:16,940
0,600 600,750 750,900 900,960 960,1320
Are you going to {}
你还打算这么做吗。

2511
01:25:16,940 --> 01:25:17,940
0,360
yet.|
|

2512
01:25:18,210 --> 01:25:19,110
0,540 540,630 630,750 750,840 840,900
Basically, you know if you
基本上，您知道如果您有一个客户端来读取这两个对象，

2513
01:25:19,110 --> 01:25:19,920
0,90 90,150 150,420 420,480 480,810
have a client to read

2514
01:25:19,920 --> 01:25:21,330
0,330 330,810 810,1020 1020,1140 1140,1410
both objects,| are you are
|你能保证看到整体的有序性和线性化吗？

2515
01:25:21,360 --> 01:25:22,950
0,600 600,690 690,900 900,1200 1200,1590
guaranteed to see total order

2516
01:25:22,950 --> 01:25:25,860
0,540 570,1080 1080,1350 1350,2250 2250,2910
and {} linearizability.| {Is,that} like
|这类似于可序列化吗？

2517
01:25:25,860 --> 01:25:26,880
0,450
serializability?|
|

2518
01:25:27,030 --> 01:25:28,890
0,420 420,810 810,1020 1020,1410 1410,1860
{} {Serializability -} slightly different,|
可串行化略有不同，|

2519
01:25:28,950 --> 01:25:30,780
0,540 630,1200 1200,1560 1560,1680 1680,1830
{you,know} maybe, let's not talk
你知道，也许，我们不要谈论可串行化，

2520
01:25:30,780 --> 01:25:32,280
0,210 210,360 360,1080 1080,1290 1290,1500
about {serializability -},| {we'll,come} back,
|我们会回来的，我们会在几周后拿到的。

2521
01:25:32,280 --> 01:25:33,630
0,270 270,960 960,1230 1230,1320 1320,1350
{we'll,get} that later in a

2522
01:25:33,630 --> 01:25:36,510
0,210 210,600 1050,1860 2070,2430 2430,2880
couple weeks.| {} Yeah, and.|
|是啊，还有。|

2523
01:25:36,570 --> 01:25:38,640
0,510

2524
01:25:40,740 --> 01:25:42,360
0,120 120,540 540,870 870,1440 1440,1620
I [managed] to actually make
我(设法)现在真的做出了承诺，

2525
01:25:42,360 --> 01:25:43,800
0,60 60,450 450,600 600,930 1140,1440
a commitment right now,| I
|我需要考虑一下这件事。

2526
01:25:43,800 --> 01:25:44,400
0,150 150,240 240,390 390,420 420,600
need to think a little

2527
01:25:44,400 --> 01:25:45,930
0,120 120,330 330,540 900,1410 1410,1530
bit about it.| Okay, that's
|好吧，这完全是公平的。

2528
01:25:45,930 --> 01:25:46,840
0,120 120,360
totally fair.|
|

2529
01:25:48,280 --> 01:25:50,170
0,300 300,420 420,780 780,930 930,1890
So the question is like|
所以问题是这样的|

2530
01:25:50,440 --> 01:25:52,090
0,210 210,510 540,750 750,990 990,1650
you know you have consistency
您知道您具有单个客户端读取和写入的一致性或线性化，

2531
01:25:52,090 --> 01:25:53,110
0,150 150,390 390,810 810,960 960,1020
or {linearizability -} for a

2532
01:25:53,110 --> 01:25:54,880
0,450 450,900 900,1170 1170,1290 1290,1770
single client reading and writing,|
|

2533
01:25:55,210 --> 01:25:57,310
0,390 390,690 690,1170 1200,1740 1740,2100
but not for multiple, on
但不是针对多个对象，而是针对多个对象。

2534
01:25:57,310 --> 01:25:59,530
0,360 360,1140 1320,1590 1590,1770 1770,2220
multiple objects.| You have even
|你甚至有多个客户在谈论这件事，

2535
01:25:59,710 --> 01:26:01,930
0,450 450,1140 1170,1620 1620,1860 1860,2220
multiple clients talking to this,|
|

2536
01:26:01,930 --> 01:26:03,430
0,240 240,600 600,780 780,1050 1050,1500
you know are doing operations
你知道我们在同一个物体上做手术，

2537
01:26:03,430 --> 01:26:04,900
0,60 60,120 120,510 510,1080 1080,1470
on the same object,| {have,strongly}
|该方案具有较强的线性化正确性，

2538
01:26:04,930 --> 01:26:07,600
0,1320 1350,1650 1650,1770 1770,2130 2490,2670
linearizability {correct,in} this scheme,| the
|问题是，我们也可以跨对象线性化。

2539
01:26:07,600 --> 01:26:09,730
0,360 360,810 870,1140 1140,1560 1560,2130
question is we have {linearizability

2540
01:26:09,730 --> 01:26:12,400
0,390 390,1230 1380,1890 1890,2310
-} across objects too.|
|

2541
01:26:13,410 --> 01:26:15,000
0,270 270,960 1020,1350 1350,1440 1440,1590
But {}, why is that
但是，为什么这很重要，老实说，这在哪里是重要的，

2542
01:26:15,000 --> 01:26:17,880
0,540 960,1170 1170,1560 1560,2130 2310,2880
important and honestly where like

2543
01:26:18,120 --> 01:26:19,380
0,210 210,330 330,450 450,570 570,1260
where that would be important

2544
01:26:19,530 --> 01:26:20,620
0,510
like,|
|

2545
01:26:21,600 --> 01:26:23,460
0,270 270,600 600,810 810,1290
because you, you gonna
因为你，你会喜欢的，你不能正确地组织行动，

2546
01:26:23,580 --> 01:26:24,820
0,660
like,

2547
01:26:25,150 --> 01:26:28,060
0,240 240,720 720,1530 1620,2460 2460,2910
you can't group operations right,|
|

2548
01:26:28,180 --> 01:26:30,250
0,270 270,450 450,600 600,870 870,2070
so like {} a write
就像一次写和一次写。

2549
01:26:30,550 --> 01:26:31,690
0,300 450,540 540,690 690,870 870,1140
{and,a,write}.| I mean you read
|我的意思是你读对象一，你写对象一，你读对象一，

2550
01:26:31,690 --> 01:26:33,370
0,360 360,1050 1050,1170 1170,1410 1410,1680
object one, you write object

2551
01:26:33,370 --> 01:26:34,510
0,180 180,300 300,480 480,810 810,1140
one, you read object one,|
|

2552
01:26:34,510 --> 01:26:35,710
0,210 210,420 420,810 810,1050 1050,1200
you read object two, you
你读对象二，写对象二，

2553
01:26:35,710 --> 01:26:39,130
0,210 210,570 570,1020 1320,2460 2460,3420
write object two,| {} and
|你知道，问题是你知道线性化，

2554
01:26:39,130 --> 01:26:40,520
0,150 150,270 270,810
you know the,

2555
01:26:40,850 --> 01:26:41,930
0,120 120,480 480,750 750,840 840,1080
the question is you know

2556
01:26:41,930 --> 01:26:43,280
0,330 330,750 750,1140 1140,1200 1200,1350
in {linearizability -},| you know
|你知道这些操作需要是完全有序的

2557
01:26:43,280 --> 01:26:44,810
0,690 720,1290 1290,1380 1380,1470 1470,1530
those operations need to be

2558
01:26:44,810 --> 01:26:47,000
0,210 210,270 270,600 930,1650 1650,2190
{total -} order| and they
|他们需要保持这种实时的属性。

2559
01:26:47,000 --> 01:26:49,760
0,210 210,1170 1230,2130 2130,2250 2250,2760
need to preserve this property

2560
01:26:49,760 --> 01:26:51,560
0,570 600,960 960,1260
of real time.|
|

2561
01:26:52,740 --> 01:26:54,180
0,330 330,600 600,1050 1050,1170 1170,1440
And since you have different
由于你有不同的链条，这些链条实际上可能不会发生，

2562
01:26:54,180 --> 01:26:56,010
0,360 360,510 510,720 720,1200 1200,1830
chains that might actually not

2563
01:26:56,010 --> 01:26:57,450
0,270 270,600 600,1170 1170,1320 1320,1440
happen,| but I don't want
|但我不想承诺不发表关于所有链条的声明。

2564
01:26:57,450 --> 01:26:59,460
0,60 60,330 330,720 750,1680 1680,2010
to commit to no statement

2565
01:26:59,460 --> 01:27:01,380
0,330 330,570 570,900 900,1440
about all across chains.|
|

2566
01:27:01,380 --> 01:27:02,220
0,60 60,150 150,420 420,510 510,840
You know with the chain
你知道，链实际上保证了线性化，

2567
01:27:02,220 --> 01:27:03,630
0,150 150,600 600,1020 1020,1170 1170,1410
is actually guaranteed to {linearizability

2568
01:27:03,630 --> 01:27:04,530
0,390 390,600 600,720 720,810 810,900
-},| even if you have
|即使你有不同的物品。

2569
01:27:04,530 --> 01:27:05,860
0,240 240,840
different objects.|
|

2570
01:27:08,290 --> 01:27:09,370
0,180 180,450 450,510 510,660 660,1080
There's something I don't understand
报纸上有一些我不明白的事情，

2571
01:27:09,370 --> 01:27:10,360
0,90 90,180 180,600 600,780 780,990
in the paper,| which is
|其是更新传播不变量，

2572
01:27:10,360 --> 01:27:11,620
0,240 240,660
the {}

2573
01:27:11,620 --> 01:27:15,310
0,420 420,1080 1080,1710 2490,2790 2790,3690
update propagation invariant,| where like
|在这里，就像是，在这个链条的顺序中。

2574
01:27:15,790 --> 01:27:17,760
0,480 480,660 690,1380
sort of the,

2575
01:27:17,760 --> 01:27:19,950
0,450 1080,1200 1200,1500 1500,1950 1950,2190
for in this order of

2576
01:27:19,950 --> 01:27:22,830
0,240 240,870 1080,1620 1680,1980 1980,2880
the chain.| Yep.| The like
|是啊。|类似的提交是每个后续提交的前缀，

2577
01:27:22,950 --> 01:27:25,290
0,750 780,1170 1170,1770 1770,2160 2160,2340
commits are prefix of each

2578
01:27:25,290 --> 01:27:29,790
0,990 1860,2340 3630,3900 3900,4080 4080,4500
successors commits,| {} is that
|这是不是保证在完整的传球通过链条之后。

2579
01:27:29,790 --> 01:27:31,980
0,630 630,1380 1380,1650 1650,1830 1830,2190
guaranteed after like a full

2580
01:27:31,980 --> 01:27:33,420
0,420 420,600 600,930 930,1290 1290,1440
pass has gone through the

2581
01:27:33,420 --> 01:27:35,490
0,450 1200,1350 1350,1500 1500,1800 1800,2070
chain.| Well, it's always true
|好吧，这总是正确的，

2582
01:27:35,490 --> 01:27:36,420
0,210 210,420 420,690 690,810 810,930
right,| like if you go
|比如如果你再看一遍这张照片。

2583
01:27:36,420 --> 01:27:38,070
0,390 390,630 630,810 810,1140 1140,1650
back through this picture here.|
|

2584
01:27:38,990 --> 01:27:40,480
0,930

2585
01:27:42,020 --> 01:27:43,310
0,150 150,600 600,750 750,960 960,1290
I think they make a
我认为他们做了一个非常简单的观察，

2586
01:27:43,310 --> 01:27:44,900
0,240 240,480 480,1080 1080,1290 1290,1590
very simple observation,| which is,
|也就是说，让我们看看能不能找到一张好照片。

2587
01:27:44,900 --> 01:27:45,530
0,240 240,360 360,450 450,540 540,630
let's see if we can

2588
01:27:45,530 --> 01:27:47,180
0,270 270,450 450,600 600,1050
find a good picture.|
|

2589
01:27:47,960 --> 01:27:49,670
0,180 180,630 630,1110 1110,1350 1350,1710
I probably scribbled over everything,|
我可能什么都草草写了下来，|

2590
01:27:49,670 --> 01:27:51,470
0,390 1020,1170 1170,1350 1350,1560 1560,1800
so it's gonna be maybe
所以它可能不会那么干净，

2591
01:27:51,470 --> 01:27:53,450
0,150 150,270 270,780 1260,1620 1620,1980
not as clean,| {} basically
|基本上他们说的是，如果你看这个数字，正确的，

2592
01:27:53,450 --> 01:27:54,380
0,150 150,240 240,690 690,840 840,930
what they're saying like if

2593
01:27:54,380 --> 01:27:55,250
0,120 120,240 240,300 300,450 450,870
you look at this figure,

2594
01:27:55,250 --> 01:27:58,040
0,450 720,1440 1470,2310
correct,| that {}
|S3总是具有前缀S2并且S2总是具有前缀S1，

2595
01:27:58,320 --> 01:27:59,310
0,240 240,540 540,810 810,930 930,990
{S3 -} always has a

2596
01:27:59,310 --> 01:28:00,360
0,390 390,510 510,690 690,930 930,1050
prefix of {S2 -} and

2597
01:28:00,360 --> 01:28:01,110
0,120 120,300 300,540 540,660 660,750
{S2 -} always has a

2598
01:28:01,110 --> 01:28:02,620
0,390 390,600 600,960
prefix of S1,|
|

2599
01:28:05,960 --> 01:28:06,890
0,240 240,510 510,630 630,810 810,930
and that's the only thing
这是唯一一件基本上不变的事情。

2600
01:28:06,890 --> 01:28:08,840
0,120 120,480 480,1020 1020,1410 1410,1950
that basically that's {invariant,says -}.|
|

2601
01:28:09,440 --> 01:28:10,840
0,750
Oh,
哦，那么i和j，那么后继者的前缀是前缀吗？

2602
01:28:11,170 --> 01:28:13,450
0,630 660,1020 1020,1170 1170,2010 2040,2280
so i and j, so

2603
01:28:13,450 --> 01:28:15,070
0,240 240,570 570,900 900,960 960,1620
the one out the successor

2604
01:28:15,070 --> 01:28:16,120
0,300 300,390 390,780 780,870 870,1050
has the prefix of the

2605
01:28:16,120 --> 01:28:17,890
0,510 540,1080 1290,1440 1440,1710 1710,1770
predecessor?| Yeah, and this is
|是啊，这有点让人困惑，

2606
01:28:17,890 --> 01:28:19,630
0,390 390,930 930,1170 1170,1380 1380,1740
slightly confusing,| I just realized
|我后来才意识到，

2607
01:28:19,630 --> 01:28:21,580
0,120 120,390 390,1500 1500,1740 1740,1950
that later,| after somebody else
|在别人问了这个问题之后，

2608
01:28:21,580 --> 01:28:24,460
0,180 180,300 300,780 1140,1590 2280,2880
asked this question,| {} in
|在定义中，i和j是两种不同的方式，

2609
01:28:24,490 --> 01:28:26,800
0,300 300,1140 1650,2010 2010,2190 2190,2310
the definition, the i and

2610
01:28:26,800 --> 01:28:28,390
0,270 270,630 630,750 900,1230 1230,1590
j is in two different

2611
01:28:28,390 --> 01:28:30,160
0,570 630,1050 1050,1260 1260,1500 1500,1770
ways,| well, not really different
|嗯，没有什么不同的方式，

2612
01:28:30,160 --> 01:28:31,630
0,270 270,570 570,690 690,750 750,1470
ways,| one is {} definition,|
|一个是定义，|

2613
01:28:32,100 --> 01:28:34,740
0,630 630,990 990,1230 1230,1680 1680,2640
{} and {ones,is} actually the
而1实际上是不变量

2614
01:28:34,770 --> 01:28:37,920
0,690 1260,1920 1920,2460 2490,2790 2790,3150
invariant| {} and {} you're
|你要小心一点，

2615
01:28:37,920 --> 01:28:38,970
0,180 180,270 270,330 330,510 510,1050
gonna be a little careful,|
|

2616
01:28:39,060 --> 01:28:43,230
0,1590 1590,1980 1980,2430 2460,3570 3570,4170
the role {of,i,and,j,in,the,chain -}.| {Go,around}.|
I和j在链条中的角色。|绕过去。|

2617
01:28:43,260 --> 01:28:46,650
0,990 990,1050 1050,1230 1230,1770 2520,3390
{Yeah,exactly}.| {How,is} that possible.| Exactly.|
是啊，就是这样。|这怎么可能。|一点儿没错。|

2618
01:28:47,140 --> 01:28:49,260
0,270 270,600 960,1140 1140,1530
Thank you.| You're welcome.|
谢谢。|不用谢。|

2619
01:28:50,060 --> 01:28:53,740
0,1560 2010,3090
{I,was,oops}.| Yeah.|
我真是太糟糕了。|嗯。|

2620
01:28:54,390 --> 01:28:55,500
0,270 270,420 420,600 600,750 750,1110
I was just gonna ask
我只是想问当你有一个网络分区而不是崩溃时会发生什么，

2621
01:28:55,500 --> 01:28:57,480
0,630 630,1080 1080,1560 1590,1770 1770,1980
what happens when you have

2622
01:28:57,480 --> 01:28:58,950
0,270 270,630 630,1050 1050,1350 1350,1470
a network partition instead of

2623
01:28:58,950 --> 01:29:00,750
0,60 60,660 840,1410 1440,1650 1650,1800
{} crash,| {} so if
|所以如果你去看坠机滑梯，

2624
01:29:00,750 --> 01:29:01,770
0,90 90,300 300,570 600,690 690,1020
you go to the crash

2625
01:29:01,770 --> 01:29:03,520
0,540 930,1440
slide, {}|
|

2626
01:29:03,610 --> 01:29:04,810
0,270 270,630 630,720 720,810 810,1200
what happens to the chain,|
链条发生了什么，|

2627
01:29:04,810 --> 01:29:06,100
0,150 150,390 390,450 450,810 810,1290
if there's a network partition,|
如果有网络分区，|

2628
01:29:06,100 --> 01:29:08,290
0,180 180,450 450,840 1170,1500 1500,2190
so maybe ask something like,
所以也许可以问这样的问题，比如S2实际上还活着，

2629
01:29:08,410 --> 01:29:10,330
0,690 690,990 990,1380 1380,1560 1560,1920
like {S2 -} is actually

2630
01:29:10,330 --> 01:29:12,040
0,270 270,870 1050,1290 1290,1470 1470,1710
still alive,| but there's a
|但是在配置管理器和S2或其他什么之间有一个分区，

2631
01:29:12,100 --> 01:29:14,050
0,540 540,870 870,960 960,1560 1560,1950
partition between the configuration manager

2632
01:29:14,050 --> 01:29:15,640
0,300 450,840 840,990 990,1110 1110,1590
and {S2 -} or something,|
|

2633
01:29:15,880 --> 01:29:17,020
0,180 180,300 300,510 510,750 750,1140
and so now both S1
所以现在S1和S2都指向S3。

2634
01:29:17,020 --> 01:29:18,040
0,270 270,450 450,570 570,690 690,1020
and {S2 -} are pointing

2635
01:29:18,040 --> 01:29:19,160
0,300 300,660
to S3.|
|

2636
01:29:20,130 --> 01:29:23,220
0,540 540,990 990,1980 2010,2670 2670,3090
No, no, {} yeah yeah,|
不，不，是的是的，|

2637
01:29:23,280 --> 01:29:25,050
0,390 420,990 990,1140 1140,1350 1350,1770
okay, there's gonna be some
好吧，显然会有一些，

2638
01:29:25,050 --> 01:29:27,390
0,960 960,1140 1140,1410 1410,1620 1620,2340
obviously,| when I I think
|当我我想人们都在谈论这件事时，

2639
01:29:27,390 --> 01:29:28,200
0,210 210,240 240,540 540,690 690,810
people are talking about this,|
|

2640
01:29:28,200 --> 01:29:29,040
0,180 180,240 240,540 540,690 690,840
but I presume that all
但我假设所有的配置都有编号，

2641
01:29:29,040 --> 01:29:31,230
0,540 540,630 630,1020 1530,1920 1920,2190
configurations are numbered,| like view
|类似于视频号和S3将不接受来自S2的任何命令，

2642
01:29:31,230 --> 01:29:33,660
0,570 870,1860 1860,2040 2040,2220 2220,2430
number and {S3 - -}

2643
01:29:33,660 --> 01:29:35,100
0,240 240,540 540,870 870,1050 1050,1440
will not accept any commands

2644
01:29:35,100 --> 01:29:36,690
0,150 150,330 330,780 780,1290 1320,1590
from {S2 -},| {} {if,the,view}
|如果观看次数不匹配。

2645
01:29:36,690 --> 01:29:38,360
0,660 660,840 840,1320
numbers don't match.|
|

2646
01:29:39,560 --> 01:29:40,550
0,330 330,420 420,630 630,750 750,990
Oh, you got it, thank
哦，没问题，谢谢。

2647
01:29:40,550 --> 01:29:41,380
0,240
you.|
|

2648
01:29:41,410 --> 01:29:43,090
0,210 210,750 750,1080 1080,1140 1140,1680
{} So related to that,
与此相关的是，我不能理解的一件事是

2649
01:29:43,090 --> 01:29:44,020
0,270 270,390 390,450 450,660 660,930
one thing I couldn't figure

2650
01:29:44,020 --> 01:29:45,310
0,120 120,270 270,540 540,750 750,1290
out is| even with like
|即使有类似的配置号或其他东西，

2651
01:29:45,310 --> 01:29:47,230
0,600 600,930 930,990 990,1440 1680,1920
configuration numbers or something, {}|
|

2652
01:29:47,230 --> 01:29:48,310
0,450 450,540 540,660 660,870 870,1080
how do you make sure
你如何确保当你去掉尾巴时

2653
01:29:48,310 --> 01:29:49,090
0,120 120,240 240,390 390,690 690,780
that when you get rid

2654
01:29:49,090 --> 01:29:50,170
0,90 90,240 240,780 780,870 870,1080
of the tail| {in,like} the
|就像你画的第三个场景，

2655
01:29:50,170 --> 01:29:52,030
0,270 270,750 750,1200 1440,1650 1650,1860
third scenario {you,drawn},| now when
|现在，当您通过尾部时，所有可能发出读取命令的客户端

2656
01:29:52,030 --> 01:29:52,900
0,90 90,180 180,300 300,390 390,870
you get through the tail,

2657
01:29:52,900 --> 01:29:54,460
0,300 390,930 930,1020 1020,1440 1440,1560
that all the clients that

2658
01:29:54,460 --> 01:29:55,960
0,240 240,510 510,660 660,1080 1320,1500
might issue a read| are
|都知道这台旧服务器不再。

2659
01:29:55,960 --> 01:29:57,520
0,510 510,750 750,990 990,1260 1260,1560
aware that this old server

2660
01:29:57,520 --> 01:29:59,140
0,120 120,330 750,1140 1140,1410 1410,1620
no longer.| Clients, I think
|客户们，我认为你们做的方式是

2661
01:29:59,140 --> 01:30:00,700
0,480 660,1260 1260,1350 1350,1440 1440,1560
the way you would do

2662
01:30:00,700 --> 01:30:02,020
0,240 240,420 420,510 510,1200 1200,1320
is| that the configuration when
|当客户端从配置管理器下载配置时，

2663
01:30:02,020 --> 01:30:03,370
0,60 60,330 330,750 750,810 810,1350
the client download the configuration

2664
01:30:03,370 --> 01:30:05,350
0,150 150,1260 1260,1620 1620,1740 1740,1980
from configuration manager,| they also
|它们还包括视图号

2665
01:30:05,350 --> 01:30:07,030
0,300 300,570 570,1080 1320,1470 1470,1680
include the {view,number}| and every
|每一次操作都包括数字，S3会说嗨，这是一个旧的视频号，

2666
01:30:07,030 --> 01:30:09,130
0,450 450,900 900,1170 1170,1740 1740,2100
operation includes the number and

2667
01:30:09,130 --> 01:30:11,830
0,450 450,1410 1410,1740 1740,1980 1980,2700
{S3 -} will say hi,

2668
01:30:12,210 --> 01:30:13,350
0,210 210,300 300,450 450,600 600,1140
there's an old view number,|
|

2669
01:30:13,470 --> 01:30:14,520
0,240 240,420 420,480 480,570 570,1050
don't talk to me. {}|
别跟我说话。|

2670
01:30:14,850 --> 01:30:16,590
0,180 180,180 180,810 810,1080 1080,1740
I I guess, {} when
我猜，当客户讨论配置以获得点击量时，

2671
01:30:16,590 --> 01:30:18,270
0,240 240,660 660,1050 1050,1140 1140,1680
the clients talk the configurations

2672
01:30:18,270 --> 01:30:19,440
0,120 120,210 210,420 420,750 750,1170
over to get view numbers,|
|

2673
01:30:19,440 --> 01:30:20,310
0,240 240,450 450,510 510,780 780,870
I'm going to start with
我首先要说的是一个客户，

2674
01:30:20,310 --> 01:30:21,420
0,60 60,150 150,510 720,870 870,1110
is a client,| that has
|它有一种古老的。

2675
01:30:21,420 --> 01:30:22,770
0,60 60,360 360,510 510,990 1020,1350
an old.| You know, so
|您知道，例如，S2可以只说重试

2676
01:30:22,770 --> 01:30:24,480
0,90 90,720 720,1320 1350,1530 1530,1710
for example the {S2 -}

2677
01:30:24,480 --> 01:30:25,680
0,120 120,270 270,660 660,900 900,1200
could just {} say {retry

2678
01:30:25,680 --> 01:30:28,140
0,480 810,1830 1860,2100 2100,2280 2280,2460
-}| and {the,client} then go
|然后客户端返回到配置服务器并重新读取到该状态。

2679
01:30:28,140 --> 01:30:29,460
0,240 240,300 300,360 360,840 840,1320
back to the configuration server

2680
01:30:29,460 --> 01:30:30,690
0,180 180,570 570,660 660,780 780,1230
and reread to the state.|
|

2681
01:30:32,380 --> 01:30:33,550
0,420 420,840 840,990 990,1110 1110,1170
{} I guess what I'm
我想我担心的是

2682
01:30:33,550 --> 01:30:34,360
0,150 150,300 300,360 360,510 510,810
worried about is| like {S3
|就像S3一样，网络与协调器隔开了

2683
01:30:34,360 --> 01:30:35,530
0,240 240,330 330,480 480,780 780,1170
-} has been network partitioned

2684
01:30:35,530 --> 01:30:38,020
0,450 450,690 690,1560 2010,2220 2220,2490
away from {} from the

2685
01:30:38,020 --> 01:30:39,850
0,660 750,1050 1050,1200 1200,1290 1290,1830
coordinator| and so the coordinator
|因此协调器从尾部去掉了S3

2686
01:30:39,850 --> 01:30:40,690
0,240 240,360 360,480 480,630 630,840
gets rid of {S3 -}

2687
01:30:40,690 --> 01:30:41,770
0,120 120,210 210,570 570,660 660,1080
from the tail| and increase
|并增加版本号，

2688
01:30:41,770 --> 01:30:43,270
0,120 120,390 390,810 1080,1320 1320,1500
the version number,| {} but
|但有些客户并没有发现版本号增加了

2689
01:30:43,270 --> 01:30:44,560
0,210 210,600 600,750 750,960 960,1290
some client out there doesn't

2690
01:30:44,560 --> 01:30:45,340
0,270 270,390 390,480 480,540 540,780
find out that the version

2691
01:30:45,340 --> 01:30:46,840
0,210 210,810 870,1050 1050,1290 1290,1500
numbers increase| and still {think,S3
|并且仍然认为S3尾巴，

2692
01:30:46,840 --> 01:30:48,340
0,180 180,390 390,960 990,1440 1440,1500
- -} tail,| talks to
|与S3的谈话没有读到，

2693
01:30:48,340 --> 01:30:49,990
0,150 150,330 330,630 630,1110 1230,1650
{S3 -} doesn't read,| meanwhile
|与此同时，人们正在对S1 S2进行写入

2694
01:30:49,990 --> 01:30:51,160
0,240 240,330 330,570 570,1020 1020,1170
people are doing write to

2695
01:30:51,160 --> 01:30:52,120
0,150 150,330 330,480 480,750 750,960
{S1 -} {S2 -}| and
|而他们基本上还没有看到这一点。

2696
01:30:52,480 --> 01:30:54,400
0,510 540,840 870,1050 1050,1590 1620,1920
{} they have {} haven't

2697
01:30:54,400 --> 01:30:55,800
0,210 210,420 420,1020
seen that basically.|
|

2698
01:30:55,800 --> 01:30:57,330
0,870 900,1080 1080,1140 1140,1470 1470,1530
Yeah, this is probably the
是啊，这可能就是为什么报纸要通过委托书。

2699
01:30:57,330 --> 01:30:58,410
0,270 270,570 570,810 810,930 930,1080
reason why the paper go

2700
01:30:58,410 --> 01:30:59,800
0,180 180,240 240,780
through the proxy.|
|

2701
01:31:01,870 --> 01:31:03,360
0,270 270,810
I see,
我明白了，好的。

2702
01:31:03,390 --> 01:31:07,140
0,1860
okay.|
|

2703
01:31:07,460 --> 01:31:08,750
0,330 330,450 450,600 600,1140 1140,1290
I have a question kind
我有一个问题，有点回到那个问题上来，

2704
01:31:08,750 --> 01:31:10,160
0,60 60,300 300,570 570,690 690,1410
of going back to that,|
|

2705
01:31:10,520 --> 01:31:13,320
0,390 390,810 810,1230 1230,2010
like unanswered questions about
就像线性化时类似于交叉对象的未回答问题，

2706
01:31:13,600 --> 01:31:15,400
0,210 210,270 270,420 420,780 780,1800
kind of like cross object

2707
01:31:15,640 --> 01:31:18,220
0,180 180,330 330,480 480,1110 1350,2580
when {linearizability - -},| I
|我想，这是不是还有一整罐我们还没有真正谈论过的

2708
01:31:18,250 --> 01:31:19,700
0,420 420,930
guess like,

2709
01:31:20,440 --> 01:31:21,670
0,150 150,270 270,390 390,990 990,1230
is that a whole other

2710
01:31:21,670 --> 01:31:22,570
0,210 210,300 300,660 660,810 810,900
can of [] that we

2711
01:31:22,570 --> 01:31:24,010
0,270 270,510 510,840 840,1260 1260,1440
haven't really talked about| which
|这就像如果你想做的话，

2712
01:31:24,010 --> 01:31:24,700
0,150 150,330 330,450 450,570 570,690
is like if you want

2713
01:31:24,700 --> 01:31:25,810
0,60 60,810 840,930 930,1020 1020,1110
to do,| I don't know
|我不知道什么是正确的术语，

2714
01:31:25,810 --> 01:31:26,500
0,90 90,180 180,360 360,570 570,690
what the right term is,|
|

2715
01:31:26,500 --> 01:31:28,870
0,120 120,270 270,1590 1620,1830 1830,2370
but like transactions that like
但就像跨越多个州的交易一样，

2716
01:31:28,870 --> 01:31:31,780
0,570 570,1530 1800,2190 2190,2340 2340,2910
cross multiple pieces of state,|
|

2717
01:31:31,780 --> 01:31:33,300
0,150 150,300 300,840
like if you're
例如，如果您正在尝试实现一项操作，

2718
01:31:33,300 --> 01:31:34,860
0,180 180,240 240,570 570,780 990,1560
trying to implement an operation,|
|

2719
01:31:34,860 --> 01:31:35,730
0,90 90,180 180,360 360,510 510,870
where it's like you're setting
就像你把a设为1，b设为2

2720
01:31:35,730 --> 01:31:36,570
0,150 150,240 240,480 480,600 600,840
a to one and b

2721
01:31:36,570 --> 01:31:37,740
0,540 540,690 690,810 810,990 990,1170
{to,two}| and you should only
|你应该只看到它们在一起，或者根本看不到，

2722
01:31:37,740 --> 01:31:39,240
0,210 210,750 750,1230 1230,1320 1320,1500
see those together or not

2723
01:31:39,240 --> 01:31:40,650
0,150 150,420 420,540 570,1320 1320,1410
at all,| like [] of
|就像[]那样，

2724
01:31:40,650 --> 01:31:42,150
0,240 270,480 480,750 780,1200 1200,1500
that,| have we talked about
|我们有没有在以前见过的任何东西中谈到过这一点。

2725
01:31:42,150 --> 01:31:43,170
0,240 240,360 360,570 570,870 870,1020
that in any of the

2726
01:31:43,170 --> 01:31:45,210
0,180 180,330 330,570 570,930 1050,2040
things we've seen before.| {No,and}
|不，我们会讨论几个星期，

2727
01:31:45,210 --> 01:31:47,310
0,180 180,240 240,450 450,990 1830,2100
{we'll,talk,about} a couple weeks,| it
|这将是一个大话题，

2728
01:31:47,310 --> 01:31:47,850
0,120 120,180 180,270 270,360 360,540
going to be a big

2729
01:31:47,850 --> 01:31:49,440
0,600 720,1080 1080,1440 1440,1530 1530,1590
topic,| {} basically how to
|基本上就是怎么做交易。

2730
01:31:49,440 --> 01:31:50,740
0,120 120,810
do transactions.|
|

2731
01:31:50,740 --> 01:31:52,450
0,420 1050,1290 1290,1380 1380,1470 1470,1710
Okay, that's good to know,
好的，很高兴知道，谢谢。

2732
01:31:52,450 --> 01:31:53,740
0,690
thanks.|
|

2733
01:31:54,980 --> 01:31:55,790
0,180 180,390 390,540 540,690 690,810
You mind going back to
你介意回去看第三张幻灯片吗？

2734
01:31:55,790 --> 01:31:57,820
0,120 120,240 240,750 750,1470
like the third slide?|
|

2735
01:31:58,100 --> 01:31:59,080
0,480
Yep.|
是啊。|

2736
01:32:00,050 --> 01:32:00,680
0,120 120,330 330,480 480,570 570,630
I can go to the
我可以去看第三张幻灯片，

2737
01:32:00,680 --> 01:32:02,000
0,300 300,750
third slide,|
|

2738
01:32:03,580 --> 01:32:05,620
0,690 840,1140 1140,1380 1380,1590 1590,2040
{} maybe not, fourth slide.|
也许不是，第四张幻灯片。|

2739
01:32:09,110 --> 01:32:11,210
0,450 450,630 630,900 900,1320 1470,2100
Oh, it's {fifth,slide}, sorry, {}|
哦，这是第五张幻灯片，抱歉，|

2740
01:32:12,410 --> 01:32:13,250
0,330 330,480 480,660 660,690 690,840
so I was a little
所以我有点困惑，

2741
01:32:13,250 --> 01:32:14,810
0,90 90,690 720,1080 1080,1230 1230,1560
bit confused,| when you mention
|当你提到如果锁持有者没有通过中期测试，

2742
01:32:14,810 --> 01:32:16,280
0,240 240,600 720,960 960,1200 1200,1470
like if lock holder failed

2743
01:32:16,280 --> 01:32:18,800
0,540 540,870 870,1290 1560,2010 2040,2520
intermediate stage stuff,| {} what
|这张幻灯片上的哪些内容适用于zlock

2744
01:32:18,800 --> 01:32:20,870
0,570 570,750 750,900 900,1440 1650,2070
exactly on this slide applies

2745
01:32:20,870 --> 01:32:21,800
0,120 120,300 300,600 600,750 750,930
to {zlocks -}| and what
|而适用于围棋的又一次锁定了。

2746
01:32:21,800 --> 01:32:22,760
0,300 300,390 390,510 510,660 660,960
applies to the go locks

2747
01:32:22,760 --> 01:32:23,540
0,330
again.|
|

2748
01:32:24,160 --> 01:32:26,230
0,600 600,1140 1140,1410 1410,1800 1800,2070
{} The these almost all
这些几乎都是关于zlock的陈述。

2749
01:32:26,230 --> 01:32:28,140
0,480 480,720 720,870 870,1410
statements about {zlocks -}.|
|

2750
01:32:29,760 --> 01:32:31,230
0,510 510,750 750,840 840,1110 1110,1470
So is the first statement
第一个声明也是如此，即如果锁托出现故障，

2751
01:32:31,230 --> 01:32:32,100
0,150 150,240 240,360 360,570 570,870
that if the lock holder

2752
01:32:32,100 --> 01:32:33,900
0,630 630,840 840,990 990,1500 1500,1800
fails,| then the intermediate state
|则中间状态不被清除，或者被清除。

2753
01:32:33,900 --> 01:32:35,400
0,330 360,750 750,1050 1050,1260 1260,1500
is not cleaned up, or

2754
01:32:35,400 --> 01:32:38,190
0,180 180,480 480,780 870,1620 1860,2790
is cleaned up.| No, immediate
|不，即时状态是可见的，

2755
01:32:38,190 --> 01:32:40,440
0,270 270,390 390,1080 1350,1890 1890,2250
state is visible,| but then
|但通常情况下，你会举行领导人选举，你可以清理中间州，

2756
01:32:40,440 --> 01:32:41,400
0,390 390,480 480,660 660,720 720,960
generally you have a leader

2757
01:32:41,400 --> 01:32:42,420
0,360 360,480 480,600 600,870 870,1020
election you could clean up

2758
01:32:42,420 --> 01:32:43,650
0,90 90,570 570,930 930,1110 1110,1230
the intermediate state,| that was
|这就是重点所在。

2759
01:32:43,650 --> 01:32:45,080
0,240 240,480 480,960
just like {}

2760
01:32:46,660 --> 01:32:47,950
0,150 150,570 570,810 810,990 990,1290
the point.| Oh, so with
|哦，所以有了GO锁

2761
01:32:48,250 --> 01:32:49,480
0,240 240,450 450,840 840,960 960,1230
with go locks| is that
|难道也不是这样吗？

2762
01:32:49,480 --> 01:32:50,590
0,270 270,600 600,690 690,930 930,1110
also not the case| like
|例如，如果有一台机器持有围棋锁，它正在做一些事情

2763
01:32:50,590 --> 01:32:51,580
0,180 180,390 390,450 450,840 840,990
if there's a machine that's

2764
01:32:51,580 --> 01:32:52,960
0,240 240,330 330,510 510,900 1140,1380
holding a go lock that's

2765
01:32:52,960 --> 01:32:54,310
0,270 270,690 720,870 870,1200 1290,1350
doing stuff| and then all
|然后所有的[][]，

2766
01:32:54,700 --> 01:32:56,890
0,330 330,660 660,1320 1470,1860 1860,2190
of [] [],| isn't still
|中间状态是否仍然可见。

2767
01:32:56,890 --> 01:32:58,840
0,90 90,630 630,870 870,1440
the intermediate state visible.|
|

2768
01:32:59,410 --> 01:33:00,940
0,450 450,720 720,1080 1080,1320 1320,1530
Okay, I I think what
好吧，我我想说的是上锁，

2769
01:33:00,940 --> 01:33:02,170
0,90 90,360 360,600 600,780 780,1230
{} talking about go locks,|
|

2770
01:33:02,170 --> 01:33:03,250
0,90 90,300 300,630 630,930 930,1080
you know is something that's
你知道，这是一个关于多个线程的陈述

2771
01:33:03,250 --> 01:33:05,110
0,120 120,510 510,1020 1020,1410 1410,1860
a statement about multiple threads|
|

2772
01:33:05,110 --> 01:33:06,280
0,300 300,420 420,480 480,720 720,1170
running on the same machine
在同一台计算机上运行

2773
01:33:06,310 --> 01:33:08,890
0,390 690,990 990,1590 1650,2430 2460,2580
right| and so if the
|所以如果围棋锁消失了，

2774
01:33:08,890 --> 01:33:10,690
0,270 270,630 630,1260 1260,1500 1500,1800
Go lock disappears,| because machine
|因为机器崩溃了，

2775
01:33:10,690 --> 01:33:11,680
0,330 330,510 510,570 570,930 930,990
crashes,| all the threads on
|那台机器上的所有线程也会崩溃。

2776
01:33:11,680 --> 01:33:13,280
0,150 150,480 480,780 780,1110
that machine crash too.|
|

2777
01:33:20,680 --> 01:33:22,440
0,510 840,1260
Right, but,
对，但是，当你说中间状态对其他人是可见的，

2778
01:33:22,840 --> 01:33:23,620
0,210 210,360 360,540 540,690 690,780
when you say that the

2779
01:33:23,620 --> 01:33:25,660
0,540 540,840 840,990 990,1620 1620,2040
intermediate state is visible to

2780
01:33:25,870 --> 01:33:27,340
0,360 360,870
other people,|
|

2781
01:33:27,430 --> 01:33:28,780
0,420 420,630 630,990 990,1110 1110,1350
that's still true for Go
然而，对于围棋锁来说，这仍然是正确的。

2782
01:33:28,780 --> 01:33:30,200
0,360 360,540 540,840
locks though right.|
|

2783
01:33:30,640 --> 01:33:31,600
0,210 210,300 300,480 480,630 630,960
You know if they written
您知道，如果他们将持久状态写入磁盘或某个共享文件系统，

2784
01:33:31,600 --> 01:33:34,420
0,420 420,720 720,990 990,1590 1740,2820
persistent state to disk, {}

2785
01:33:34,420 --> 01:33:35,710
0,420 420,630 630,780 780,1020 1020,1290
or into some shared file

2786
01:33:35,710 --> 01:33:36,820
0,390 390,540 540,780 780,840 840,1110
system,| like no the machine
|就像不，机器已经走了，

2787
01:33:36,820 --> 01:33:37,630
0,90 90,390 390,480 480,720 720,810
is gone,| the disk is
|磁盘不见了，一切都不见了。

2788
01:33:37,630 --> 01:33:39,120
0,330 330,570 570,630 630,960
gone, everything is gone.|
|

2789
01:33:40,220 --> 01:33:41,930
0,450 450,720 720,1170 1200,1500 1500,1710
Oh {got,it}, okay,| so it's
哦，知道了，好的，|所以这就是说，就像坚持不懈

2790
01:33:41,930 --> 01:33:43,070
0,180 180,330 330,420 420,900 930,1140
saying that the {} like

2791
01:33:43,070 --> 01:33:45,440
0,90 90,1050 1230,1470 1470,1980 1980,2370
the persistence| like intermediate state
|比如中间状态持久化。

2792
01:33:45,440 --> 01:33:47,930
0,540 570,1350 1350,1680 1680,2220 2220,2490
persistent.| {Zookeeper -} intermediate state
|动物园饲养员中间状态可能是可见的，

2793
01:33:47,930 --> 01:33:49,280
0,150 150,240 240,690 720,960 960,1350
might be visible,| we're gonna
|我们要删除可能创建了更多文件的人

2794
01:33:49,280 --> 01:33:50,810
0,450 450,990 990,1260 1260,1440 1440,1530
delete the guy might have

2795
01:33:50,810 --> 01:33:52,220
0,300 300,420 420,630 630,1110 1110,1410
created some more files| and
|这些现在都是可见的。

2796
01:33:52,220 --> 01:33:53,940
0,390 390,540 540,900 900,1260
those are visible now.|
|

2797
01:33:54,550 --> 01:33:56,320
0,480 570,720 720,1050 1290,1530 1530,1770
Okay I see, thank you.|
好的，我明白了，谢谢。|

2798
01:33:56,740 --> 01:33:58,630
0,780 780,1020 1020,1410 1410,1650 1650,1890
so just follow that,| since
所以只要顺着它走，|因为这意味着如果围棋程序在握住锁的过程中死亡，

2799
01:33:58,630 --> 01:34:00,760
0,90 90,1260 1260,1680 1740,1920 1920,2130
the implication that if a

2800
01:34:00,760 --> 01:34:02,530
0,360 360,840 840,1170 1170,1650 1650,1770
Go routine ever dies while

2801
01:34:02,530 --> 01:34:03,980
0,270 270,390 390,990
holding the lock,|
|

2802
01:34:04,100 --> 01:34:05,420
0,120 120,600 600,780 780,1140 1140,1320
the entire Go program must
整个围棋程序肯定也死了。

2803
01:34:05,420 --> 01:34:07,400
0,90 90,360 360,840
have died too.|
|

2804
01:34:07,820 --> 01:34:08,690
0,150 150,270 270,570 570,660 660,870
And as you can never
因为你永远不会有一套围棋套路，所以你不能拿着它死

2805
01:34:08,690 --> 01:34:09,800
0,150 150,210 210,480 480,870 870,1110
have a Go routine die

2806
01:34:09,800 --> 01:34:11,480
0,210 210,480 480,1080 1170,1410 1410,1680
holding {a,lock} {with,that}| and have
|并不断地让节目的其他部分。

2807
01:34:11,480 --> 01:34:12,560
0,450 450,660 660,720 720,780 780,1080
other parts of the program

2808
01:34:12,560 --> 01:34:14,580
0,660 1440,1770
continuously.| Okay.|
|好吧。|

2809
01:34:15,070 --> 01:34:16,240
0,240 240,420 420,660 660,1050 1050,1170
The Go routine crashes, the
Go例程崩溃，应用程序崩溃。

2810
01:34:16,240 --> 01:34:17,780
0,420 420,990
application crashes.
